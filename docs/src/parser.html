
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>
            MarkAppend - Parser
        </title>
        <link rel="icon" type="image/icon" href="../images/favicon.svg" />
        <link rel="stylesheet" href="../dist/normal.css" />
        
    </head>
    <body data-syntax-highlight="monokai"
        data-theme="purple-rain">
        
        <div id="navbar">
            
    <div class="navmenu ">
        
    <div class="navitem " >
        <a class="title enabled" href="../index.html" >
            <img src="../images/favicon.svg" />
            <span>MarkAppend</span>
        </a>
        
    </div>
    <div class="navitem " >
        <a class="enabled" href="https://www.npmjs.com/package/markappend" >
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-npm" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M1 8h22v7h-12v2h-4v-2h-6z" />
            <path d="M7 8v7" />
            <path d="M14 8v7" />
            <path d="M17 11v4" />
            <path d="M4 11v4" />
            <path d="M11 11v1" />
            <path d="M20 11v4" />
        </svg>
            <span>Download</span>
        </a>
        
    </div>
    <div class="navitem " >
        <a class="enabled" href="https://github.com/johtela/markappend" >
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
        </svg>
            <span>GitHub</span>
        </a>
        
    </div>
    <div class="navitem " >
        <a   >
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-caret-down" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M6 10l6 6l6 -6h-12" />
        </svg>
            <span>Syntax Highlight</span>
        </a>
        
    <div class="navmenu toggle">
        
    <div class="navitem " id="coding-horror">
        <a   onclick="document.body.syntaxHighlight('coding-horror')">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-palette" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M12 21a9 9 0 0 1 0 -18c4.97 0 9 3.582 9 8c0 1.06 -.474 2.078 -1.318 2.828c-.844 .75 -1.989 1.172 -3.182 1.172h-2.5a2 2 0 0 0 -1 3.75a1.3 1.3 0 0 1 -1 2.25" />
            <path d="M8.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
            <path d="M12.5 7.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
            <path d="M16.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
        </svg>
            <span>Coding Horror</span>
        </a>
        
    </div>
    <div class="navitem active" id="monokai">
        <a   onclick="document.body.syntaxHighlight('monokai')">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-palette" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M12 21a9 9 0 0 1 0 -18c4.97 0 9 3.582 9 8c0 1.06 -.474 2.078 -1.318 2.828c-.844 .75 -1.989 1.172 -3.182 1.172h-2.5a2 2 0 0 0 -1 3.75a1.3 1.3 0 0 1 -1 2.25" />
            <path d="M8.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
            <path d="M12.5 7.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
            <path d="M16.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
        </svg>
            <span>Monokai</span>
        </a>
        
    </div>
    <div class="navitem " id="solarized-light">
        <a   onclick="document.body.syntaxHighlight('solarized-light')">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-palette" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M12 21a9 9 0 0 1 0 -18c4.97 0 9 3.582 9 8c0 1.06 -.474 2.078 -1.318 2.828c-.844 .75 -1.989 1.172 -3.182 1.172h-2.5a2 2 0 0 0 -1 3.75a1.3 1.3 0 0 1 -1 2.25" />
            <path d="M8.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
            <path d="M12.5 7.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
            <path d="M16.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
        </svg>
            <span>Solarized Light</span>
        </a>
        
    </div>
    <div class="navitem " id="son-of-obsidian">
        <a   onclick="document.body.syntaxHighlight('son-of-obsidian')">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-palette" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M12 21a9 9 0 0 1 0 -18c4.97 0 9 3.582 9 8c0 1.06 -.474 2.078 -1.318 2.828c-.844 .75 -1.989 1.172 -3.182 1.172h-2.5a2 2 0 0 0 -1 3.75a1.3 1.3 0 0 1 -1 2.25" />
            <path d="M8.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
            <path d="M12.5 7.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
            <path d="M16.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
        </svg>
            <span>Son of Obsidian</span>
        </a>
        
    </div>
    </div>
    </div>
    <div class="navitem " >
        <a   >
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-caret-down" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M6 10l6 6l6 -6h-12" />
        </svg>
            <span>Theme</span>
        </a>
        
    <div class="navmenu toggle">
        
    <div class="navitem " id="blueberry">
        <a   onclick="document.body.theme('blueberry')">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-paint" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M5 3m0 2a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v2a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2z" />
            <path d="M19 6h1a2 2 0 0 1 2 2a5 5 0 0 1 -5 5l-5 0v2" />
            <path d="M10 15m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z" />
        </svg>
            <span>Blueberry</span>
        </a>
        
    </div>
    <div class="navitem " id="book-cover">
        <a   onclick="document.body.theme('book-cover')">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-paint" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M5 3m0 2a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v2a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2z" />
            <path d="M19 6h1a2 2 0 0 1 2 2a5 5 0 0 1 -5 5l-5 0v2" />
            <path d="M10 15m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z" />
        </svg>
            <span>Book Cover</span>
        </a>
        
    </div>
    <div class="navitem " id="brownie">
        <a   onclick="document.body.theme('brownie')">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-paint" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M5 3m0 2a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v2a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2z" />
            <path d="M19 6h1a2 2 0 0 1 2 2a5 5 0 0 1 -5 5l-5 0v2" />
            <path d="M10 15m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z" />
        </svg>
            <span>Brownie</span>
        </a>
        
    </div>
    <div class="navitem " id="camouflage">
        <a   onclick="document.body.theme('camouflage')">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-paint" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M5 3m0 2a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v2a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2z" />
            <path d="M19 6h1a2 2 0 0 1 2 2a5 5 0 0 1 -5 5l-5 0v2" />
            <path d="M10 15m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z" />
        </svg>
            <span>Camouflage</span>
        </a>
        
    </div>
    <div class="navitem " id="chocolate">
        <a   onclick="document.body.theme('chocolate')">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-paint" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M5 3m0 2a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v2a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2z" />
            <path d="M19 6h1a2 2 0 0 1 2 2a5 5 0 0 1 -5 5l-5 0v2" />
            <path d="M10 15m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z" />
        </svg>
            <span>Chocolate</span>
        </a>
        
    </div>
    <div class="navitem " id="greyhound">
        <a   onclick="document.body.theme('greyhound')">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-paint" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M5 3m0 2a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v2a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2z" />
            <path d="M19 6h1a2 2 0 0 1 2 2a5 5 0 0 1 -5 5l-5 0v2" />
            <path d="M10 15m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z" />
        </svg>
            <span>Greyhound</span>
        </a>
        
    </div>
    <div class="navitem " id="ice-age">
        <a   onclick="document.body.theme('ice-age')">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-paint" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M5 3m0 2a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v2a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2z" />
            <path d="M19 6h1a2 2 0 0 1 2 2a5 5 0 0 1 -5 5l-5 0v2" />
            <path d="M10 15m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z" />
        </svg>
            <span>Ice Age</span>
        </a>
        
    </div>
    <div class="navitem " id="mustard">
        <a   onclick="document.body.theme('mustard')">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-paint" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M5 3m0 2a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v2a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2z" />
            <path d="M19 6h1a2 2 0 0 1 2 2a5 5 0 0 1 -5 5l-5 0v2" />
            <path d="M10 15m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z" />
        </svg>
            <span>Mustard</span>
        </a>
        
    </div>
    <div class="navitem " id="peachy">
        <a   onclick="document.body.theme('peachy')">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-paint" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M5 3m0 2a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v2a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2z" />
            <path d="M19 6h1a2 2 0 0 1 2 2a5 5 0 0 1 -5 5l-5 0v2" />
            <path d="M10 15m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z" />
        </svg>
            <span>Peachy</span>
        </a>
        
    </div>
    <div class="navitem " id="red-alert">
        <a   onclick="document.body.theme('red-alert')">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-paint" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M5 3m0 2a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v2a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2z" />
            <path d="M19 6h1a2 2 0 0 1 2 2a5 5 0 0 1 -5 5l-5 0v2" />
            <path d="M10 15m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z" />
        </svg>
            <span>Red Alert</span>
        </a>
        
    </div>
    <div class="navitem " id="ultra-violet">
        <a   onclick="document.body.theme('ultra-violet')">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-paint" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M5 3m0 2a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v2a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2z" />
            <path d="M19 6h1a2 2 0 0 1 2 2a5 5 0 0 1 -5 5l-5 0v2" />
            <path d="M10 15m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z" />
        </svg>
            <span>Ultra Violet</span>
        </a>
        
    </div>
    <div class="navitem " id="vintage">
        <a   onclick="document.body.theme('vintage')">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-paint" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M5 3m0 2a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v2a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2z" />
            <path d="M19 6h1a2 2 0 0 1 2 2a5 5 0 0 1 -5 5l-5 0v2" />
            <path d="M10 15m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z" />
        </svg>
            <span>Vintage</span>
        </a>
        
    </div>
    </div>
    </div>
    </div>
            
    <a class="hamburger">
        <div class="bar1"></div>
        <div class="bar2"></div>
        <div class="bar3"></div>
    </a>
        </div>
        
        <div class="layout">
            <div class="sidepane narrow-scrollbars">
                
        <div class="tocmenu">
            <h3>Table of Contents</h3>
            
    <ul>
        
    <li>
        <a href="../README.html"><span>🏠</span><span data-toggle="tooltip" data-title="Start here">
            Home
        </span></a>
    </li>
    <li>
        <a href="parser.html" class="highlight"><span>👀</span><span data-toggle="tooltip" data-title="Parser implementation">
            Parser
        </span></a>
    </li>
    <li>
        <a href="helpers.html"><span>🧰</span><span data-toggle="tooltip" data-title="Helper code">
            Helpers
        </span></a>
    </li>
    <li>
        <a href="live-editor.html"><span>🎙️</span><span data-toggle="tooltip" data-title="Editor to test the parser interactively">
            Live Editor
        </span></a>
    </li>
    <li>
        <a href="commonmark.html"><span>🧪</span><span data-toggle="tooltip" data-title="CommonMark tester components">
            Testers
        </span></a>
    </li>
    <li>
        <a href="../commonmark-tests.html"><span>M⬇</span><span data-toggle="tooltip" data-title="CoonMark test suite">
            CommonMark Tests
        </span></a>
    </li>
    </ul>
        </div>
                <div class="toc-button"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevrons-right" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M7 7l5 5l-5 5" />
            <path d="M13 7l5 5l-5 5" />
        </svg></div>
            </div>
            
        <div class="contentarea closepopups">
            <h1 id="markdown-parser">Markdown Parser</h1>
<p>This module implements a self-contained Markdown parser. It does not import
or depend on any external libraries. The parsing process closely follows the
strategy outlined in the <a href="https://spec.commonmark.org/0.31.2/#appendix-a-parsing-strategy">CommonMark specification</a>.</p>
<p>Note: The parser is not fully CommonMark compliant. Some of the more obscure
rules have been intentionally omitted to keep the code simple.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">import</span> <span class="punctuation">{</span> <span id="419" data-toggle="tooltip" data-title="&lt;K extends keyof HTMLElementTagNameMap&gt;(tag: K, ...children: Node[]) =&gt; HTMLElementTagNameMap[K]">elem</span><span class="punctuation">,</span> <span id="425" data-toggle="tooltip" data-title="(data: string) =&gt; Text">text</span><span class="punctuation">,</span> <span id="431" data-toggle="tooltip" data-title="typeof ExpAuto">ExpAuto</span> <span class="punctuation">}</span> <span class="keyword">from</span> <span class="string">&#039;./helpers&#039;</span>
</code></pre>
<h2 id="matchers-and-parsers">Matchers and Parsers</h2>
<p>We start by defining a <em>matcher</em>, a function that is called when a regular
expression matches a pattern representing a Markdown element. It receives the
current parser state and the match(es) as arguments. A matcher must be
provided for all Markdown <a href="https://spec.commonmark.org/0.31.2/#blocks-and-inlines">blocks and inlines</a>.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">export</span> <span class="keyword">type</span> <span id="458" class="typename" data-toggle="tooltip" data-title="Matcher">Matcher</span> <span class="punctuation">=</span> <span class="punctuation">(</span><span id="1008" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">:</span> <a href="parser.html#5051"><span class="typename" data-toggle="tooltip" data-title="ParserState">ParserState</span></a><span class="punctuation">,</span> <span id="1027" data-toggle="tooltip" data-title="RegExpExecArray">match</span><span class="punctuation">:</span> <span class="typename" data-toggle="tooltip" data-title="RegExpExecArray">RegExpExecArray</span><span class="punctuation">)</span> <span class="punctuation">=&gt;</span> <span class="keyword">void</span>
</code></pre>
<p>A matcher is combined with its corresponding regular expression in the
<code>Parser</code> interface. This interface associates a regular expression pattern
with the function that handles matches for that pattern.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">export</span> <span class="keyword">interface</span> <span id="1059" class="typename" data-toggle="tooltip" data-title="Parser">Parser</span> <span class="punctuation">{</span>
    <span id="1311" data-toggle="tooltip" data-title="string">regexp</span><span class="punctuation">:</span> <span class="keyword">string</span>
    <span id="1331" data-toggle="tooltip" data-title="Matcher">matched</span><span class="punctuation">:</span> <a href="parser.html#458"><span class="typename" data-toggle="tooltip" data-title="Matcher">Matcher</span></a>
<span class="punctuation">}</span>
</code></pre>
<h2 id="blocks">Blocks</h2>
<p>A Markdown document is parsed as a sequence of blocks, each representing a
structural element such as a paragraph, heading, list, code block, or HTML
block. Each block corresponds to an HTML element (e.g., <code>&lt;p&gt;</code>, <code>&lt;h1&gt;</code>,
<code>&lt;ul&gt;</code>, <code>&lt;pre&gt;</code>) and may contain either plain text, inline elements, or
nested child blocks.</p>
<p>The <code>DocumentBlock</code> interface stores information about each open block during
parsing, including its associated DOM element, parent element for appending
children, block type (text, inline, or HTML), whether it is a leaf or
container, accumulated lines of content, an optional continuation regular
expression to determine if the block should continue, and an optional closing
handler.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">enum</span> <span id="1356" class="typename" data-toggle="tooltip" data-title="BlockType">BlockType</span> <span class="punctuation">{</span> <span id="2158" data-toggle="tooltip" data-title="BlockType.Text">Text</span><span class="punctuation">,</span> <span id="2164" data-toggle="tooltip" data-title="BlockType.Inline">Inline</span><span class="punctuation">,</span> <span id="2172" data-toggle="tooltip" data-title="BlockType.Html">Html</span><span class="punctuation">,</span> <span id="2178" data-toggle="tooltip" data-title="BlockType.Skip">Skip</span> <span class="punctuation">}</span>
</code></pre>
<p>An event function called when block continues or closes.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">export</span> <span class="keyword">type</span> <span id="2185" class="typename" data-toggle="tooltip" data-title="BlockEvent">BlockEvent</span> <span class="punctuation">=</span> <span class="punctuation">(</span><span id="2284" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">:</span> <a href="parser.html#5051"><span class="typename" data-toggle="tooltip" data-title="ParserState">ParserState</span></a><span class="punctuation">,</span> <span id="2303" data-toggle="tooltip" data-title="DocumentBlock">block</span><span class="punctuation">:</span> <a href="parser.html#2333"><span class="typename" data-toggle="tooltip" data-title="DocumentBlock">DocumentBlock</span></a><span class="punctuation">)</span> <span class="punctuation">=&gt;</span> <span class="keyword">void</span>
</code></pre>
<p>Represents a block-level element in a parsed Markdown document.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">export</span> <span class="keyword">interface</span> <span id="2333" class="typename" data-toggle="tooltip" data-title="DocumentBlock">DocumentBlock</span> <span class="punctuation">{</span>
</code></pre>
<p>The element that corresponds to the block.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>    <span id="2445" data-toggle="tooltip" data-title="Element">element</span><span class="punctuation">:</span> <span class="typename" data-toggle="tooltip" data-title="Element">Element</span>
</code></pre>
<p>In some cases, child nodes should be appended to a different parent
element than the block's main element. The <code>parent</code> property allows
specifying an alternative parent element for such scenarios.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>    <span id="2536" data-toggle="tooltip" data-title="Element">parent</span><span class="punctuation">:</span> <span class="typename" data-toggle="tooltip" data-title="Element">Element</span>
</code></pre>
<p>Indicates whether the block contains inline elements (such as links or
emphasis) or only plain verbatim text. This flag determines how the
block's content should be processed and rendered when the block is
flushed.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>    <span id="2798" data-toggle="tooltip" data-title="BlockType">type</span><span class="punctuation">:</span> <a href="parser.html#1356"><span class="typename" data-toggle="tooltip" data-title="BlockType">BlockType</span></a>
</code></pre>
<p>Indicates whether this block is a leaf block (cannot contain child
blocks) or a container block (can contain child blocks). Leaf blocks
contain only text or inline elements, while container blocks may nest
other blocks (e.g. lists or blockquotes).</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>    <span id="3087" data-toggle="tooltip" data-title="boolean">leaf</span><span class="punctuation">:</span> <span class="keyword">boolean</span>
</code></pre>
<p>Each entry in this array represents a line of markdown text that is part
of the content for this block. These lines are accumulated as the parser
processes the input, and are later used to generate the final HTML
content for the block.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>    <span id="3406" data-toggle="tooltip" data-title="string[]">lines</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">[</span><span class="punctuation">]</span>
</code></pre>
<p>Optional regular expression that must match the beginning of subsequent
Markdown lines for this block to continue. If provided, lines that do not
match will cause the block to be closed.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>    <span id="3716" data-toggle="tooltip" data-title="RegExp | undefined">cont</span><span class="punctuation">?</span><span class="punctuation">:</span> <span class="typename" data-toggle="tooltip" data-title="RegExp">RegExp</span>
</code></pre>
<p>A function that is called before the block is closed.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>    <span id="3966" data-toggle="tooltip" data-title="BlockEvent | undefined">closing</span><span class="punctuation">?</span><span class="punctuation">:</span> <a href="parser.html#2185"><span class="typename" data-toggle="tooltip" data-title="BlockEvent">BlockEvent</span></a>
</code></pre>
<p>Function that is called when the block continues to be open, i.e. when
the <code>cont</code> regexp matches for a following line.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>    <span id="4072" data-toggle="tooltip" data-title="BlockEvent | undefined">continuing</span><span class="punctuation">?</span><span class="punctuation">:</span> <a href="parser.html#2185"><span class="typename" data-toggle="tooltip" data-title="BlockEvent">BlockEvent</span></a>
<span class="punctuation">}</span>
</code></pre>
<h2 id="link-references">Link References</h2>
<p>In Markdown, link reference definitions allow you to define a link'
s destination and optional title separately from where the link is used. For
example:</p>
<pre><code> [example]: https://example.com &quot;Example Title&quot;
</code></pre>
<p>The <code>LinkRef</code> interface below is used to store the destination URL and the
optional title for each reference label. These definitions can then be looked
up when rendering reference-style links elsewhere in the document.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">export</span> <span class="keyword">interface</span> <span id="4257" class="typename" data-toggle="tooltip" data-title="LinkRef">LinkRef</span> <span class="punctuation">{</span>
    <span id="4788" data-toggle="tooltip" data-title="string">destination</span><span class="punctuation">:</span> <span class="keyword">string</span>
    <span id="4813" data-toggle="tooltip" data-title="string | undefined">title</span><span class="punctuation">?</span><span class="punctuation">:</span> <span class="keyword">string</span>
<span class="punctuation">}</span>
</code></pre>
<p>Dictionaries of link references and anchor tags whose targets are not
resolved yet.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">type</span> <span id="4836" class="typename" data-toggle="tooltip" data-title="LinkRefs">LinkRefs</span> <span class="punctuation">=</span> <span class="typename" data-toggle="tooltip" data-title="Record&lt;K, T&gt;">Record</span><span class="punctuation">&lt;</span><span class="keyword">string</span><span class="punctuation">,</span> <a href="parser.html#4257"><span class="typename" data-toggle="tooltip" data-title="LinkRef">LinkRef</span></a><span class="punctuation">&gt;</span>
<span class="keyword">type</span> <span id="4980" class="typename" data-toggle="tooltip" data-title="Links">Links</span> <span class="punctuation">=</span> <span class="typename" data-toggle="tooltip" data-title="Record&lt;K, T&gt;">Record</span><span class="punctuation">&lt;</span><span class="keyword">string</span><span class="punctuation">,</span> <span class="punctuation">(</span><span class="typename" data-toggle="tooltip" data-title="HTMLAnchorElement">HTMLAnchorElement</span> <span class="punctuation">|</span> <span class="typename" data-toggle="tooltip" data-title="HTMLImageElement">HTMLImageElement</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">&gt;</span>
</code></pre>
<h2 id="parser-state">Parser State</h2>
<p>The parser state tracks the current context and position during parsing.
It contains:</p>
<ul>
<li><code>input</code>: The Markdown source string currently being parsed.</li>
<li><code>nextIndex</code>: The current position in the input string for parsing.</li>
<li><code>blocks</code>: The stack of open <code>DocumentBlock</code> objects representing the block
hierarchy.</li>
<li><code>links</code>: A mapping of link reference labels to their definitions.</li>
</ul>
<p>This state object is passed to matcher functions and updated as the parser
processes the input.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">export</span> <span class="keyword">interface</span> <span id="5051" class="typename" data-toggle="tooltip" data-title="ParserState">ParserState</span> <span class="punctuation">{</span>
    <span id="5639" data-toggle="tooltip" data-title="string">input</span><span class="punctuation">:</span> <span class="keyword">string</span>
    <span id="5658" data-toggle="tooltip" data-title="number">nextIndex</span><span class="punctuation">:</span> <span class="keyword">number</span>
    <span id="5681" data-toggle="tooltip" data-title="DocumentBlock[]">blocks</span><span class="punctuation">:</span> <a href="parser.html#2333"><span class="typename" data-toggle="tooltip" data-title="DocumentBlock">DocumentBlock</span></a><span class="punctuation">[</span><span class="punctuation">]</span>
    <span id="5710" data-toggle="tooltip" data-title="LinkRefs">linkRefs</span><span class="punctuation">:</span> <a href="parser.html#4836"><span class="typename" data-toggle="tooltip" data-title="LinkRefs">LinkRefs</span></a>
    <span id="5734" data-toggle="tooltip" data-title="Links">links</span><span class="punctuation">:</span> <a href="parser.html#4980"><span class="typename" data-toggle="tooltip" data-title="Links">Links</span></a>
<span class="punctuation">}</span>
</code></pre>
<h2 id="constructors">Constructors</h2>
<p>Helper functions for creating parsers, new states, and DOM elements.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">export</span> <span class="keyword">function</span> <span id="5755" class="member" data-toggle="tooltip" data-title="(matched: Matcher, regexp: string) =&gt; Parser">parser</span><span class="punctuation">(</span><span id="5888" data-toggle="tooltip" data-title="Matcher">matched</span><span class="punctuation">:</span> <a href="parser.html#458"><span class="typename" data-toggle="tooltip" data-title="Matcher">Matcher</span></a><span class="punctuation">,</span> <span id="5905" data-toggle="tooltip" data-title="string">regexp</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">)</span><span class="punctuation">:</span> <a href="parser.html#1059"><span class="typename" data-toggle="tooltip" data-title="Parser">Parser</span></a> <span class="punctuation">{</span>
    <span class="keyword">return</span> <span class="punctuation">{</span> <span id="5945" data-toggle="tooltip" data-title="Matcher">matched</span><span class="punctuation">,</span> <span id="5954" data-toggle="tooltip" data-title="string">regexp</span> <span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre>
<p>Creates a new parser state based on the given state, but with a new input
string and optionally a new starting index. The <code>blocks</code> stack is shared with
the original state.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">function</span> <span id="5966" class="member" data-toggle="tooltip" data-title="(state: ParserState, input: string, nextIndex?: number) =&gt; ParserState">stateFrom</span><span class="punctuation">(</span><span id="6183" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">:</span> <a href="parser.html#5051"><span class="typename" data-toggle="tooltip" data-title="ParserState">ParserState</span></a><span class="punctuation">,</span> <span id="6202" data-toggle="tooltip" data-title="string">input</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">,</span> <span id="6217" data-toggle="tooltip" data-title="number">nextIndex</span> <span class="punctuation">=</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">:</span>
    <a href="parser.html#5051"><span class="typename" data-toggle="tooltip" data-title="ParserState">ParserState</span></a> <span class="punctuation">{</span>
    <span class="keyword">return</span> <span class="punctuation">{</span> <span id="6266" data-toggle="tooltip" data-title="string">input</span><span class="punctuation">,</span> <span id="6273" data-toggle="tooltip" data-title="number">nextIndex</span><span class="punctuation">,</span> <span id="6284" data-toggle="tooltip" data-title="DocumentBlock[]">blocks</span><span class="punctuation">:</span> <a href="parser.html#6183"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5681"><span data-toggle="tooltip" data-title="DocumentBlock[]">blocks</span></a><span class="punctuation">,</span> <span id="6306" data-toggle="tooltip" data-title="LinkRefs">linkRefs</span><span class="punctuation">:</span> <a href="parser.html#6183"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5710"><span data-toggle="tooltip" data-title="LinkRefs">linkRefs</span></a><span class="punctuation">,</span>
        <span id="6332" data-toggle="tooltip" data-title="Links">links</span><span class="punctuation">:</span> <a href="parser.html#6183"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5734"><span data-toggle="tooltip" data-title="Links">links</span></a> <span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre>
<h2 id="opening-and-closing-blocks">Opening and Closing Blocks</h2>
<p>Functions for managing the stack of open blocks during parsing.</p>
<ul>
<li>
<p><code>openBlock</code> pushes a new block onto the stack. You must specify the parser
state, the element to associate with the block, and whether the block is
inline. By default, the block is a leaf, the parent is the element itself,
and it has no continuation regexp. The block's lines array is always
initialized as empty.</p>
</li>
<li>
<p><code>closeLastBlock</code> pops the most recently opened block from the stack and
appends its element to its parent element in the previous block.</p>
</li>
</ul>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">function</span> <span id="6365" class="member" data-toggle="tooltip" data-title="(state: ParserState, element: Element, type: BlockType, leaf?: boolean, parent?: Element, cont?: RegExp, closing?: BlockEvent, continuing?: BlockEvent) =&gt; void">openBlock</span><span class="punctuation">(</span><span id="7008" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">:</span> <a href="parser.html#5051"><span class="typename" data-toggle="tooltip" data-title="ParserState">ParserState</span></a><span class="punctuation">,</span> <span id="7027" data-toggle="tooltip" data-title="Element">element</span><span class="punctuation">:</span> <span class="typename" data-toggle="tooltip" data-title="Element">Element</span><span class="punctuation">,</span> <span id="7045" data-toggle="tooltip" data-title="BlockType">type</span><span class="punctuation">:</span> <a href="parser.html#1356"><span class="typename" data-toggle="tooltip" data-title="BlockType">BlockType</span></a><span class="punctuation">,</span> 
    <span id="7062" data-toggle="tooltip" data-title="boolean">leaf</span> <span class="punctuation">=</span> <span class="keyword">true</span><span class="punctuation">,</span> <span id="7081" data-toggle="tooltip" data-title="Element">parent</span> <span class="punctuation">=</span> <a href="parser.html#7027"><span data-toggle="tooltip" data-title="Element">element</span></a><span class="punctuation">,</span> <span id="7099" data-toggle="tooltip" data-title="RegExp | undefined">cont</span><span class="punctuation">?</span><span class="punctuation">:</span> <span class="typename" data-toggle="tooltip" data-title="RegExp">RegExp</span><span class="punctuation">,</span> <span id="7114" data-toggle="tooltip" data-title="BlockEvent | undefined">closing</span><span class="punctuation">?</span><span class="punctuation">:</span> <a href="parser.html#2185"><span class="typename" data-toggle="tooltip" data-title="BlockEvent">BlockEvent</span></a><span class="punctuation">,</span>
    <span id="7136" data-toggle="tooltip" data-title="BlockEvent | undefined">continuing</span><span class="punctuation">?</span><span class="punctuation">:</span> <a href="parser.html#2185"><span class="typename" data-toggle="tooltip" data-title="BlockEvent">BlockEvent</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
    <a href="parser.html#7008"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5681"><span data-toggle="tooltip" data-title="DocumentBlock[]">blocks</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(...items: DocumentBlock[]) =&gt; number">push</span><span class="punctuation">(</span>
        <span class="punctuation">{</span> <span id="7203" data-toggle="tooltip" data-title="Element">element</span><span class="punctuation">,</span> <span id="7212" data-toggle="tooltip" data-title="Element">parent</span><span class="punctuation">,</span> <span id="7220" data-toggle="tooltip" data-title="BlockType">type</span><span class="punctuation">,</span> <span id="7226" data-toggle="tooltip" data-title="boolean">leaf</span><span class="punctuation">,</span> <span id="7232" data-toggle="tooltip" data-title="never[]">lines</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span> <span id="7243" data-toggle="tooltip" data-title="RegExp | undefined">cont</span><span class="punctuation">,</span> <span id="7249" data-toggle="tooltip" data-title="BlockEvent | undefined">closing</span><span class="punctuation">,</span> <span id="7258" data-toggle="tooltip" data-title="BlockEvent | undefined">continuing</span> <span class="punctuation">}</span><span class="punctuation">)</span>
<span class="punctuation">}</span>
</code></pre>
<p>Pops the last block from the stack and appends its element to the parent
element of the previous block in the stack.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">function</span> <span id="7275" class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; void">closeLastBlock</span><span class="punctuation">(</span><span id="7436" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">:</span> <a href="parser.html#5051"><span class="typename" data-toggle="tooltip" data-title="ParserState">ParserState</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
    <span class="keyword">let</span> <span id="7466" data-toggle="tooltip" data-title="DocumentBlock | undefined">block</span> <span class="punctuation">=</span> <a href="parser.html#7436"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5681"><span data-toggle="tooltip" data-title="DocumentBlock[]">blocks</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="() =&gt; DocumentBlock | undefined">pop</span><span class="punctuation">(</span><span class="punctuation">)</span>
    <span class="keyword">let</span> <span id="7502" data-toggle="tooltip" data-title="Element">element</span> <span class="punctuation">=</span> <a href="parser.html#7466"><span data-toggle="tooltip" data-title="DocumentBlock | undefined">block</span></a><span class="punctuation">!</span><span class="punctuation">.</span><a href="parser.html#2445"><span data-toggle="tooltip" data-title="Element">element</span></a>
    <span class="keyword">let</span> <span id="7536" data-toggle="tooltip" data-title="Element">parent</span> <span class="punctuation">=</span> <a href="parser.html#7643"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; DocumentBlock">lastBlock</span></a><span class="punctuation">(</span><a href="parser.html#7436"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">)</span><span class="punctuation">?.</span><a href="parser.html#2536"><span data-toggle="tooltip" data-title="Element">parent</span></a>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#7536"><span data-toggle="tooltip" data-title="Element">parent</span></a> <span class="punctuation">&amp;&amp;</span> <a href="parser.html#7536"><span data-toggle="tooltip" data-title="Element">parent</span></a> <span class="punctuation">!=</span> <a href="parser.html#7502"><span data-toggle="tooltip" data-title="Element">element</span></a><span class="punctuation">)</span>
        <a href="parser.html#7536"><span data-toggle="tooltip" data-title="Element">parent</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(...nodes: (Node | string)[]) =&gt; void">append</span><span class="punctuation">(</span><a href="parser.html#7502"><span data-toggle="tooltip" data-title="Element">element</span></a><span class="punctuation">)</span>
<span class="punctuation">}</span>
</code></pre>
<p>Returns the topmost (most recently opened) block from the parser state's
stack.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">function</span> <span id="7643" class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; DocumentBlock">lastBlock</span><span class="punctuation">(</span><span id="7763" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">:</span> <a href="parser.html#5051"><span class="typename" data-toggle="tooltip" data-title="ParserState">ParserState</span></a><span class="punctuation">)</span><span class="punctuation">:</span> <a href="parser.html#2333"><span class="typename" data-toggle="tooltip" data-title="DocumentBlock">DocumentBlock</span></a> <span class="punctuation">{</span>
    <span class="keyword">return</span> <a href="parser.html#7763"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5681"><span data-toggle="tooltip" data-title="DocumentBlock[]">blocks</span></a><span class="punctuation">[</span><a href="parser.html#7763"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5681"><span data-toggle="tooltip" data-title="DocumentBlock[]">blocks</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span> <span class="punctuation">-</span> <span class="number">1</span><span class="punctuation">]</span>
<span class="punctuation">}</span>
</code></pre>
<p>Check whether the last block is a paragraph.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">function</span> <span id="7852" class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; boolean">lastBlockIsParagraph</span><span class="punctuation">(</span><span id="7943" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">:</span> <a href="parser.html#5051"><span class="typename" data-toggle="tooltip" data-title="ParserState">ParserState</span></a><span class="punctuation">)</span><span class="punctuation">:</span> <span class="keyword">boolean</span> <span class="punctuation">{</span>
    <span class="keyword">return</span> <a href="parser.html#7643"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; DocumentBlock">lastBlock</span></a><span class="punctuation">(</span><a href="parser.html#7943"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">)</span><span class="punctuation">.</span><a href="parser.html#2445"><span data-toggle="tooltip" data-title="Element">element</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">tagName</span> <span class="punctuation">==</span> <span class="string">&quot;P&quot;</span>
<span class="punctuation">}</span>
</code></pre>
<p>Interrupts a paragraph block if one is open.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">function</span> <span id="8028" class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; void">interruptParagraph</span><span class="punctuation">(</span><span id="8117" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">:</span> <a href="parser.html#5051"><span class="typename" data-toggle="tooltip" data-title="ParserState">ParserState</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
    <a href="parser.html#49578"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; void">flushLastBlock</span></a><span class="punctuation">(</span><a href="parser.html#8117"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">)</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#7852"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; boolean">lastBlockIsParagraph</span></a><span class="punctuation">(</span><a href="parser.html#8117"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">)</span><span class="punctuation">)</span>
        <a href="parser.html#7275"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; void">closeLastBlock</span></a><span class="punctuation">(</span><a href="parser.html#8117"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">)</span>
<span class="punctuation">}</span>
</code></pre>
<p>Appends one or more nodes to the parent element of the current (topmost)
block.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">export</span> <span class="keyword">function</span> <span id="8237" class="member" data-toggle="tooltip" data-title="(state: ParserState, ...nodes: Node[]) =&gt; void">append</span><span class="punctuation">(</span><span id="8361" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">:</span> <a href="parser.html#5051"><span class="typename" data-toggle="tooltip" data-title="ParserState">ParserState</span></a><span class="punctuation">,</span> <span class="punctuation">...</span><span id="8380" data-toggle="tooltip" data-title="Node[]">nodes</span><span class="punctuation">:</span> <span class="typename" data-toggle="tooltip" data-title="Node">Node</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">)</span> <span class="punctuation">{</span>
    <a href="parser.html#7643"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; DocumentBlock">lastBlock</span></a><span class="punctuation">(</span><a href="parser.html#8361"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">)</span><span class="punctuation">.</span><a href="parser.html#2536"><span data-toggle="tooltip" data-title="Element">parent</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(...nodes: (Node | string)[]) =&gt; void">append</span><span class="punctuation">(</span><span class="punctuation">...</span><a href="parser.html#8380"><span data-toggle="tooltip" data-title="Node[]">nodes</span></a><span class="punctuation">)</span>
<span class="punctuation">}</span>
</code></pre>
<p>Append verbatitm HTML to the parent of the current block.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">export</span> <span class="keyword">function</span> <span id="8449" class="member" data-toggle="tooltip" data-title="(state: ParserState, html: string) =&gt; void">appendHtml</span><span class="punctuation">(</span><span id="8550" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">:</span> <a href="parser.html#5051"><span class="typename" data-toggle="tooltip" data-title="ParserState">ParserState</span></a><span class="punctuation">,</span> <span id="8569" data-toggle="tooltip" data-title="string">html</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">)</span> <span class="punctuation">{</span>
    <a href="parser.html#7643"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; DocumentBlock">lastBlock</span></a><span class="punctuation">(</span><a href="parser.html#8550"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">)</span><span class="punctuation">.</span><a href="parser.html#2536"><span data-toggle="tooltip" data-title="Element">parent</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(position: InsertPosition, string: string) =&gt; void">insertAdjacentHTML</span><span class="punctuation">(</span><span class="string">&#039;beforeend&#039;</span><span class="punctuation">,</span> <a href="parser.html#8569"><span data-toggle="tooltip" data-title="string">html</span></a><span class="punctuation">)</span>
<span class="punctuation">}</span>
</code></pre>
<p>Add rest of the current input to the specified block.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">function</span> <span id="8655" class="member" data-toggle="tooltip" data-title="(state: ParserState, block: DocumentBlock) =&gt; void">flushInputToBlock</span><span class="punctuation">(</span><span id="8754" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">:</span> <a href="parser.html#5051"><span class="typename" data-toggle="tooltip" data-title="ParserState">ParserState</span></a><span class="punctuation">,</span> <span id="8773" data-toggle="tooltip" data-title="DocumentBlock">block</span><span class="punctuation">:</span> <a href="parser.html#2333"><span class="typename" data-toggle="tooltip" data-title="DocumentBlock">DocumentBlock</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
    <a href="parser.html#8773"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">.</span><a href="parser.html#3406"><span data-toggle="tooltip" data-title="string[]">lines</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(...items: string[]) =&gt; number">push</span><span class="punctuation">(</span><a href="parser.html#8754"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5639"><span data-toggle="tooltip" data-title="string">input</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(start?: number, end?: number) =&gt; string">slice</span><span class="punctuation">(</span><a href="parser.html#8754"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5658"><span data-toggle="tooltip" data-title="number">nextIndex</span></a><span class="punctuation">)</span><span class="punctuation">)</span>
    <a href="parser.html#8754"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5658"><span data-toggle="tooltip" data-title="number">nextIndex</span></a> <span class="punctuation">=</span> <a href="parser.html#8754"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5639"><span data-toggle="tooltip" data-title="string">input</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span>
<span class="punctuation">}</span>
</code></pre>
<p>Trim empty lines from beginning and end of a block.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">function</span> <span id="8900" class="member" data-toggle="tooltip" data-title="(state: ParserState, block: DocumentBlock) =&gt; void">trimBlock</span><span class="punctuation">(</span><span id="8987" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">:</span> <a href="parser.html#5051"><span class="typename" data-toggle="tooltip" data-title="ParserState">ParserState</span></a><span class="punctuation">,</span> <span id="9006" data-toggle="tooltip" data-title="DocumentBlock">block</span><span class="punctuation">:</span> <a href="parser.html#2333"><span class="typename" data-toggle="tooltip" data-title="DocumentBlock">DocumentBlock</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
    <span class="keyword">while</span> <span class="punctuation">(</span><a href="parser.html#9006"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">.</span><a href="parser.html#3406"><span data-toggle="tooltip" data-title="string[]">lines</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span> <span class="punctuation">&gt;</span> <span class="number">0</span> <span class="punctuation">&amp;&amp;</span> <a href="parser.html#9006"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">.</span><a href="parser.html#3406"><span data-toggle="tooltip" data-title="string[]">lines</span></a><span class="punctuation">[</span><a href="parser.html#9006"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">.</span><a href="parser.html#3406"><span data-toggle="tooltip" data-title="string[]">lines</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span> <span class="punctuation">-</span> <span class="number">1</span><span class="punctuation">]</span> <span class="punctuation">==</span> <span class="string">&quot;&quot;</span><span class="punctuation">)</span>
        <a href="parser.html#9006"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">.</span><a href="parser.html#3406"><span data-toggle="tooltip" data-title="string[]">lines</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="() =&gt; string | undefined">pop</span><span class="punctuation">(</span><span class="punctuation">)</span>
    <span class="keyword">while</span> <span class="punctuation">(</span><a href="parser.html#9006"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">.</span><a href="parser.html#3406"><span data-toggle="tooltip" data-title="string[]">lines</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span> <span class="punctuation">&gt;</span> <span class="number">0</span> <span class="punctuation">&amp;&amp;</span> <a href="parser.html#9006"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">.</span><a href="parser.html#3406"><span data-toggle="tooltip" data-title="string[]">lines</span></a><span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span> <span class="punctuation">==</span> <span class="string">&quot;&quot;</span><span class="punctuation">)</span>
        <a href="parser.html#9006"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">.</span><a href="parser.html#3406"><span data-toggle="tooltip" data-title="string[]">lines</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="() =&gt; string | undefined">shift</span><span class="punctuation">(</span><span class="punctuation">)</span>
<span class="punctuation">}</span>
</code></pre>
<h2 id="constructing-combined-regular-expressions">Constructing Combined Regular Expressions</h2>
<p>This function takes a list of parsers and combines their regular expressions
into a single RegExp. Each parser's pattern is wrapped in a named capturing
group (<code>g0</code>, <code>g1</code>, ...), so we can later determine which parser matched.
The <code>sticky</code> parameter controls whether the resulting RegExp uses the &quot;y&quot;
(sticky) flag, which is needed for block parsing.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">function</span> <span id="9230" class="member" data-toggle="tooltip" data-title="(parsers: Parser[], sticky: boolean) =&gt; RegExp">regexpFor</span><span class="punctuation">(</span><span id="9685" data-toggle="tooltip" data-title="Parser[]">parsers</span><span class="punctuation">:</span> <a href="parser.html#1059"><span class="typename" data-toggle="tooltip" data-title="Parser">Parser</span></a><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span> <span id="9703" data-toggle="tooltip" data-title="boolean">sticky</span><span class="punctuation">:</span> <span class="keyword">boolean</span><span class="punctuation">)</span><span class="punctuation">:</span> <span class="typename" data-toggle="tooltip" data-title="RegExp">RegExp</span> <span class="punctuation">{</span>
    <span class="keyword">let</span> <span id="9739" data-toggle="tooltip" data-title="string">re</span> <span class="punctuation">=</span> <a href="parser.html#9685"><span data-toggle="tooltip" data-title="Parser[]">parsers</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="&lt;U&gt;(callbackfn: (value: Parser, index: number, array: Parser[]) =&gt; U, thisArg?: any) =&gt; U[]">map</span><span class="punctuation">(</span><span class="punctuation">(</span><span id="9758" data-toggle="tooltip" data-title="Parser">p</span><span class="punctuation">,</span> <span id="9760" data-toggle="tooltip" data-title="number">i</span><span class="punctuation">)</span> <span class="punctuation">=&gt;</span> <span class="string">`(?&lt;g${</span><a href="parser.html#9760"><span data-toggle="tooltip" data-title="number">i</span></a><span class="string">}&gt;${</span><a href="parser.html#9758"><span data-toggle="tooltip" data-title="Parser">p</span></a><span class="punctuation">.</span><a href="parser.html#1311"><span data-toggle="tooltip" data-title="string">regexp</span></a><span class="string">})`</span><span class="punctuation">)</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(separator?: string) =&gt; string">join</span><span class="punctuation">(</span><span class="string">&quot;|&quot;</span><span class="punctuation">)</span>
    <span class="keyword">return</span> <span class="keyword">new</span> <span class="typename" data-toggle="tooltip" data-title="RegExpConstructor">RegExp</span><span class="punctuation">(</span><a href="parser.html#9739"><span data-toggle="tooltip" data-title="string">re</span></a><span class="punctuation">,</span> <a href="parser.html#9703"><span data-toggle="tooltip" data-title="boolean">sticky</span></a> <span class="punctuation">?</span> <span class="string">&quot;yuis&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;guis&quot;</span><span class="punctuation">)</span>
<span class="punctuation">}</span>
</code></pre>
<p>Constructs a regular expression that matches either an &quot;open&quot; or &quot;close&quot;
pattern. The resulting RegExp has two named groups: &quot;open&quot; and &quot;close&quot;,
corresponding to the provided patterns. This is useful for finding matching
pairs (e.g., brackets or delimiters).</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">function</span> <span id="9857" class="member" data-toggle="tooltip" data-title="(open: string, close: string) =&gt; RegExp">openCloseRegexp</span><span class="punctuation">(</span><span id="10172" data-toggle="tooltip" data-title="string">open</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">,</span> <span id="10185" data-toggle="tooltip" data-title="string">close</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">)</span><span class="punctuation">:</span> <span class="typename" data-toggle="tooltip" data-title="RegExp">RegExp</span> <span class="punctuation">{</span>
    <span class="keyword">return</span> <span class="keyword">new</span> <span class="typename" data-toggle="tooltip" data-title="RegExpConstructor">RegExp</span><span class="punctuation">(</span><span class="string">`(?&lt;open&gt;${</span><a href="parser.html#10172"><span data-toggle="tooltip" data-title="string">open</span></a><span class="string">})|(?&lt;close&gt;${</span><a href="parser.html#10185"><span data-toggle="tooltip" data-title="string">close</span></a><span class="string">})`</span><span class="punctuation">,</span> <span class="string">&quot;guis&quot;</span><span class="punctuation">)</span>
<span class="punctuation">}</span>
</code></pre>
<p>Execute the given regexp and return its match groups, if it matches the
current input. Advance the <code>nextIndex</code> if match is found.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">function</span> <span id="10283" class="member" data-toggle="tooltip" data-title="(state: ParserState, regexp: RegExp) =&gt; RegExpExecArray | null">parseRegExp</span><span class="punctuation">(</span><span id="10455" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">:</span> <a href="parser.html#5051"><span class="typename" data-toggle="tooltip" data-title="ParserState">ParserState</span></a><span class="punctuation">,</span> <span id="10474" data-toggle="tooltip" data-title="RegExp">regexp</span><span class="punctuation">:</span> <span class="typename" data-toggle="tooltip" data-title="RegExp">RegExp</span><span class="punctuation">)</span><span class="punctuation">:</span> 
    <span class="typename" data-toggle="tooltip" data-title="RegExpExecArray">RegExpExecArray</span> <span class="punctuation">|</span> <span class="keyword">null</span> <span class="punctuation">{</span>
    <a href="parser.html#10474"><span data-toggle="tooltip" data-title="RegExp">regexp</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">lastIndex</span> <span class="punctuation">=</span> <a href="parser.html#10455"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5658"><span data-toggle="tooltip" data-title="number">nextIndex</span></a>
    <span class="keyword">let</span> <span id="10571" data-toggle="tooltip" data-title="RegExpExecArray | null">res</span> <span class="punctuation">=</span> <a href="parser.html#10474"><span data-toggle="tooltip" data-title="RegExp">regexp</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(string: string) =&gt; RegExpExecArray | null">exec</span><span class="punctuation">(</span><a href="parser.html#10455"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5639"><span data-toggle="tooltip" data-title="string">input</span></a><span class="punctuation">)</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#10571"><span data-toggle="tooltip" data-title="RegExpExecArray | null">res</span></a><span class="punctuation">)</span>
        <a href="parser.html#10455"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5658"><span data-toggle="tooltip" data-title="number">nextIndex</span></a> <span class="punctuation">=</span> <a href="parser.html#10571"><span data-toggle="tooltip" data-title="RegExpExecArray">res</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">index</span> <span class="punctuation">+</span> <a href="parser.html#10571"><span data-toggle="tooltip" data-title="RegExpExecArray">res</span></a><span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span>
    <span class="keyword">return</span> <a href="parser.html#10571"><span data-toggle="tooltip" data-title="RegExpExecArray | null">res</span></a>
<span class="punctuation">}</span>
</code></pre>
<p>The <code>parseNext</code> function attempts to match the next token in the input using
the combined regular expression and the list of parsers. It takes the regexp,
the parser array, the current parser state, and a flag indicating whether we
are parsing inline content. If a match is found:</p>
<ol>
<li>It flushes any unprocessed text before the match (for inlines).</li>
<li>It invokes the matcher function for the matched parser.</li>
<li>It advances the <code>nextIndex</code> to continue parsing after the match.</li>
</ol>
<p>Returns <code>true</code> if a parser matched, otherwise <code>false</code>.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">function</span> <span id="10688" class="member" data-toggle="tooltip" data-title="(regexp: RegExp, parsers: Parser[], state: ParserState, inline: boolean) =&gt; boolean">parseNext</span><span class="punctuation">(</span><span id="11297" data-toggle="tooltip" data-title="RegExp">regexp</span><span class="punctuation">:</span> <span class="typename" data-toggle="tooltip" data-title="RegExp">RegExp</span><span class="punctuation">,</span> <span id="11312" data-toggle="tooltip" data-title="Parser[]">parsers</span><span class="punctuation">:</span> <a href="parser.html#1059"><span class="typename" data-toggle="tooltip" data-title="Parser">Parser</span></a><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span> <span id="11331" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">:</span> <a href="parser.html#5051"><span class="typename" data-toggle="tooltip" data-title="ParserState">ParserState</span></a><span class="punctuation">,</span> 
    <span id="11351" data-toggle="tooltip" data-title="boolean">inline</span><span class="punctuation">:</span> <span class="keyword">boolean</span><span class="punctuation">)</span><span class="punctuation">:</span> <span class="keyword">boolean</span> <span class="punctuation">{</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#11331"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5658"><span data-toggle="tooltip" data-title="number">nextIndex</span></a> <span class="punctuation">&gt;=</span> <a href="parser.html#11331"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5639"><span data-toggle="tooltip" data-title="string">input</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span><span class="punctuation">)</span>
        <span class="keyword">return</span> <span class="keyword">false</span>
    <a href="parser.html#11297"><span data-toggle="tooltip" data-title="RegExp">regexp</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">lastIndex</span> <span class="punctuation">=</span> <a href="parser.html#11331"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5658"><span data-toggle="tooltip" data-title="number">nextIndex</span></a>
    <span class="keyword">let</span> <span id="11504" data-toggle="tooltip" data-title="RegExpExecArray | null">match</span> <span class="punctuation">=</span> <a href="parser.html#11297"><span data-toggle="tooltip" data-title="RegExp">regexp</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(string: string) =&gt; RegExpExecArray | null">exec</span><span class="punctuation">(</span><a href="parser.html#11331"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5639"><span data-toggle="tooltip" data-title="string">input</span></a><span class="punctuation">)</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#11504"><span data-toggle="tooltip" data-title="RegExpExecArray | null">match</span></a> <span class="punctuation">&amp;&amp;</span> <a href="parser.html#11504"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="{ [key: string]: string; } | undefined">groups</span><span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="keyword">let</span> <span id="11584" data-toggle="tooltip" data-title="Parser | undefined">parser</span> <span class="punctuation">=</span> <a href="parser.html#11312"><span data-toggle="tooltip" data-title="Parser[]">parsers</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="{ &lt;S extends Parser&gt;(predicate: (value: Parser, index: number, obj: Parser[]) =&gt; value is S, thisArg?: any): S | undefined; (predicate: (value: Parser, index: number, obj: Parser[]) =&gt; unknown, thisArg?: any): Parser | undefined; }">find</span><span class="punctuation">(</span><span class="punctuation">(</span><span id="11608" data-toggle="tooltip" data-title="Parser">_</span><span class="punctuation">,</span> <span id="11610" data-toggle="tooltip" data-title="number">i</span><span class="punctuation">)</span> <span class="punctuation">=&gt;</span> <a href="parser.html#11504"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="{ [key: string]: string; } | undefined">groups</span><span class="punctuation">!</span><span class="punctuation">[</span><span class="string">`g${</span><a href="parser.html#11610"><span data-toggle="tooltip" data-title="number">i</span></a><span class="string">}`</span><span class="punctuation">]</span> <span class="punctuation">!=</span> <span data-toggle="tooltip" data-title="undefined">undefined</span><span class="punctuation">)</span>
        <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#11584"><span data-toggle="tooltip" data-title="Parser | undefined">parser</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
            <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#11351"><span data-toggle="tooltip" data-title="boolean">inline</span></a><span class="punctuation">)</span>
                <a href="parser.html#16959"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, index?: number) =&gt; void">flushInline</span></a><span class="punctuation">(</span><a href="parser.html#11331"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#11504"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">index</span><span class="punctuation">)</span>
            <a href="parser.html#11331"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5658"><span data-toggle="tooltip" data-title="number">nextIndex</span></a> <span class="punctuation">=</span> <a href="parser.html#11504"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">index</span> <span class="punctuation">+</span> <a href="parser.html#11504"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a><span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span>
            <a href="parser.html#11584"><span data-toggle="tooltip" data-title="Parser">parser</span></a><span class="punctuation">.</span><a href="parser.html#1331"><span data-toggle="tooltip" data-title="Matcher">matched</span></a><span class="punctuation">(</span><a href="parser.html#11331"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#11504"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a><span class="punctuation">)</span>
            <span class="keyword">return</span> <span class="keyword">true</span>
        <span class="punctuation">}</span>
    <span class="punctuation">}</span>
    <span class="keyword">return</span> <span class="keyword">false</span>
<span class="punctuation">}</span>
</code></pre>
<h2 id="reusable-regular-expressions">Reusable Regular Expressions</h2>
<p>Here are RegExp fragments used throughout the parser:</p>
<ul>
<li><code>escapes</code>: Matches Markdown escape sequences (backslash followed by
punctuation or newline).</li>
<li><code>entities</code>: Matches HTML entities and numeric character references.</li>
<li><code>indentedCode</code>: Matches lines that begin with at least four spaces or a
tab (for indented code blocks).</li>
<li><code>indentedCodeOrBlank</code>: Matches indented code or blank lines.</li>
<li><code>blockQuote</code>: Matches blockquote markers (<code>&gt;</code>).</li>
<li><code>nonBlank</code>: Matches any line containing at least one non-whitespace
character.</li>
<li><code>codeSpan</code>: Matches inline code spans delimited by backticks.</li>
<li><code>emAsterisk</code> / <code>emUnderscore</code>: Matches emphasis and strong emphasis using
<code>*</code> or <code>_</code>.</li>
<li><code>linkLabel</code>, <code>linkDest</code>, <code>linkTitle</code>: Match link label, destination, and
title for Markdown links.</li>
<li><code>linkTextOpen</code>, <code>imageTextOpen</code>, <code>linkOrImageTextOpen</code>,
<code>linkOrImageTextClose</code>: Match opening/closing brackets for links/images.</li>
<li><code>autoLink</code>, <code>emailAutoLink</code>: Match autolinks and email autolinks.</li>
<li><code>rawHtml</code>: Matches raw HTML tags and their content.</li>
</ul>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">const</span> <span id="13099" data-toggle="tooltip" data-title="RegExp">escapes</span> <span class="punctuation">=</span> <span class="string">/\\(?&lt;esc&gt;[!&quot;#$%&amp;&#039;()*+,\-./:;&lt;=&gt;?@\[\\\]^_`{|}~\n])/guis</span>
<span class="keyword">const</span> <span id="13173" data-toggle="tooltip" data-title="string">entities</span> <span class="punctuation">=</span> <span class="string">/(?&lt;entity&gt;&amp;(?:[a-z]\w*|#\d{1,7}|#[Xx][\da-f]{1,6});)/</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">source</span>
<span class="keyword">const</span> <span id="13253" data-toggle="tooltip" data-title="RegExp">indentedCode</span> <span class="punctuation">=</span> <span class="string">/ {4}| {0,3}\t/yuis</span>
<span class="keyword">const</span> <span id="13295" data-toggle="tooltip" data-title="RegExp">indentedCodeOrBlank</span> <span class="punctuation">=</span> <span class="string">/ {4}| {0,3}\t|\s*$/yuis</span>
<span class="keyword">const</span> <span id="13349" data-toggle="tooltip" data-title="RegExp">blockQuote</span> <span class="punctuation">=</span> <span class="string">/ {0,3}&gt; ?/yuis</span>
<span class="keyword">const</span> <span id="13385" data-toggle="tooltip" data-title="RegExp">nonBlank</span> <span class="punctuation">=</span> <span class="string">/(?=\s*\S)/yuis</span>
<span class="keyword">const</span> <span id="13419" data-toggle="tooltip" data-title="string">codeSpan</span> <span class="punctuation">=</span> <span class="string">/(?&lt;codedelim&gt;`+)(?&lt;code&gt;\s.+\s|(?:[^`]|(?!\k&lt;codedelim&gt;)`)+)\k&lt;codedelim&gt;/</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">source</span>
<span class="keyword">const</span> <span id="13520" data-toggle="tooltip" data-title="string">emAsterisk</span> <span class="punctuation">=</span> <span class="string">/(?&lt;emdelim&gt;(?:(?&lt;!\\)|(?&lt;=\\\\))(?:\*\*?(?![\s\p{P}\p{S}]|$))|(?:(?&lt;=[\s\p{P}\p{S}]|^)\*\*?(?![\P{P}*])))(?&lt;em&gt;.+?)(?:(?&lt;![\s\p{P}\p{S}\\*])\k&lt;emdelim&gt;(?!\*)|(?&lt;![\P{P}\\*])\k&lt;emdelim&gt;(?=[\s\p{P}\p{S}])|(?&lt;![\s\\*])\k&lt;emdelim&gt;$)/u</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">source</span>
<span class="keyword">const</span> <span id="13779" data-toggle="tooltip" data-title="string">emUnderscore</span> <span class="punctuation">=</span> <span class="string">/(?&lt;emdelim&gt;(?:(?&lt;!\\)|(?&lt;=\\\\))(?:__?(?![\s\p{P}\p{S}]|$))|(?:(?&lt;=[\s\p{P}\p{S}]|^)__?(?![\P{P}_])))(?&lt;em&gt;.+?)(?:(?&lt;![\s\p{P}\p{S}\\_])\k&lt;emdelim&gt;(?!_)|(?&lt;![\P{P}\\_])\k&lt;emdelim&gt;(?=[\s\p{P}\p{S}])|(?&lt;![\s\\_])\k&lt;emdelim&gt;$)/u</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">source</span>
<span class="keyword">const</span> <span id="14035" data-toggle="tooltip" data-title="string">linkLabel</span> <span class="punctuation">=</span> <span class="string">/\[(?&lt;linklabel&gt;(?:\s*(?:[^\[\]\s]|(?&lt;=\\)(?&lt;!\\\\)[\[\]])+\s*)+)\]/</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">source</span>
<span class="keyword">const</span> <span id="14130" data-toggle="tooltip" data-title="string">linkDest</span> <span class="punctuation">=</span> <span class="string">/(?:(?&lt;!\\)&lt;(?&lt;linkdest&gt;(?:[^&lt;&gt;\n]|(?&lt;=\\)[&lt;&gt;])*)(?&lt;!\\)&gt;|(?&lt;linkdest&gt;(?!&lt;)(?:[^\x00-\x1F\x7F ()]|(?&lt;=\\)[()])*))/</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">source</span>
<span class="keyword">const</span> <span id="14270" data-toggle="tooltip" data-title="string">linkTitle</span> <span class="punctuation">=</span> <span class="string">/(?:&quot;(?&lt;linktitle&gt;(?:[^&quot;]|(?&lt;=\\)&quot;)+)&quot;|&#039;(?&lt;linktitle&gt;(?:[^&#039;]|(?&lt;=\\)&#039;)+)&#039;|\((?&lt;linktitle&gt;(?:[^()]|(?&lt;=\\)[()])+)\))/</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">source</span>
<span class="keyword">const</span> <span id="14413" data-toggle="tooltip" data-title="string">linkTextOpen</span> <span class="punctuation">=</span> <span class="string">/(?&lt;!\\)\[/</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">source</span>
<span class="keyword">const</span> <span id="14454" data-toggle="tooltip" data-title="string">imageTextOpen</span> <span class="punctuation">=</span> <span class="string">/(?&lt;!\\)!\[/</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">source</span>
<span class="keyword">const</span> <span id="14497" data-toggle="tooltip" data-title="string">linkOrImageTextOpen</span> <span class="punctuation">=</span> <span class="string">/(?&lt;!\\)!?\[/</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">source</span>
<span class="keyword">const</span> <span id="14547" data-toggle="tooltip" data-title="string">linkOrImageTextClose</span> <span class="punctuation">=</span> <span class="string">/(?:(?&lt;!\\)|(?&lt;=\\\\))\]/</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">source</span>
<span class="keyword">const</span> <span id="14610" data-toggle="tooltip" data-title="RegExp">linkOrImageTextOpenClose</span> <span class="punctuation">=</span> <a href="parser.html#9857"><span class="member" data-toggle="tooltip" data-title="(open: string, close: string) =&gt; RegExp">openCloseRegexp</span></a><span class="punctuation">(</span><a href="parser.html#14497"><span data-toggle="tooltip" data-title="string">linkOrImageTextOpen</span></a><span class="punctuation">,</span> <a href="parser.html#14547"><span data-toggle="tooltip" data-title="string">linkOrImageTextClose</span></a><span class="punctuation">)</span>
<span class="keyword">const</span> <span id="14703" data-toggle="tooltip" data-title="RegExp">inlineLink</span> <span class="punctuation">=</span> <span class="keyword">new</span> <span class="typename" data-toggle="tooltip" data-title="RegExpConstructor">RegExp</span><span class="punctuation">(</span><span class="string">`\\(\\s*${</span><a href="parser.html#14130"><span data-toggle="tooltip" data-title="string">linkDest</span></a><span class="string">}(?:\\s+${</span><a href="parser.html#14270"><span data-toggle="tooltip" data-title="string">linkTitle</span></a><span class="string">})?\\s*\\)`</span><span class="punctuation">,</span> <span class="string">&quot;yuis&quot;</span><span class="punctuation">)</span>
<span class="keyword">const</span> <span id="14792" data-toggle="tooltip" data-title="RegExp">fullReferenceLink</span> <span class="punctuation">=</span> <span class="keyword">new</span> <span class="typename" data-toggle="tooltip" data-title="RegExpConstructor">RegExp</span><span class="punctuation">(</span><a href="parser.html#14035"><span data-toggle="tooltip" data-title="string">linkLabel</span></a><span class="punctuation">,</span> <span class="string">&quot;yuis&quot;</span><span class="punctuation">)</span>
<span class="keyword">const</span> <span id="14849" data-toggle="tooltip" data-title="RegExp">collapsedReferenceLink</span> <span class="punctuation">=</span> <span class="string">/(?![(:])(?:\[\])?/yuis</span>
<span class="keyword">const</span> <span id="14905" data-toggle="tooltip" data-title="string">autoLink</span> <span class="punctuation">=</span> <span class="string">/&lt;(?&lt;autolink&gt;[a-z][\w\-+.]{1,31}:[^\x00-\x1F\x7F &lt;&gt;]*)&gt;/</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">source</span>
<span class="keyword">const</span> <span id="14988" data-toggle="tooltip" data-title="string">emailAutoLink</span> <span class="punctuation">=</span> <span class="string">/&lt;(?&lt;email&gt;[a-zA-Z0-9.!#$%&amp;&#039;*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*)&gt;/</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">source</span>
<span class="keyword">const</span> <span id="15163" data-toggle="tooltip" data-title="string">rawHtml</span> <span class="punctuation">=</span> <span class="string">/(?&lt;tagstart&gt;&lt;(?&lt;tag&gt;[a-z][a-z0-9\-]*)(?:\s+[a-z:_][\w.:\-]*\s*(?:=\s*&quot;[^&quot;]*&quot;|=\s*&#039;[^&#039;]*&#039;|=[^\s&quot;&#039;=&lt;&gt;`]+)?)*\s*)(?&lt;tagend&gt;\/?&gt;)(?:(?&lt;innerhtml&gt;.*)&lt;\/\k&lt;tag&gt;\s*&gt;)?/</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">source</span>
</code></pre>
<p>Link references can span multiple lines. Since the block parser reads input
line-by-line, we need an expression automaton to track the parser state.
There are three sub-automata that parse thelink label, link destination and
the optional title. The states and transitions of the automata are defined
below.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">const</span> <span id="15690" data-toggle="tooltip" data-title="ExpAuto">linkLabelAuto</span> <span class="punctuation">=</span> <a href="parser.html#431"><span data-toggle="tooltip" data-title="typeof ExpAuto">ExpAuto</span></a><span class="punctuation">.</span><a href="helpers.html#5028"><span class="member" data-toggle="tooltip" data-title="(count: number, init: (...states: State[]) =&gt; [State, RegExp | string, State, string?][]) =&gt; ExpAuto">create</span></a><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span>
    <span class="punctuation">(</span><span id="15731" data-toggle="tooltip" data-title="State">start</span><span class="punctuation">,</span> <span id="15737" data-toggle="tooltip" data-title="State">label</span><span class="punctuation">,</span> <span id="15744" data-toggle="tooltip" data-title="State">accept</span><span class="punctuation">)</span> <span class="punctuation">=&gt;</span> <span class="punctuation">[</span>
        <span class="punctuation">[</span><a href="parser.html#15731"><span data-toggle="tooltip" data-title="State">start</span></a><span class="punctuation">,</span> <span class="string">/ {0,3}\[/</span><span class="punctuation">,</span> <a href="parser.html#15737"><span data-toggle="tooltip" data-title="State">label</span></a><span class="punctuation">]</span><span class="punctuation">,</span>
        <span class="punctuation">[</span><a href="parser.html#15737"><span data-toggle="tooltip" data-title="State">label</span></a><span class="punctuation">,</span> <span class="string">/\s*(?:[^\[\]\s]|(?&lt;=\\)(?&lt;!\\\\)[\[\]])+/</span><span class="punctuation">,</span> <a href="parser.html#15737"><span data-toggle="tooltip" data-title="State">label</span></a><span class="punctuation">,</span> <span class="string">&quot;label&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span>
        <span class="punctuation">[</span><a href="parser.html#15737"><span data-toggle="tooltip" data-title="State">label</span></a><span class="punctuation">,</span> <span class="string">/\s*(?:(?&lt;!\\)|(?&lt;=\\\\))\]:\s*/</span><span class="punctuation">,</span> <a href="parser.html#15744"><span data-toggle="tooltip" data-title="State">accept</span></a><span class="punctuation">]</span>
    <span class="punctuation">]</span><span class="punctuation">)</span>
<span class="keyword">const</span> <span id="15946" data-toggle="tooltip" data-title="ExpAuto">linkDestAuto</span> <span class="punctuation">=</span> <a href="parser.html#431"><span data-toggle="tooltip" data-title="typeof ExpAuto">ExpAuto</span></a><span class="punctuation">.</span><a href="helpers.html#5028"><span class="member" data-toggle="tooltip" data-title="(count: number, init: (...states: State[]) =&gt; [State, RegExp | string, State, string?][]) =&gt; ExpAuto">create</span></a><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span>
    <span class="punctuation">(</span><span id="15986" data-toggle="tooltip" data-title="State">start</span><span class="punctuation">,</span> <span id="15992" data-toggle="tooltip" data-title="State">accept</span><span class="punctuation">)</span> <span class="punctuation">=&gt;</span> <span class="punctuation">[</span>
        <span class="punctuation">[</span><a href="parser.html#15986"><span data-toggle="tooltip" data-title="State">start</span></a><span class="punctuation">,</span> 
            <span class="string">/\s*(?:&lt;(?:[^&lt;&gt;]|(?&lt;=\\)[&lt;&gt;])+(?&lt;!\\)&gt;|(?&lt;!&lt;)(?:[^\x00-\x1F\x7F ()]|(?&lt;=\\)[()])+)(?:\s+|$)/</span><span class="punctuation">,</span> 
            <a href="parser.html#15992"><span data-toggle="tooltip" data-title="State">accept</span></a><span class="punctuation">,</span> <span class="string">&quot;dest&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span>
    <span class="punctuation">]</span><span class="punctuation">)</span>
<span class="keyword">const</span> <span id="16176" data-toggle="tooltip" data-title="ExpAuto">linkTitleAuto</span> <span class="punctuation">=</span> <a href="parser.html#431"><span data-toggle="tooltip" data-title="typeof ExpAuto">ExpAuto</span></a><span class="punctuation">.</span><a href="helpers.html#5028"><span class="member" data-toggle="tooltip" data-title="(count: number, init: (...states: State[]) =&gt; [State, RegExp | string, State, string?][]) =&gt; ExpAuto">create</span></a><span class="punctuation">(</span><span class="number">3</span><span class="punctuation">,</span>
    <span class="punctuation">(</span><span id="16217" data-toggle="tooltip" data-title="State">start</span><span class="punctuation">,</span> <span id="16223" data-toggle="tooltip" data-title="State">dquoted</span><span class="punctuation">,</span> <span id="16232" data-toggle="tooltip" data-title="State">squoted</span><span class="punctuation">,</span> <span id="16241" data-toggle="tooltip" data-title="State">parens</span><span class="punctuation">,</span> <span id="16249" data-toggle="tooltip" data-title="State">accept</span><span class="punctuation">)</span> <span class="punctuation">=&gt;</span> <span class="punctuation">[</span>
        <span class="punctuation">[</span><a href="parser.html#16217"><span data-toggle="tooltip" data-title="State">start</span></a><span class="punctuation">,</span> <span class="string">/\s*&quot;/</span><span class="punctuation">,</span> <a href="parser.html#16223"><span data-toggle="tooltip" data-title="State">dquoted</span></a><span class="punctuation">]</span><span class="punctuation">,</span>
        <span class="punctuation">[</span><a href="parser.html#16223"><span data-toggle="tooltip" data-title="State">dquoted</span></a><span class="punctuation">,</span> <span class="string">/(?:\s*(?:[^&quot;\s]|(?&lt;=\\)&quot;)+)+/</span><span class="punctuation">,</span> <a href="parser.html#16223"><span data-toggle="tooltip" data-title="State">dquoted</span></a><span class="punctuation">,</span> <span class="string">&quot;title&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span>
        <span class="punctuation">[</span><a href="parser.html#16223"><span data-toggle="tooltip" data-title="State">dquoted</span></a><span class="punctuation">,</span> <span class="string">/(?&lt;!\\)&quot;\s*$/</span><span class="punctuation">,</span> <a href="parser.html#16249"><span data-toggle="tooltip" data-title="State">accept</span></a><span class="punctuation">]</span><span class="punctuation">,</span>
        <span class="punctuation">[</span><a href="parser.html#16217"><span data-toggle="tooltip" data-title="State">start</span></a><span class="punctuation">,</span> <span class="string">/\s*&#039;/</span><span class="punctuation">,</span> <a href="parser.html#16232"><span data-toggle="tooltip" data-title="State">squoted</span></a><span class="punctuation">]</span><span class="punctuation">,</span>
        <span class="punctuation">[</span><a href="parser.html#16232"><span data-toggle="tooltip" data-title="State">squoted</span></a><span class="punctuation">,</span> <span class="string">/(?:\s*(?:[^&#039;\s]|(?&lt;=\\)&#039;)+)+/</span><span class="punctuation">,</span> <a href="parser.html#16232"><span data-toggle="tooltip" data-title="State">squoted</span></a><span class="punctuation">,</span> <span class="string">&quot;title&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span>
        <span class="punctuation">[</span><a href="parser.html#16232"><span data-toggle="tooltip" data-title="State">squoted</span></a><span class="punctuation">,</span> <span class="string">/(?&lt;!\\)&#039;\s*$/</span><span class="punctuation">,</span> <a href="parser.html#16249"><span data-toggle="tooltip" data-title="State">accept</span></a><span class="punctuation">]</span><span class="punctuation">,</span>
        <span class="punctuation">[</span><a href="parser.html#16217"><span data-toggle="tooltip" data-title="State">start</span></a><span class="punctuation">,</span> <span class="string">/\s*\(/</span><span class="punctuation">,</span> <a href="parser.html#16241"><span data-toggle="tooltip" data-title="State">parens</span></a><span class="punctuation">]</span><span class="punctuation">,</span>
        <span class="punctuation">[</span><a href="parser.html#16241"><span data-toggle="tooltip" data-title="State">parens</span></a><span class="punctuation">,</span> <span class="string">/(?:\s*(?:[^()]|(?&lt;=\\)[()])+)+/</span><span class="punctuation">,</span> <a href="parser.html#16241"><span data-toggle="tooltip" data-title="State">parens</span></a><span class="punctuation">,</span> <span class="string">&quot;title&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span>
        <span class="punctuation">[</span><a href="parser.html#16241"><span data-toggle="tooltip" data-title="State">parens</span></a><span class="punctuation">,</span> <span class="string">/(?&lt;!\\)\)\s*$/</span><span class="punctuation">,</span> <a href="parser.html#16249"><span data-toggle="tooltip" data-title="State">accept</span></a><span class="punctuation">]</span><span class="punctuation">,</span>
        <span class="punctuation">[</span><a href="parser.html#16217"><span data-toggle="tooltip" data-title="State">start</span></a><span class="punctuation">,</span> <span class="string">/(?![&quot;&#039;(])|^/</span><span class="punctuation">,</span> <a href="parser.html#16249"><span data-toggle="tooltip" data-title="State">accept</span></a><span class="punctuation">]</span>
    <span class="punctuation">]</span><span class="punctuation">)</span>
</code></pre>
<p>Now we can construct the combined automaton for link references by
concatenating the three automata above.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">const</span> <span id="16890" data-toggle="tooltip" data-title="ExpAuto">linkRef</span> <span class="punctuation">=</span> <a href="parser.html#431"><span data-toggle="tooltip" data-title="typeof ExpAuto">ExpAuto</span></a><span class="punctuation">.</span><a href="helpers.html#8837"><span class="member" data-toggle="tooltip" data-title="(...automata: ExpAuto[]) =&gt; ExpAuto">concat</span></a><span class="punctuation">(</span><a href="parser.html#15690"><span data-toggle="tooltip" data-title="ExpAuto">linkLabelAuto</span></a><span class="punctuation">,</span> <a href="parser.html#15946"><span data-toggle="tooltip" data-title="ExpAuto">linkDestAuto</span></a><span class="punctuation">,</span> <a href="parser.html#16176"><span data-toggle="tooltip" data-title="ExpAuto">linkTitleAuto</span></a><span class="punctuation">)</span>
</code></pre>
<h2 id="inline-parsers">Inline Parsers</h2>
<p>Inline parser handle Markdown elements that can appear within block-level
content, such as emphasis, links, code spans, and images. The <code>flushInline</code>
function appends any unprocessed input as a text node to the current block,
from the parser state's current index up to the specified position (or to
the end of input if no position is given).</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">function</span> <span id="16959" class="member" data-toggle="tooltip" data-title="(state: ParserState, index?: number) =&gt; void">flushInline</span><span class="punctuation">(</span><span id="17382" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">:</span> <a href="parser.html#5051"><span class="typename" data-toggle="tooltip" data-title="ParserState">ParserState</span></a><span class="punctuation">,</span> <span id="17401" data-toggle="tooltip" data-title="number | undefined">index</span><span class="punctuation">?</span><span class="punctuation">:</span> <span class="keyword">number</span><span class="punctuation">)</span> <span class="punctuation">{</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#17401"><span data-toggle="tooltip" data-title="number | undefined">index</span></a> <span class="punctuation">==</span> <span data-toggle="tooltip" data-title="undefined">undefined</span> <span class="punctuation">||</span> <a href="parser.html#17401"><span data-toggle="tooltip" data-title="number">index</span></a> <span class="punctuation">&gt;</span> <a href="parser.html#17382"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5658"><span data-toggle="tooltip" data-title="number">nextIndex</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="keyword">let</span> <span id="17490" data-toggle="tooltip" data-title="string">inp</span> <span class="punctuation">=</span> <a href="parser.html#17382"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5639"><span data-toggle="tooltip" data-title="string">input</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(start: number, end?: number) =&gt; string">substring</span><span class="punctuation">(</span><a href="parser.html#17382"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5658"><span data-toggle="tooltip" data-title="number">nextIndex</span></a><span class="punctuation">,</span> <a href="parser.html#17401"><span data-toggle="tooltip" data-title="number | undefined">index</span></a><span class="punctuation">)</span>
        <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#17490"><span data-toggle="tooltip" data-title="string">inp</span></a><span class="punctuation">)</span>
            <a href="parser.html#8237"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, ...nodes: Node[]) =&gt; void">append</span></a><span class="punctuation">(</span><a href="parser.html#17382"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#425"><span data-toggle="tooltip" data-title="(data: string) =&gt; Text">text</span></a><span class="punctuation">(</span><a href="parser.html#17490"><span data-toggle="tooltip" data-title="string">inp</span></a><span class="punctuation">)</span><span class="punctuation">)</span>
    <span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre>
<p>Finds the closing delimiter for an inline element using opening and closing
regex patterns. This works like a parenthesis-matching algorithm: starting
just after the opening delimiter, it searches for the corresponding closing
delimiter, correctly handling nested pairs. Returns the RegExpExecArray for
the closing match, or <code>undefined</code> if no closing delimiter is found.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">function</span> <span id="17608" class="member" data-toggle="tooltip" data-title="(input: string, index: number, openClose: RegExp, allowedOpen: string) =&gt; RegExpExecArray | undefined">findClosingIndex</span><span class="punctuation">(</span><span id="18041" data-toggle="tooltip" data-title="string">input</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">,</span> <span id="18055" data-toggle="tooltip" data-title="number">index</span><span class="punctuation">:</span> <span class="keyword">number</span><span class="punctuation">,</span> <span id="18070" data-toggle="tooltip" data-title="RegExp">openClose</span><span class="punctuation">:</span> <span class="typename" data-toggle="tooltip" data-title="RegExp">RegExp</span><span class="punctuation">,</span>
    <span id="18089" data-toggle="tooltip" data-title="string">allowedOpen</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">)</span><span class="punctuation">:</span> <span class="typename" data-toggle="tooltip" data-title="RegExpExecArray">RegExpExecArray</span> <span class="punctuation">|</span> <span class="keyword">undefined</span> <span class="punctuation">{</span>
    <a href="parser.html#18070"><span data-toggle="tooltip" data-title="RegExp">openClose</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">lastIndex</span> <span class="punctuation">=</span> <a href="parser.html#18055"><span data-toggle="tooltip" data-title="number">index</span></a>
    <span class="keyword">let</span> <span id="18188" data-toggle="tooltip" data-title="RegExpExecArray | null">match</span> <span class="punctuation">=</span> <a href="parser.html#18070"><span data-toggle="tooltip" data-title="RegExp">openClose</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(string: string) =&gt; RegExpExecArray | null">exec</span><span class="punctuation">(</span><a href="parser.html#18041"><span data-toggle="tooltip" data-title="string">input</span></a><span class="punctuation">)</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#18188"><span data-toggle="tooltip" data-title="RegExpExecArray | null">match</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="keyword">let</span> <span class="punctuation">{</span> <span id="18251" data-toggle="tooltip" data-title="string">open</span><span class="punctuation">,</span> <span id="18257" data-toggle="tooltip" data-title="string">close</span> <span class="punctuation">}</span> <span class="punctuation">=</span> <a href="parser.html#18188"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="{ [key: string]: string; } | undefined">groups</span><span class="punctuation">!</span>
        <a href="parser.html#18055"><span data-toggle="tooltip" data-title="number">index</span></a> <span class="punctuation">=</span> <a href="parser.html#18188"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">index</span> <span class="punctuation">+</span> <a href="parser.html#18188"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a><span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span>
        <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#18251"><span data-toggle="tooltip" data-title="string">open</span></a> <span class="punctuation">&amp;&amp;</span> <a href="parser.html#18251"><span data-toggle="tooltip" data-title="string">open</span></a> <span class="punctuation">==</span> <a href="parser.html#18089"><span data-toggle="tooltip" data-title="string">allowedOpen</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
            <span class="keyword">let</span> <span id="18389" data-toggle="tooltip" data-title="RegExpExecArray | undefined">next</span> <span class="punctuation">=</span> <a href="parser.html#17608"><span class="member" data-toggle="tooltip" data-title="(input: string, index: number, openClose: RegExp, allowedOpen: string) =&gt; RegExpExecArray | undefined">findClosingIndex</span></a><span class="punctuation">(</span><a href="parser.html#18041"><span data-toggle="tooltip" data-title="string">input</span></a><span class="punctuation">,</span> <a href="parser.html#18055"><span data-toggle="tooltip" data-title="number">index</span></a><span class="punctuation">,</span> <a href="parser.html#18070"><span data-toggle="tooltip" data-title="RegExp">openClose</span></a><span class="punctuation">,</span> <a href="parser.html#18089"><span data-toggle="tooltip" data-title="string">allowedOpen</span></a><span class="punctuation">)</span>
            <span class="keyword">return</span> <span class="punctuation">!</span><a href="parser.html#18389"><span data-toggle="tooltip" data-title="RegExpExecArray | undefined">next</span></a> <span class="punctuation">?</span> <span data-toggle="tooltip" data-title="undefined">undefined</span> <span class="punctuation">:</span>
                 <a href="parser.html#17608"><span class="member" data-toggle="tooltip" data-title="(input: string, index: number, openClose: RegExp, allowedOpen: string) =&gt; RegExpExecArray | undefined">findClosingIndex</span></a><span class="punctuation">(</span><a href="parser.html#18041"><span data-toggle="tooltip" data-title="string">input</span></a><span class="punctuation">,</span> <a href="parser.html#18389"><span data-toggle="tooltip" data-title="RegExpExecArray">next</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">index</span> <span class="punctuation">+</span> <a href="parser.html#18389"><span data-toggle="tooltip" data-title="RegExpExecArray">next</span></a><span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span><span class="punctuation">,</span> <a href="parser.html#18070"><span data-toggle="tooltip" data-title="RegExp">openClose</span></a><span class="punctuation">,</span>
                    <a href="parser.html#18089"><span data-toggle="tooltip" data-title="string">allowedOpen</span></a><span class="punctuation">)</span>
        <span class="punctuation">}</span>
        <span class="keyword">else</span> <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#18257"><span data-toggle="tooltip" data-title="string">close</span></a><span class="punctuation">)</span>
            <span class="keyword">return</span> <a href="parser.html#18188"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a>
    <span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre>
<h3 id="emphasis-and-strong">Emphasis and Strong</h3>
<p>Helper for creating emphasis (<code>&lt;em&gt;</code>) and strong (<code>&lt;strong&gt;</code>) inline parsers.
This function takes a regular expression for emphasis delimiters (<code>*</code> or <code>_</code>)
and returns a parser that wraps the matched content in the appropriate tag.
The content between delimiters is parsed recursively for inline elements.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">function</span> <span id="18679" class="member" data-toggle="tooltip" data-title="(regexp: string) =&gt; Parser">emOrStrong</span><span class="punctuation">(</span><span id="19065" data-toggle="tooltip" data-title="string">regexp</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">)</span> <span class="punctuation">{</span>
    <span class="keyword">return</span> <a href="parser.html#5755"><span class="member" data-toggle="tooltip" data-title="(matched: Matcher, regexp: string) =&gt; Parser">parser</span></a><span class="punctuation">(</span>
        <span class="punctuation">(</span><span id="19113" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">,</span> <span id="19119" data-toggle="tooltip" data-title="RegExpExecArray">match</span><span class="punctuation">)</span> <span class="punctuation">=&gt;</span> <span class="punctuation">{</span>
            <span class="keyword">let</span> <span class="punctuation">{</span> <span id="19150" data-toggle="tooltip" data-title="string">emdelim</span><span class="punctuation">,</span> <span id="19159" data-toggle="tooltip" data-title="string">em</span> <span class="punctuation">}</span> <span class="punctuation">=</span> <a href="parser.html#19119"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="{ [key: string]: string; } | undefined">groups</span><span class="punctuation">!</span>
            <a href="parser.html#6365"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, element: Element, type: BlockType, leaf?: boolean, parent?: Element, cont?: RegExp, closing?: BlockEvent, continuing?: BlockEvent) =&gt; void">openBlock</span></a><span class="punctuation">(</span><a href="parser.html#19113"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#419"><span data-toggle="tooltip" data-title="&lt;K extends keyof HTMLElementTagNameMap&gt;(tag: K, ...children: Node[]) =&gt; HTMLElementTagNameMap[K]">elem</span></a><span class="punctuation">(</span><a href="parser.html#19150"><span data-toggle="tooltip" data-title="string">emdelim</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span> <span class="punctuation">==</span> <span class="number">1</span> <span class="punctuation">?</span> <span class="string">&#039;em&#039;</span> <span class="punctuation">:</span> <span class="string">&#039;strong&#039;</span><span class="punctuation">)</span><span class="punctuation">,</span> 
                <a href="parser.html#1356"><span class="typename" data-toggle="tooltip" data-title="typeof BlockType">BlockType</span></a><span class="punctuation">.</span><a href="parser.html#2164"><span data-toggle="tooltip" data-title="BlockType.Inline">Inline</span></a><span class="punctuation">)</span>
            <a href="parser.html#31279"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; void">inlines</span></a><span class="punctuation">(</span><a href="parser.html#5966"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, input: string, nextIndex?: number) =&gt; ParserState">stateFrom</span></a><span class="punctuation">(</span><a href="parser.html#19113"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#19159"><span data-toggle="tooltip" data-title="string">em</span></a><span class="punctuation">)</span><span class="punctuation">)</span>
            <a href="parser.html#7275"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; void">closeLastBlock</span></a><span class="punctuation">(</span><a href="parser.html#19113"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">)</span>
        <span class="punctuation">}</span><span class="punctuation">,</span>
        <a href="parser.html#19065"><span data-toggle="tooltip" data-title="string">regexp</span></a><span class="punctuation">)</span>
<span class="punctuation">}</span>
</code></pre>
<h3 id="links">Links</h3>
<p>Creates an HTML anchor element for a Markdown link, sets its href and title,
parses and appends the link text as inline content, and returns the anchor.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">function</span> <span id="19401" class="member" data-toggle="tooltip" data-title="(state: ParserState, linktext: string, linkdest?: string, linktitle?: string) =&gt; HTMLAnchorElement">outputLink</span><span class="punctuation">(</span><span id="19612" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">:</span> <a href="parser.html#5051"><span class="typename" data-toggle="tooltip" data-title="ParserState">ParserState</span></a><span class="punctuation">,</span> <span id="19631" data-toggle="tooltip" data-title="string">linktext</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">,</span> <span id="19649" data-toggle="tooltip" data-title="string | undefined">linkdest</span><span class="punctuation">?</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">,</span> 
    <span id="19668" data-toggle="tooltip" data-title="string | undefined">linktitle</span><span class="punctuation">?</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">)</span><span class="punctuation">:</span> <span class="typename" data-toggle="tooltip" data-title="HTMLAnchorElement">HTMLAnchorElement</span> <span class="punctuation">{</span>
    <span class="keyword">let</span> <span id="19724" data-toggle="tooltip" data-title="HTMLAnchorElement">anchor</span> <span class="punctuation">=</span> <a href="parser.html#419"><span data-toggle="tooltip" data-title="&lt;K extends keyof HTMLElementTagNameMap&gt;(tag: K, ...children: Node[]) =&gt; HTMLElementTagNameMap[K]">elem</span></a><span class="punctuation">(</span><span class="string">&#039;a&#039;</span><span class="punctuation">)</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#19649"><span data-toggle="tooltip" data-title="string | undefined">linkdest</span></a><span class="punctuation">)</span>
        <a href="parser.html#19724"><span data-toggle="tooltip" data-title="HTMLAnchorElement">anchor</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">href</span> <span class="punctuation">=</span> <a href="parser.html#21809"><span class="member" data-toggle="tooltip" data-title="(text?: string) =&gt; string | undefined">replaceEscapes</span></a><span class="punctuation">(</span><a href="parser.html#19649"><span data-toggle="tooltip" data-title="string">linkdest</span></a><span class="punctuation">)</span><span class="punctuation">!</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#19668"><span data-toggle="tooltip" data-title="string | undefined">linktitle</span></a><span class="punctuation">)</span>
        <a href="parser.html#19724"><span data-toggle="tooltip" data-title="HTMLAnchorElement">anchor</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">title</span> <span class="punctuation">=</span> <a href="parser.html#21809"><span class="member" data-toggle="tooltip" data-title="(text?: string) =&gt; string | undefined">replaceEscapes</span></a><span class="punctuation">(</span><a href="parser.html#19668"><span data-toggle="tooltip" data-title="string">linktitle</span></a><span class="punctuation">)</span><span class="punctuation">!</span>
    <a href="parser.html#6365"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, element: Element, type: BlockType, leaf?: boolean, parent?: Element, cont?: RegExp, closing?: BlockEvent, continuing?: BlockEvent) =&gt; void">openBlock</span></a><span class="punctuation">(</span><a href="parser.html#19612"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#19724"><span data-toggle="tooltip" data-title="HTMLAnchorElement">anchor</span></a><span class="punctuation">,</span> <a href="parser.html#1356"><span class="typename" data-toggle="tooltip" data-title="typeof BlockType">BlockType</span></a><span class="punctuation">.</span><a href="parser.html#2164"><span data-toggle="tooltip" data-title="BlockType.Inline">Inline</span></a><span class="punctuation">)</span>
    <a href="parser.html#31279"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; void">inlines</span></a><span class="punctuation">(</span><a href="parser.html#5966"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, input: string, nextIndex?: number) =&gt; ParserState">stateFrom</span></a><span class="punctuation">(</span><a href="parser.html#19612"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#19631"><span data-toggle="tooltip" data-title="string">linktext</span></a><span class="punctuation">)</span><span class="punctuation">)</span>
    <a href="parser.html#7275"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; void">closeLastBlock</span></a><span class="punctuation">(</span><a href="parser.html#19612"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">)</span>
    <span class="keyword">return</span> <a href="parser.html#19724"><span data-toggle="tooltip" data-title="HTMLAnchorElement">anchor</span></a>
<span class="punctuation">}</span>
</code></pre>
<p>Output a reference-style link. If the reference is defined, creates an anchor
with the destination and title. Otherwise, creates a placeholder anchor and
stores it for later resolution.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">function</span> <span id="20020" class="member" data-toggle="tooltip" data-title="(state: ParserState, linklabel: string, linktext: string) =&gt; void">outputReferenceLink</span><span class="punctuation">(</span><span id="20261" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">:</span> <a href="parser.html#5051"><span class="typename" data-toggle="tooltip" data-title="ParserState">ParserState</span></a><span class="punctuation">,</span> <span id="20280" data-toggle="tooltip" data-title="string">linklabel</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">,</span> 
    <span id="20299" data-toggle="tooltip" data-title="string">linktext</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">)</span> <span class="punctuation">{</span>
    <a href="parser.html#20280"><span data-toggle="tooltip" data-title="string">linklabel</span></a> <span class="punctuation">=</span> <a href="parser.html#20280"><span data-toggle="tooltip" data-title="string">linklabel</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="() =&gt; string">toUpperCase</span><span class="punctuation">(</span><span class="punctuation">)</span>
    <span class="keyword">let</span> <span id="20375" data-toggle="tooltip" data-title="LinkRef">linkRef</span> <span class="punctuation">=</span> <a href="parser.html#20261"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5710"><span data-toggle="tooltip" data-title="LinkRefs">linkRefs</span></a><span class="punctuation">[</span><a href="parser.html#20280"><span data-toggle="tooltip" data-title="string">linklabel</span></a><span class="punctuation">]</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#20375"><span data-toggle="tooltip" data-title="LinkRef">linkRef</span></a><span class="punctuation">)</span>
        <a href="parser.html#19401"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, linktext: string, linkdest?: string, linktitle?: string) =&gt; HTMLAnchorElement">outputLink</span></a><span class="punctuation">(</span><a href="parser.html#20261"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#20299"><span data-toggle="tooltip" data-title="string">linktext</span></a><span class="punctuation">,</span> <a href="parser.html#20375"><span data-toggle="tooltip" data-title="LinkRef">linkRef</span></a><span class="punctuation">.</span><a href="parser.html#4788"><span data-toggle="tooltip" data-title="string">destination</span></a><span class="punctuation">,</span> <a href="parser.html#20375"><span data-toggle="tooltip" data-title="LinkRef">linkRef</span></a><span class="punctuation">.</span><a href="parser.html#4813"><span data-toggle="tooltip" data-title="string | undefined">title</span></a><span class="punctuation">)</span>
    <span class="keyword">else</span> <span class="punctuation">{</span>
        <span class="keyword">let</span> <span id="20527" data-toggle="tooltip" data-title="(HTMLImageElement | HTMLAnchorElement)[]">anchors</span> <span class="punctuation">=</span> <a href="parser.html#20261"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5734"><span data-toggle="tooltip" data-title="Links">links</span></a><span class="punctuation">[</span><a href="parser.html#20280"><span data-toggle="tooltip" data-title="string">linklabel</span></a><span class="punctuation">]</span> <span class="punctuation">||</span> <span class="punctuation">[</span><span class="punctuation">]</span>
        <a href="parser.html#20527"><span data-toggle="tooltip" data-title="(HTMLImageElement | HTMLAnchorElement)[]">anchors</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(...items: (HTMLImageElement | HTMLAnchorElement)[]) =&gt; number">push</span><span class="punctuation">(</span><a href="parser.html#19401"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, linktext: string, linkdest?: string, linktitle?: string) =&gt; HTMLAnchorElement">outputLink</span></a><span class="punctuation">(</span><a href="parser.html#20261"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#20299"><span data-toggle="tooltip" data-title="string">linktext</span></a><span class="punctuation">)</span><span class="punctuation">)</span>
        <a href="parser.html#20261"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5734"><span data-toggle="tooltip" data-title="Links">links</span></a><span class="punctuation">[</span><a href="parser.html#20280"><span data-toggle="tooltip" data-title="string">linklabel</span></a><span class="punctuation">]</span> <span class="punctuation">=</span> <a href="parser.html#20527"><span data-toggle="tooltip" data-title="(HTMLImageElement | HTMLAnchorElement)[]">anchors</span></a>
    <span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre>
<h3 id="images">Images</h3>
<p>Creates an <code>&lt;img&gt;</code> element with the given alt text, src, and optional title,
and appends it to the current block.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">function</span> <span id="20669" class="member" data-toggle="tooltip" data-title="(state: ParserState, description: string, imgsrc?: string, imgtitle?: string) =&gt; HTMLImageElement">outputImage</span><span class="punctuation">(</span><span id="20845" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">:</span> <a href="parser.html#5051"><span class="typename" data-toggle="tooltip" data-title="ParserState">ParserState</span></a><span class="punctuation">,</span> <span id="20864" data-toggle="tooltip" data-title="string">description</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">,</span> <span id="20885" data-toggle="tooltip" data-title="string | undefined">imgsrc</span><span class="punctuation">?</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">,</span> 
    <span id="20902" data-toggle="tooltip" data-title="string | undefined">imgtitle</span><span class="punctuation">?</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">)</span><span class="punctuation">:</span> <span class="typename" data-toggle="tooltip" data-title="HTMLImageElement">HTMLImageElement</span> <span class="punctuation">{</span>
    <span class="keyword">let</span> <span id="20956" data-toggle="tooltip" data-title="HTMLImageElement">image</span> <span class="punctuation">=</span> <a href="parser.html#419"><span data-toggle="tooltip" data-title="&lt;K extends keyof HTMLElementTagNameMap&gt;(tag: K, ...children: Node[]) =&gt; HTMLElementTagNameMap[K]">elem</span></a><span class="punctuation">(</span><span class="string">&#039;img&#039;</span><span class="punctuation">)</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#20885"><span data-toggle="tooltip" data-title="string | undefined">imgsrc</span></a><span class="punctuation">)</span>
        <a href="parser.html#20956"><span data-toggle="tooltip" data-title="HTMLImageElement">image</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">src</span> <span class="punctuation">=</span> <a href="parser.html#21809"><span class="member" data-toggle="tooltip" data-title="(text?: string) =&gt; string | undefined">replaceEscapes</span></a><span class="punctuation">(</span><a href="parser.html#20885"><span data-toggle="tooltip" data-title="string">imgsrc</span></a><span class="punctuation">)</span><span class="punctuation">!</span>
    <a href="parser.html#20956"><span data-toggle="tooltip" data-title="HTMLImageElement">image</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">alt</span> <span class="punctuation">=</span> <a href="parser.html#20864"><span data-toggle="tooltip" data-title="string">description</span></a>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#20902"><span data-toggle="tooltip" data-title="string | undefined">imgtitle</span></a><span class="punctuation">)</span>
        <a href="parser.html#20956"><span data-toggle="tooltip" data-title="HTMLImageElement">image</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">title</span> <span class="punctuation">=</span> <a href="parser.html#20902"><span data-toggle="tooltip" data-title="string">imgtitle</span></a>
    <a href="parser.html#8237"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, ...nodes: Node[]) =&gt; void">append</span></a><span class="punctuation">(</span><a href="parser.html#20845"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#20956"><span data-toggle="tooltip" data-title="HTMLImageElement">image</span></a><span class="punctuation">)</span>
    <span class="keyword">return</span> <a href="parser.html#20956"><span data-toggle="tooltip" data-title="HTMLImageElement">image</span></a>
<span class="punctuation">}</span>
</code></pre>
<p>Output a reference-style image. If the reference is defined, creates an
<code>&lt;img&gt;</code> with src and title; otherwise, creates a placeholder image and stores
it for later resolution.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">function</span> <span id="21165" class="member" data-toggle="tooltip" data-title="(state: ParserState, imglabel: string, description: string) =&gt; void">outputReferenceImage</span><span class="punctuation">(</span><span id="21396" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">:</span> <a href="parser.html#5051"><span class="typename" data-toggle="tooltip" data-title="ParserState">ParserState</span></a><span class="punctuation">,</span> <span id="21415" data-toggle="tooltip" data-title="string">imglabel</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">,</span> 
    <span id="21433" data-toggle="tooltip" data-title="string">description</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">)</span> <span class="punctuation">{</span>
    <a href="parser.html#21415"><span data-toggle="tooltip" data-title="string">imglabel</span></a> <span class="punctuation">=</span> <a href="parser.html#21415"><span data-toggle="tooltip" data-title="string">imglabel</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="() =&gt; string">toUpperCase</span><span class="punctuation">(</span><span class="punctuation">)</span>
    <span class="keyword">let</span> <span id="21510" data-toggle="tooltip" data-title="LinkRef">linkRef</span> <span class="punctuation">=</span> <a href="parser.html#21396"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5710"><span data-toggle="tooltip" data-title="LinkRefs">linkRefs</span></a><span class="punctuation">[</span><a href="parser.html#21415"><span data-toggle="tooltip" data-title="string">imglabel</span></a><span class="punctuation">]</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#21510"><span data-toggle="tooltip" data-title="LinkRef">linkRef</span></a><span class="punctuation">)</span>
        <a href="parser.html#20669"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, description: string, imgsrc?: string, imgtitle?: string) =&gt; HTMLImageElement">outputImage</span></a><span class="punctuation">(</span><a href="parser.html#21396"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#21433"><span data-toggle="tooltip" data-title="string">description</span></a><span class="punctuation">,</span> <a href="parser.html#21510"><span data-toggle="tooltip" data-title="LinkRef">linkRef</span></a><span class="punctuation">.</span><a href="parser.html#4788"><span data-toggle="tooltip" data-title="string">destination</span></a><span class="punctuation">,</span> <a href="parser.html#21510"><span data-toggle="tooltip" data-title="LinkRef">linkRef</span></a><span class="punctuation">.</span><a href="parser.html#4813"><span data-toggle="tooltip" data-title="string | undefined">title</span></a><span class="punctuation">)</span>
    <span class="keyword">else</span> <span class="punctuation">{</span>
        <span class="keyword">let</span> <span id="21665" data-toggle="tooltip" data-title="(HTMLImageElement | HTMLAnchorElement)[]">anchors</span> <span class="punctuation">=</span> <a href="parser.html#21396"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5734"><span data-toggle="tooltip" data-title="Links">links</span></a><span class="punctuation">[</span><a href="parser.html#21415"><span data-toggle="tooltip" data-title="string">imglabel</span></a><span class="punctuation">]</span> <span class="punctuation">||</span> <span class="punctuation">[</span><span class="punctuation">]</span>
        <a href="parser.html#21665"><span data-toggle="tooltip" data-title="(HTMLImageElement | HTMLAnchorElement)[]">anchors</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(...items: (HTMLImageElement | HTMLAnchorElement)[]) =&gt; number">push</span><span class="punctuation">(</span><a href="parser.html#20669"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, description: string, imgsrc?: string, imgtitle?: string) =&gt; HTMLImageElement">outputImage</span></a><span class="punctuation">(</span><a href="parser.html#21396"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#21433"><span data-toggle="tooltip" data-title="string">description</span></a><span class="punctuation">)</span><span class="punctuation">)</span>
        <a href="parser.html#21396"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5734"><span data-toggle="tooltip" data-title="Links">links</span></a><span class="punctuation">[</span><a href="parser.html#21415"><span data-toggle="tooltip" data-title="string">imglabel</span></a><span class="punctuation">]</span> <span class="punctuation">=</span> <a href="parser.html#21665"><span data-toggle="tooltip" data-title="(HTMLImageElement | HTMLAnchorElement)[]">anchors</span></a>
    <span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre>
<p>Remove backslashes from escaped characters in a string.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">function</span> <span id="21809" class="member" data-toggle="tooltip" data-title="(text?: string) =&gt; string | undefined">replaceEscapes</span><span class="punctuation">(</span><span id="21905" data-toggle="tooltip" data-title="string | undefined">text</span><span class="punctuation">?</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">)</span><span class="punctuation">:</span> <span class="keyword">string</span> <span class="punctuation">|</span> <span class="keyword">undefined</span> <span class="punctuation">{</span>
    <span class="keyword">return</span> <a href="parser.html#21905"><span data-toggle="tooltip" data-title="string | undefined">text</span></a><span class="punctuation">?.</span><span class="member" data-toggle="tooltip" data-title="{ (searchValue: string | RegExp, replaceValue: string): string; (searchValue: string | RegExp, replacer: (substring: string, ...args: any[]) =&gt; string): string; } | undefined">replaceAll</span><span class="punctuation">(</span><a href="parser.html#13099"><span data-toggle="tooltip" data-title="RegExp">escapes</span></a><span class="punctuation">,</span> <span id="21979" data-toggle="tooltip" data-title="string">str</span> <span class="punctuation">=&gt;</span> <a href="parser.html#21979"><span data-toggle="tooltip" data-title="string">str</span></a><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">)</span>
<span class="punctuation">}</span>
</code></pre>
<p>An array of inline Markdown parsers, each responsible for handling a specific
inline syntax element. Each parser is defined with a matching regular
expression and a matcher function that processes the matched content and
updates the parser state accordingly.</p>
<p>The supported inline elements include:</p>
<ul>
<li>Escapes: Handles backslash-escaped characters and line breaks.</li>
<li>Entities: Handles HTML entities and numeric character references.</li>
<li>Code Spans: Handles inline code delimited by backticks.</li>
<li>Links: Parses Markdown links of the form <code>[text](url)</code> and reference-style
links.</li>
<li>Images: Parses image syntax <code>![alt](src)</code> and reference-style images.</li>
<li>Autolinks: Handles automatic links and email autolinks.</li>
<li>Emphasis &amp; Strong: Handles emphasis (<code>*</code> or <code>_</code>) and strong emphasis
(<code>**</code> or <code>__</code>).</li>
<li>Raw HTML: Passes through raw HTML tags and optionally parses inner content.</li>
</ul>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">const</span> <span id="22954" data-toggle="tooltip" data-title="Parser[]">inlineParsers</span> <span class="punctuation">=</span> <span class="punctuation">[</span>
    <a href="parser.html#5755"><span class="member" data-toggle="tooltip" data-title="(matched: Matcher, regexp: string) =&gt; Parser">parser</span></a><span class="punctuation">(</span>
</code></pre>
<h3 id="escapes">Escapes</h3>
<p>Handles Markdown escape sequences. A backslash before a punctuation
or symbol character escapes it, rendering the character literally. If
the backslash is at the end of a line, it produces a <code>&lt;br&gt;</code> element
instead.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>        <span class="punctuation">(</span><span id="23324" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">,</span> <span id="23330" data-toggle="tooltip" data-title="RegExpExecArray">match</span><span class="punctuation">)</span> <span class="punctuation">=&gt;</span> <span class="punctuation">{</span>
            <span class="keyword">let</span> <span class="punctuation">{</span> <span id="23361" data-toggle="tooltip" data-title="string">esc</span> <span class="punctuation">}</span> <span class="punctuation">=</span> <a href="parser.html#23330"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="{ [key: string]: string; } | undefined">groups</span><span class="punctuation">!</span>
            <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#23361"><span data-toggle="tooltip" data-title="string">esc</span></a> <span class="punctuation">==</span> <span class="string">&quot;\n&quot;</span><span class="punctuation">)</span>
                <a href="parser.html#8237"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, ...nodes: Node[]) =&gt; void">append</span></a><span class="punctuation">(</span><a href="parser.html#23324"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#419"><span data-toggle="tooltip" data-title="&lt;K extends keyof HTMLElementTagNameMap&gt;(tag: K, ...children: Node[]) =&gt; HTMLElementTagNameMap[K]">elem</span></a><span class="punctuation">(</span><span class="string">&#039;br&#039;</span><span class="punctuation">)</span><span class="punctuation">)</span>
            <a href="parser.html#8237"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, ...nodes: Node[]) =&gt; void">append</span></a><span class="punctuation">(</span><a href="parser.html#23324"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#425"><span data-toggle="tooltip" data-title="(data: string) =&gt; Text">text</span></a><span class="punctuation">(</span><a href="parser.html#23361"><span data-toggle="tooltip" data-title="string">esc</span></a><span class="punctuation">)</span><span class="punctuation">)</span>
        <span class="punctuation">}</span><span class="punctuation">,</span>
        <a href="parser.html#13099"><span data-toggle="tooltip" data-title="RegExp">escapes</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">source</span><span class="punctuation">)</span><span class="punctuation">,</span>
    <a href="parser.html#5755"><span class="member" data-toggle="tooltip" data-title="(matched: Matcher, regexp: string) =&gt; Parser">parser</span></a><span class="punctuation">(</span>
</code></pre>
<h3 id="entity-and-numeric-character-references">Entity and Numeric Character References</h3>
<p>Handles HTML entities and numeric character references such as
<code>&amp;amp;</code>, <code>&amp;#123;</code>, and <code>&amp;#x1F600;</code>. These are inserted as text nodes
so that the browser will decode them when rendering.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>        <span class="punctuation">(</span><span id="23871" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">,</span> <span id="23877" data-toggle="tooltip" data-title="RegExpExecArray">match</span><span class="punctuation">)</span> <span class="punctuation">=&gt;</span> <span class="punctuation">{</span>
            <span class="keyword">let</span> <span class="punctuation">{</span> <span id="23908" data-toggle="tooltip" data-title="string">entity</span> <span class="punctuation">}</span> <span class="punctuation">=</span> <a href="parser.html#23877"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="{ [key: string]: string; } | undefined">groups</span><span class="punctuation">!</span>
            <a href="parser.html#8449"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, html: string) =&gt; void">appendHtml</span></a><span class="punctuation">(</span><a href="parser.html#23871"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#23908"><span data-toggle="tooltip" data-title="string">entity</span></a><span class="punctuation">)</span>
        <span class="punctuation">}</span><span class="punctuation">,</span> <a href="parser.html#13173"><span data-toggle="tooltip" data-title="string">entities</span></a><span class="punctuation">)</span><span class="punctuation">,</span>
    <a href="parser.html#5755"><span class="member" data-toggle="tooltip" data-title="(matched: Matcher, regexp: string) =&gt; Parser">parser</span></a><span class="punctuation">(</span>
</code></pre>
<h3 id="code-spans">Code Spans</h3>
<p>Handles inline code spans delimited by backticks, following the main
rules from <a href="https://spec.commonmark.org/0.31.2/#code-spans">section 6.1</a>
of the CommonMark specification:</p>
<ul>
<li>The opening and closing backtick sequences must match in length.</li>
<li>Leading and trailing whitespace inside the code span are trimmed.</li>
<li>Newlines inside code spans are replaced with spaces.</li>
<li>Backticks inside code spans are allowed if multiple backticks open
it.</li>
</ul>
<pre class="syntaxhighlight narrow-scrollbars"><code>        <span class="punctuation">(</span><span id="24633" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">,</span> <span id="24639" data-toggle="tooltip" data-title="RegExpExecArray">match</span><span class="punctuation">)</span> <span class="punctuation">=&gt;</span> <span class="punctuation">{</span>
            <span class="keyword">let</span> <span class="punctuation">{</span> <span id="24670" data-toggle="tooltip" data-title="string">code</span> <span class="punctuation">}</span> <span class="punctuation">=</span> <a href="parser.html#24639"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="{ [key: string]: string; } | undefined">groups</span><span class="punctuation">!</span>
            <a href="parser.html#24670"><span data-toggle="tooltip" data-title="string">code</span></a> <span class="punctuation">=</span> <a href="parser.html#24670"><span data-toggle="tooltip" data-title="string">code</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="{ (searchValue: string | RegExp, replaceValue: string): string; (searchValue: string | RegExp, replacer: (substring: string, ...args: any[]) =&gt; string): string; }">replaceAll</span><span class="punctuation">(</span><span class="string">&quot;\n&quot;</span><span class="punctuation">,</span> <span class="string">&quot; &quot;</span><span class="punctuation">)</span>
            <span class="keyword">let</span> <span id="24757" data-toggle="tooltip" data-title="RegExpExecArray | null">trim</span> <span class="punctuation">=</span> <span class="string">/^ (.*[^ ].*) $/</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(string: string) =&gt; RegExpExecArray | null">exec</span><span class="punctuation">(</span><a href="parser.html#24670"><span data-toggle="tooltip" data-title="string">code</span></a><span class="punctuation">)</span>
            <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#24757"><span data-toggle="tooltip" data-title="RegExpExecArray | null">trim</span></a><span class="punctuation">)</span>
                <a href="parser.html#24670"><span data-toggle="tooltip" data-title="string">code</span></a> <span class="punctuation">=</span> <a href="parser.html#24757"><span data-toggle="tooltip" data-title="RegExpExecArray">trim</span></a><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span>
            <a href="parser.html#8237"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, ...nodes: Node[]) =&gt; void">append</span></a><span class="punctuation">(</span><a href="parser.html#24633"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#419"><span data-toggle="tooltip" data-title="&lt;K extends keyof HTMLElementTagNameMap&gt;(tag: K, ...children: Node[]) =&gt; HTMLElementTagNameMap[K]">elem</span></a><span class="punctuation">(</span><span class="string">&#039;code&#039;</span><span class="punctuation">,</span> <a href="parser.html#425"><span data-toggle="tooltip" data-title="(data: string) =&gt; Text">text</span></a><span class="punctuation">(</span><a href="parser.html#24670"><span data-toggle="tooltip" data-title="string">code</span></a><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span>
        <span class="punctuation">}</span><span class="punctuation">,</span> <a href="parser.html#13419"><span data-toggle="tooltip" data-title="string">codeSpan</span></a><span class="punctuation">)</span><span class="punctuation">,</span>
    <a href="parser.html#5755"><span class="member" data-toggle="tooltip" data-title="(matched: Matcher, regexp: string) =&gt; Parser">parser</span></a><span class="punctuation">(</span>
</code></pre>
<h3 id="links-1">Links</h3>
<p>Handles Markdown links in the format <code>[text](url)</code> as well as
reference-style links. This parser supports inline links, full
reference links, and collapsed reference links. Escaped brackets and
parentheses are unescaped in both the link text and destination. If a
reference is not defined, a placeholder anchor is created for later
resolution.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>        <span class="punctuation">(</span><span id="25428" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">,</span> <span id="25434" data-toggle="tooltip" data-title="RegExpExecArray">match</span><span class="punctuation">)</span> <span class="punctuation">=&gt;</span> <span class="punctuation">{</span>
            <span class="keyword">let</span> <span id="25463" data-toggle="tooltip" data-title="RegExpExecArray | undefined">close</span> <span class="punctuation">=</span> <a href="parser.html#17608"><span class="member" data-toggle="tooltip" data-title="(input: string, index: number, openClose: RegExp, allowedOpen: string) =&gt; RegExpExecArray | undefined">findClosingIndex</span></a><span class="punctuation">(</span><a href="parser.html#25428"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5639"><span data-toggle="tooltip" data-title="string">input</span></a><span class="punctuation">,</span> <a href="parser.html#25428"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5658"><span data-toggle="tooltip" data-title="number">nextIndex</span></a><span class="punctuation">,</span>
                <a href="parser.html#14610"><span data-toggle="tooltip" data-title="RegExp">linkOrImageTextOpenClose</span></a><span class="punctuation">,</span> <span class="string">&quot;![&quot;</span><span class="punctuation">)</span>
            <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#25463"><span data-toggle="tooltip" data-title="RegExpExecArray | undefined">close</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
                <span class="keyword">let</span> <span id="25614" data-toggle="tooltip" data-title="string">linktext</span> <span class="punctuation">=</span> <a href="parser.html#25428"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5639"><span data-toggle="tooltip" data-title="string">input</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(start: number, end?: number) =&gt; string">substring</span><span class="punctuation">(</span><a href="parser.html#25428"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5658"><span data-toggle="tooltip" data-title="number">nextIndex</span></a><span class="punctuation">,</span> 
                    <a href="parser.html#25463"><span data-toggle="tooltip" data-title="RegExpExecArray">close</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">index</span><span class="punctuation">)</span>
                <a href="parser.html#25428"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5658"><span data-toggle="tooltip" data-title="number">nextIndex</span></a> <span class="punctuation">=</span> <a href="parser.html#25463"><span data-toggle="tooltip" data-title="RegExpExecArray">close</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">index</span> <span class="punctuation">+</span> <a href="parser.html#25463"><span data-toggle="tooltip" data-title="RegExpExecArray">close</span></a><span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span>
                <span class="keyword">switch</span> <span class="punctuation">(</span><a href="parser.html#25428"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5639"><span data-toggle="tooltip" data-title="string">input</span></a><span class="punctuation">[</span><a href="parser.html#25428"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5658"><span data-toggle="tooltip" data-title="number">nextIndex</span></a><span class="punctuation">]</span><span class="punctuation">)</span> <span class="punctuation">{</span>
                    <span class="keyword">case</span> <span class="string">&quot;(&quot;</span><span class="punctuation">:</span>
                        <span class="keyword">let</span> <span id="25881" data-toggle="tooltip" data-title="RegExpExecArray | null">dest</span> <span class="punctuation">=</span> <a href="parser.html#10283"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, regexp: RegExp) =&gt; RegExpExecArray | null">parseRegExp</span></a><span class="punctuation">(</span><a href="parser.html#25428"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#14703"><span data-toggle="tooltip" data-title="RegExp">inlineLink</span></a><span class="punctuation">)</span>
                        <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#25881"><span data-toggle="tooltip" data-title="RegExpExecArray | null">dest</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
                            <span class="keyword">let</span> <span class="punctuation">{</span> <span id="25991" data-toggle="tooltip" data-title="string">linkdest</span><span class="punctuation">,</span> <span id="26001" data-toggle="tooltip" data-title="string">linktitle</span> <span class="punctuation">}</span> <span class="punctuation">=</span> <a href="parser.html#25881"><span data-toggle="tooltip" data-title="RegExpExecArray">dest</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="{ [key: string]: string; } | undefined">groups</span><span class="punctuation">!</span>
                            <span class="keyword">return</span> <a href="parser.html#19401"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, linktext: string, linkdest?: string, linktitle?: string) =&gt; HTMLAnchorElement">outputLink</span></a><span class="punctuation">(</span><a href="parser.html#25428"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#25614"><span data-toggle="tooltip" data-title="string">linktext</span></a><span class="punctuation">,</span> <a href="parser.html#25991"><span data-toggle="tooltip" data-title="string">linkdest</span></a><span class="punctuation">,</span> 
                                <a href="parser.html#26001"><span data-toggle="tooltip" data-title="string">linktitle</span></a><span class="punctuation">)</span>
                        <span class="punctuation">}</span>
                        <span class="keyword">break</span>
                    <span class="keyword">case</span> <span class="string">&quot;[&quot;</span><span class="punctuation">:</span>
                        <span class="keyword">let</span> <span id="26265" data-toggle="tooltip" data-title="RegExpExecArray | null">fullref</span>  <span class="punctuation">=</span> <a href="parser.html#10283"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, regexp: RegExp) =&gt; RegExpExecArray | null">parseRegExp</span></a><span class="punctuation">(</span><a href="parser.html#25428"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#14792"><span data-toggle="tooltip" data-title="RegExp">fullReferenceLink</span></a><span class="punctuation">)</span>
                        <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#26265"><span data-toggle="tooltip" data-title="RegExpExecArray | null">fullref</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
                            <span class="keyword">let</span> <span class="punctuation">{</span> <span id="26389" data-toggle="tooltip" data-title="string">linklabel</span> <span class="punctuation">}</span> <span class="punctuation">=</span> <a href="parser.html#26265"><span data-toggle="tooltip" data-title="RegExpExecArray">fullref</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="{ [key: string]: string; } | undefined">groups</span><span class="punctuation">!</span>
                            <span class="keyword">return</span> <a href="parser.html#20020"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, linklabel: string, linktext: string) =&gt; void">outputReferenceLink</span></a><span class="punctuation">(</span><a href="parser.html#25428"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#26389"><span data-toggle="tooltip" data-title="string">linklabel</span></a><span class="punctuation">,</span> 
                                <a href="parser.html#25614"><span data-toggle="tooltip" data-title="string">linktext</span></a><span class="punctuation">)</span>
                        <span class="punctuation">}</span>
                    <span class="keyword">default</span><span class="punctuation">:</span>
                        <span class="keyword">let</span> <span id="26623" data-toggle="tooltip" data-title="RegExpExecArray | null">collap</span> <span class="punctuation">=</span> <a href="parser.html#10283"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, regexp: RegExp) =&gt; RegExpExecArray | null">parseRegExp</span></a><span class="punctuation">(</span><a href="parser.html#25428"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#14849"><span data-toggle="tooltip" data-title="RegExp">collapsedReferenceLink</span></a><span class="punctuation">)</span>
                        <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#26623"><span data-toggle="tooltip" data-title="RegExpExecArray | null">collap</span></a><span class="punctuation">)</span>
                            <span class="keyword">return</span> <a href="parser.html#20020"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, linklabel: string, linktext: string) =&gt; void">outputReferenceLink</span></a><span class="punctuation">(</span><a href="parser.html#25428"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#25614"><span data-toggle="tooltip" data-title="string">linktext</span></a><span class="punctuation">,</span> 
                                <a href="parser.html#25614"><span data-toggle="tooltip" data-title="string">linktext</span></a><span class="punctuation">)</span>
                <span class="punctuation">}</span>
                <a href="parser.html#25428"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5658"><span data-toggle="tooltip" data-title="number">nextIndex</span></a> <span class="punctuation">=</span> <a href="parser.html#25434"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">index</span> <span class="punctuation">+</span> <a href="parser.html#25434"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a><span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span>
            <span class="punctuation">}</span>
            <a href="parser.html#8237"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, ...nodes: Node[]) =&gt; void">append</span></a><span class="punctuation">(</span><a href="parser.html#25428"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#425"><span data-toggle="tooltip" data-title="(data: string) =&gt; Text">text</span></a><span class="punctuation">(</span><a href="parser.html#25434"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a><span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">)</span>
        <span class="punctuation">}</span><span class="punctuation">,</span> <a href="parser.html#14413"><span data-toggle="tooltip" data-title="string">linkTextOpen</span></a><span class="punctuation">)</span><span class="punctuation">,</span>
    <a href="parser.html#5755"><span class="member" data-toggle="tooltip" data-title="(matched: Matcher, regexp: string) =&gt; Parser">parser</span></a><span class="punctuation">(</span>
</code></pre>
<h3 id="images-1">Images</h3>
<p>Handles Markdown image syntax of the form <code>![alt](src)</code> and
reference-style images. This parser extracts the alt text and image
source, unescapes any escaped brackets or parentheses, and creates an
<code>&lt;img&gt;</code> element with the appropriate <code>alt</code>, <code>src</code>, and optional
<code>title</code> attributes. If a reference is not defined, a placeholder
image is created for later resolution.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>        <span class="punctuation">(</span><span id="27526" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">,</span> <span id="27532" data-toggle="tooltip" data-title="RegExpExecArray">match</span><span class="punctuation">)</span> <span class="punctuation">=&gt;</span> <span class="punctuation">{</span>
            <span class="keyword">let</span> <span id="27561" data-toggle="tooltip" data-title="RegExpExecArray | undefined">close</span> <span class="punctuation">=</span> <a href="parser.html#17608"><span class="member" data-toggle="tooltip" data-title="(input: string, index: number, openClose: RegExp, allowedOpen: string) =&gt; RegExpExecArray | undefined">findClosingIndex</span></a><span class="punctuation">(</span><a href="parser.html#27526"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5639"><span data-toggle="tooltip" data-title="string">input</span></a><span class="punctuation">,</span> <a href="parser.html#27526"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5658"><span data-toggle="tooltip" data-title="number">nextIndex</span></a><span class="punctuation">,</span>
                <a href="parser.html#14610"><span data-toggle="tooltip" data-title="RegExp">linkOrImageTextOpenClose</span></a><span class="punctuation">,</span> <span class="string">&quot;[&quot;</span><span class="punctuation">)</span>
            <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#27561"><span data-toggle="tooltip" data-title="RegExpExecArray | undefined">close</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
                <span class="keyword">let</span> <span id="27711" data-toggle="tooltip" data-title="string">description</span> <span class="punctuation">=</span> <a href="parser.html#27526"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5639"><span data-toggle="tooltip" data-title="string">input</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(start: number, end?: number) =&gt; string">substring</span><span class="punctuation">(</span><a href="parser.html#27526"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5658"><span data-toggle="tooltip" data-title="number">nextIndex</span></a><span class="punctuation">,</span> 
                    <a href="parser.html#27561"><span data-toggle="tooltip" data-title="RegExpExecArray">close</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">index</span><span class="punctuation">)</span>
                <a href="parser.html#27526"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5658"><span data-toggle="tooltip" data-title="number">nextIndex</span></a> <span class="punctuation">=</span> <a href="parser.html#27561"><span data-toggle="tooltip" data-title="RegExpExecArray">close</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">index</span> <span class="punctuation">+</span> <a href="parser.html#27561"><span data-toggle="tooltip" data-title="RegExpExecArray">close</span></a><span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span>
                <span class="keyword">switch</span> <span class="punctuation">(</span><a href="parser.html#27526"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5639"><span data-toggle="tooltip" data-title="string">input</span></a><span class="punctuation">[</span><a href="parser.html#27526"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5658"><span data-toggle="tooltip" data-title="number">nextIndex</span></a><span class="punctuation">]</span><span class="punctuation">)</span> <span class="punctuation">{</span>
                    <span class="keyword">case</span> <span class="string">&quot;(&quot;</span><span class="punctuation">:</span>
                        <span class="keyword">let</span> <span id="27981" data-toggle="tooltip" data-title="RegExpExecArray | null">dest</span> <span class="punctuation">=</span> <a href="parser.html#10283"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, regexp: RegExp) =&gt; RegExpExecArray | null">parseRegExp</span></a><span class="punctuation">(</span><a href="parser.html#27526"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#14703"><span data-toggle="tooltip" data-title="RegExp">inlineLink</span></a><span class="punctuation">)</span>
                        <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#27981"><span data-toggle="tooltip" data-title="RegExpExecArray | null">dest</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
                            <span class="keyword">let</span> <span class="punctuation">{</span> <span id="28091" data-toggle="tooltip" data-title="string">linkdest</span><span class="punctuation">,</span> <span id="28101" data-toggle="tooltip" data-title="string">linktitle</span> <span class="punctuation">}</span> <span class="punctuation">=</span> <a href="parser.html#27981"><span data-toggle="tooltip" data-title="RegExpExecArray">dest</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="{ [key: string]: string; } | undefined">groups</span><span class="punctuation">!</span>
                            <span class="keyword">return</span> <a href="parser.html#20669"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, description: string, imgsrc?: string, imgtitle?: string) =&gt; HTMLImageElement">outputImage</span></a><span class="punctuation">(</span><a href="parser.html#27526"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#27711"><span data-toggle="tooltip" data-title="string">description</span></a><span class="punctuation">,</span> <a href="parser.html#28091"><span data-toggle="tooltip" data-title="string">linkdest</span></a><span class="punctuation">,</span> 
                                <a href="parser.html#28101"><span data-toggle="tooltip" data-title="string">linktitle</span></a><span class="punctuation">)</span>
                        <span class="punctuation">}</span>
                        <span class="keyword">break</span>
                    <span class="keyword">case</span> <span class="string">&quot;[&quot;</span><span class="punctuation">:</span>
                        <span class="keyword">let</span> <span id="28369" data-toggle="tooltip" data-title="RegExpExecArray | null">fullref</span>  <span class="punctuation">=</span> <a href="parser.html#10283"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, regexp: RegExp) =&gt; RegExpExecArray | null">parseRegExp</span></a><span class="punctuation">(</span><a href="parser.html#27526"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#14792"><span data-toggle="tooltip" data-title="RegExp">fullReferenceLink</span></a><span class="punctuation">)</span>
                        <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#28369"><span data-toggle="tooltip" data-title="RegExpExecArray | null">fullref</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
                            <span class="keyword">let</span> <span class="punctuation">{</span> <span id="28493" data-toggle="tooltip" data-title="string">linklabel</span> <span class="punctuation">}</span> <span class="punctuation">=</span> <a href="parser.html#28369"><span data-toggle="tooltip" data-title="RegExpExecArray">fullref</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="{ [key: string]: string; } | undefined">groups</span><span class="punctuation">!</span>
                            <span class="keyword">return</span> <a href="parser.html#21165"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, imglabel: string, description: string) =&gt; void">outputReferenceImage</span></a><span class="punctuation">(</span><a href="parser.html#27526"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#28493"><span data-toggle="tooltip" data-title="string">linklabel</span></a><span class="punctuation">,</span> 
                                <a href="parser.html#27711"><span data-toggle="tooltip" data-title="string">description</span></a><span class="punctuation">)</span>
                        <span class="punctuation">}</span>
                    <span class="keyword">default</span><span class="punctuation">:</span>
                        <span class="keyword">let</span> <span id="28731" data-toggle="tooltip" data-title="RegExpExecArray | null">collap</span> <span class="punctuation">=</span> <a href="parser.html#10283"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, regexp: RegExp) =&gt; RegExpExecArray | null">parseRegExp</span></a><span class="punctuation">(</span><a href="parser.html#27526"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#14849"><span data-toggle="tooltip" data-title="RegExp">collapsedReferenceLink</span></a><span class="punctuation">)</span>
                        <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#28731"><span data-toggle="tooltip" data-title="RegExpExecArray | null">collap</span></a><span class="punctuation">)</span>
                            <span class="keyword">return</span> <a href="parser.html#21165"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, imglabel: string, description: string) =&gt; void">outputReferenceImage</span></a><span class="punctuation">(</span><a href="parser.html#27526"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#27711"><span data-toggle="tooltip" data-title="string">description</span></a><span class="punctuation">,</span> 
                                <a href="parser.html#27711"><span data-toggle="tooltip" data-title="string">description</span></a><span class="punctuation">)</span>
                <span class="punctuation">}</span>
                <a href="parser.html#27526"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5658"><span data-toggle="tooltip" data-title="number">nextIndex</span></a> <span class="punctuation">=</span> <a href="parser.html#27532"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">index</span> <span class="punctuation">+</span> <a href="parser.html#27532"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a><span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span>
            <span class="punctuation">}</span>
            <a href="parser.html#8237"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, ...nodes: Node[]) =&gt; void">append</span></a><span class="punctuation">(</span><a href="parser.html#27526"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#425"><span data-toggle="tooltip" data-title="(data: string) =&gt; Text">text</span></a><span class="punctuation">(</span><a href="parser.html#27532"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a><span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">)</span>
        <span class="punctuation">}</span><span class="punctuation">,</span> <a href="parser.html#14454"><span data-toggle="tooltip" data-title="string">imageTextOpen</span></a><span class="punctuation">)</span><span class="punctuation">,</span>
    <a href="parser.html#5755"><span class="member" data-toggle="tooltip" data-title="(matched: Matcher, regexp: string) =&gt; Parser">parser</span></a><span class="punctuation">(</span>
</code></pre>
<h3 id="autolinks">Autolinks</h3>
<p>Matches automatic links in the form <code>&lt;scheme:...&gt;</code>, where <code>scheme</code> is
a valid URI scheme. Creates an anchor (<code>&lt;a&gt;</code>) element with the
matched URL as both the href and text content.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>        <span class="punctuation">(</span><span id="29420" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">,</span> <span id="29426" data-toggle="tooltip" data-title="RegExpExecArray">match</span><span class="punctuation">)</span> <span class="punctuation">=&gt;</span> <span class="punctuation">{</span>
            <span class="keyword">let</span> <span class="punctuation">{</span> <span id="29457" data-toggle="tooltip" data-title="string">autolink</span> <span class="punctuation">}</span> <span class="punctuation">=</span> <a href="parser.html#29426"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="{ [key: string]: string; } | undefined">groups</span><span class="punctuation">!</span>
            <span class="keyword">let</span> <span id="29501" data-toggle="tooltip" data-title="HTMLAnchorElement">link</span> <span class="punctuation">=</span> <a href="parser.html#419"><span data-toggle="tooltip" data-title="&lt;K extends keyof HTMLElementTagNameMap&gt;(tag: K, ...children: Node[]) =&gt; HTMLElementTagNameMap[K]">elem</span></a><span class="punctuation">(</span><span class="string">&#039;a&#039;</span><span class="punctuation">,</span> <a href="parser.html#425"><span data-toggle="tooltip" data-title="(data: string) =&gt; Text">text</span></a><span class="punctuation">(</span><a href="parser.html#29457"><span data-toggle="tooltip" data-title="string">autolink</span></a><span class="punctuation">)</span><span class="punctuation">)</span>
            <a href="parser.html#29501"><span data-toggle="tooltip" data-title="HTMLAnchorElement">link</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">href</span> <span class="punctuation">=</span> <a href="parser.html#29457"><span data-toggle="tooltip" data-title="string">autolink</span></a>
            <a href="parser.html#8237"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, ...nodes: Node[]) =&gt; void">append</span></a><span class="punctuation">(</span><a href="parser.html#29420"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#29501"><span data-toggle="tooltip" data-title="HTMLAnchorElement">link</span></a><span class="punctuation">)</span>
        <span class="punctuation">}</span><span class="punctuation">,</span> <a href="parser.html#14905"><span data-toggle="tooltip" data-title="string">autoLink</span></a><span class="punctuation">)</span><span class="punctuation">,</span>
    <a href="parser.html#5755"><span class="member" data-toggle="tooltip" data-title="(matched: Matcher, regexp: string) =&gt; Parser">parser</span></a><span class="punctuation">(</span>
</code></pre>
<h3 id="email-autolinks">Email Autolinks</h3>
<p>Matches email addresses enclosed in angle brackets and creates a
mailto link (<code>&lt;a href=&quot;mailto:...&quot;&gt;</code>). The email address is used
as both the link text and the mailto target.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>        <span class="punctuation">(</span><span id="29929" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">,</span> <span id="29935" data-toggle="tooltip" data-title="RegExpExecArray">match</span><span class="punctuation">)</span> <span class="punctuation">=&gt;</span> <span class="punctuation">{</span>
            <span class="keyword">let</span> <span class="punctuation">{</span> <span id="29966" data-toggle="tooltip" data-title="string">email</span> <span class="punctuation">}</span> <span class="punctuation">=</span> <a href="parser.html#29935"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="{ [key: string]: string; } | undefined">groups</span><span class="punctuation">!</span>
            <span class="keyword">let</span> <span id="30007" data-toggle="tooltip" data-title="HTMLAnchorElement">link</span> <span class="punctuation">=</span> <a href="parser.html#419"><span data-toggle="tooltip" data-title="&lt;K extends keyof HTMLElementTagNameMap&gt;(tag: K, ...children: Node[]) =&gt; HTMLElementTagNameMap[K]">elem</span></a><span class="punctuation">(</span><span class="string">&#039;a&#039;</span><span class="punctuation">,</span> <a href="parser.html#425"><span data-toggle="tooltip" data-title="(data: string) =&gt; Text">text</span></a><span class="punctuation">(</span><a href="parser.html#29966"><span data-toggle="tooltip" data-title="string">email</span></a><span class="punctuation">)</span><span class="punctuation">)</span>
            <a href="parser.html#30007"><span data-toggle="tooltip" data-title="HTMLAnchorElement">link</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">href</span> <span class="punctuation">=</span> <span class="string">&quot;mailto:&quot;</span> <span class="punctuation">+</span> <a href="parser.html#29966"><span data-toggle="tooltip" data-title="string">email</span></a>
            <a href="parser.html#8237"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, ...nodes: Node[]) =&gt; void">append</span></a><span class="punctuation">(</span><a href="parser.html#29929"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#30007"><span data-toggle="tooltip" data-title="HTMLAnchorElement">link</span></a><span class="punctuation">)</span>
        <span class="punctuation">}</span><span class="punctuation">,</span> <a href="parser.html#14988"><span data-toggle="tooltip" data-title="string">emailAutoLink</span></a><span class="punctuation">)</span><span class="punctuation">,</span>
    <a href="parser.html#18679"><span class="member" data-toggle="tooltip" data-title="(regexp: string) =&gt; Parser">emOrStrong</span></a><span class="punctuation">(</span><a href="parser.html#13520"><span data-toggle="tooltip" data-title="string">emAsterisk</span></a><span class="punctuation">)</span><span class="punctuation">,</span>
    <a href="parser.html#18679"><span class="member" data-toggle="tooltip" data-title="(regexp: string) =&gt; Parser">emOrStrong</span></a><span class="punctuation">(</span><a href="parser.html#13779"><span data-toggle="tooltip" data-title="string">emUnderscore</span></a><span class="punctuation">)</span><span class="punctuation">,</span>
    <a href="parser.html#5755"><span class="member" data-toggle="tooltip" data-title="(matched: Matcher, regexp: string) =&gt; Parser">parser</span></a><span class="punctuation">(</span>
</code></pre>
<h3 id="raw-html">Raw HTML</h3>
<p>Passes through raw HTML tags and their content. This parser matches
HTML tags (including self-closing tags) and, if the tag contains
inner content and a matching closing tag, parses the inner content as
inline Markdown. Otherwise, the tag is inserted as raw HTML into the
output.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>        <span class="punctuation">(</span><span id="30631" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">,</span> <span id="30637" data-toggle="tooltip" data-title="RegExpExecArray">match</span><span class="punctuation">)</span> <span class="punctuation">=&gt;</span> <span class="punctuation">{</span>
            <span class="keyword">let</span> <span class="punctuation">{</span> <span id="30668" data-toggle="tooltip" data-title="string">tagstart</span><span class="punctuation">,</span> <span id="30678" data-toggle="tooltip" data-title="string">tagend</span><span class="punctuation">,</span> <span id="30686" data-toggle="tooltip" data-title="string">innerhtml</span> <span class="punctuation">}</span> <span class="punctuation">=</span> <a href="parser.html#30637"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="{ [key: string]: string; } | undefined">groups</span><span class="punctuation">!</span>
            <a href="parser.html#8449"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, html: string) =&gt; void">appendHtml</span></a><span class="punctuation">(</span><a href="parser.html#30631"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#30668"><span data-toggle="tooltip" data-title="string">tagstart</span></a> <span class="punctuation">+</span> <a href="parser.html#30678"><span data-toggle="tooltip" data-title="string">tagend</span></a><span class="punctuation">)</span>
            <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#30678"><span data-toggle="tooltip" data-title="string">tagend</span></a> <span class="punctuation">==</span> <span class="string">&quot;&gt;&quot;</span> <span class="punctuation">&amp;&amp;</span> <a href="parser.html#30686"><span data-toggle="tooltip" data-title="string">innerhtml</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
                <a href="parser.html#6365"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, element: Element, type: BlockType, leaf?: boolean, parent?: Element, cont?: RegExp, closing?: BlockEvent, continuing?: BlockEvent) =&gt; void">openBlock</span></a><span class="punctuation">(</span><a href="parser.html#30631"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#7643"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; DocumentBlock">lastBlock</span></a><span class="punctuation">(</span><a href="parser.html#30631"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">)</span><span class="punctuation">.</span><a href="parser.html#2536"><span data-toggle="tooltip" data-title="Element">parent</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="Element | null">lastElementChild</span><span class="punctuation">!</span><span class="punctuation">,</span>
                    <a href="parser.html#1356"><span class="typename" data-toggle="tooltip" data-title="typeof BlockType">BlockType</span></a><span class="punctuation">.</span><a href="parser.html#2164"><span data-toggle="tooltip" data-title="BlockType.Inline">Inline</span></a><span class="punctuation">)</span>
                <a href="parser.html#31279"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; void">inlines</span></a><span class="punctuation">(</span><a href="parser.html#5966"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, input: string, nextIndex?: number) =&gt; ParserState">stateFrom</span></a><span class="punctuation">(</span><a href="parser.html#30631"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#30686"><span data-toggle="tooltip" data-title="string">innerhtml</span></a><span class="punctuation">)</span><span class="punctuation">)</span>
                <a href="parser.html#7275"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; void">closeLastBlock</span></a><span class="punctuation">(</span><a href="parser.html#30631"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">)</span>
            <span class="punctuation">}</span>
        <span class="punctuation">}</span><span class="punctuation">,</span> <a href="parser.html#15163"><span data-toggle="tooltip" data-title="string">rawHtml</span></a><span class="punctuation">)</span>
<span class="punctuation">]</span>
</code></pre>
<p>We initialize the combined regexp when it is first used. Thus we can register
new inline parsers before calling the parser. After that the list of parsers
is locked down.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">let</span> <span id="31258" data-toggle="tooltip" data-title="RegExp">inlineRegexp</span><span class="punctuation">:</span> <span class="typename" data-toggle="tooltip" data-title="RegExp">RegExp</span>
</code></pre>
<p>This function repeatedly applies inline parsers using a regular expression
matcher until no more matches are found. After all inline elements have been
parsed, it flushes any remaining inline content in the parser state.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">function</span> <span id="31279" class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; void">inlines</span><span class="punctuation">(</span><span id="31542" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">:</span> <a href="parser.html#5051"><span class="typename" data-toggle="tooltip" data-title="ParserState">ParserState</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><span class="string">/^\s*$/</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(string: string) =&gt; boolean">test</span><span class="punctuation">(</span><a href="parser.html#31542"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5639"><span data-toggle="tooltip" data-title="string">input</span></a><span class="punctuation">)</span><span class="punctuation">)</span>
        <span class="keyword">return</span>
    <a href="parser.html#31258"><span data-toggle="tooltip" data-title="RegExp">inlineRegexp</span></a> <span class="punctuation">=</span> <a href="parser.html#31258"><span data-toggle="tooltip" data-title="RegExp">inlineRegexp</span></a> <span class="punctuation">||</span> <a href="parser.html#9230"><span class="member" data-toggle="tooltip" data-title="(parsers: Parser[], sticky: boolean) =&gt; RegExp">regexpFor</span></a><span class="punctuation">(</span><a href="parser.html#22954"><span data-toggle="tooltip" data-title="Parser[]">inlineParsers</span></a><span class="punctuation">,</span> <span class="keyword">false</span><span class="punctuation">)</span>
    <span class="keyword">while</span> <span class="punctuation">(</span><a href="parser.html#10688"><span class="member" data-toggle="tooltip" data-title="(regexp: RegExp, parsers: Parser[], state: ParserState, inline: boolean) =&gt; boolean">parseNext</span></a><span class="punctuation">(</span><a href="parser.html#31258"><span data-toggle="tooltip" data-title="RegExp">inlineRegexp</span></a><span class="punctuation">,</span> <a href="parser.html#22954"><span data-toggle="tooltip" data-title="Parser[]">inlineParsers</span></a><span class="punctuation">,</span> <a href="parser.html#31542"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <span class="keyword">true</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
    <a href="parser.html#16959"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, index?: number) =&gt; void">flushInline</span></a><span class="punctuation">(</span><a href="parser.html#31542"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">)</span>
<span class="punctuation">}</span>
</code></pre>
<h2 id="block-parsers">Block Parsers</h2>
<p>Block parsers match block-level Markdown elements using regular expressions
and associated matcher functions. Each block parser processes one line at a
time, handling elements like headings, lists, code blocks, block quotes, and
paragraphs.</p>
<h3 id="lists">Lists</h3>
<p>The function below opens a new list or list item block when a list marker is
detected. It determines the correct list type (<code>&lt;ul&gt;</code> or <code>&lt;ol&gt;</code>), manages
continuation and tight/loose list logic, and updates the parser state
accordingly.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">function</span> <span id="31776" class="member" data-toggle="tooltip" data-title="(state: ParserState, match: RegExpExecArray, bulletsep: string, bulletno?: string) =&gt; void">openList</span><span class="punctuation">(</span><span id="32368" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">:</span> <a href="parser.html#5051"><span class="typename" data-toggle="tooltip" data-title="ParserState">ParserState</span></a><span class="punctuation">,</span> <span id="32387" data-toggle="tooltip" data-title="RegExpExecArray">match</span><span class="punctuation">:</span> <span class="typename" data-toggle="tooltip" data-title="RegExpExecArray">RegExpExecArray</span><span class="punctuation">,</span> <span id="32411" data-toggle="tooltip" data-title="string">bulletsep</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">,</span> 
    <span id="32430" data-toggle="tooltip" data-title="string | undefined">bulletno</span><span class="punctuation">?</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">)</span> <span class="punctuation">{</span>
    <span class="keyword">let</span> <span id="32466" data-toggle="tooltip" data-title="string">prefix</span> <span class="punctuation">=</span> <a href="parser.html#32387"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a><span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span>
    <span class="keyword">let</span> <span id="32493" data-toggle="tooltip" data-title="string">allowEmpty</span> <span class="punctuation">=</span> <a href="parser.html#32387"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">index</span> <span class="punctuation">+</span> <a href="parser.html#32466"><span data-toggle="tooltip" data-title="string">prefix</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span> <span class="punctuation">&gt;=</span> <a href="parser.html#32368"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5639"><span data-toggle="tooltip" data-title="string">input</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span> <span class="punctuation">?</span>
        <span class="string">&quot;&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;|\\s*$&quot;</span>
    <span class="keyword">let</span> <span id="32590" data-toggle="tooltip" data-title="number">lastIndex</span> <span class="punctuation">=</span> <a href="parser.html#32368"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5681"><span data-toggle="tooltip" data-title="DocumentBlock[]">blocks</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span> <span class="punctuation">-</span> <span class="number">1</span>
    <span class="keyword">let</span> <span id="32635" data-toggle="tooltip" data-title="DocumentBlock">last</span> <span class="punctuation">=</span> <a href="parser.html#32368"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5681"><span data-toggle="tooltip" data-title="DocumentBlock[]">blocks</span></a><span class="punctuation">[</span><a href="parser.html#32590"><span data-toggle="tooltip" data-title="number">lastIndex</span></a><span class="punctuation">]</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#32635"><span data-toggle="tooltip" data-title="DocumentBlock">last</span></a><span class="punctuation">.</span><a href="parser.html#2445"><span data-toggle="tooltip" data-title="Element">element</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">tagName</span> <span class="punctuation">==</span> <span class="string">&quot;P&quot;</span><span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="keyword">let</span> <span id="32719" data-toggle="tooltip" data-title="DocumentBlock">prev</span> <span class="punctuation">=</span> <a href="parser.html#32368"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5681"><span data-toggle="tooltip" data-title="DocumentBlock[]">blocks</span></a><span class="punctuation">[</span><a href="parser.html#32590"><span data-toggle="tooltip" data-title="number">lastIndex</span></a> <span class="punctuation">-</span> <span class="number">1</span><span class="punctuation">]</span>
        <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#32719"><span data-toggle="tooltip" data-title="DocumentBlock">prev</span></a><span class="punctuation">.</span><a href="parser.html#2445"><span data-toggle="tooltip" data-title="Element">element</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">tagName</span> <span class="punctuation">!=</span> <span class="string">&quot;LI&quot;</span> <span class="punctuation">&amp;&amp;</span> <span class="punctuation">(</span><a href="parser.html#32493"><span data-toggle="tooltip" data-title="string">allowEmpty</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span> <span class="punctuation">==</span> <span class="number">0</span> <span class="punctuation">||</span>
            <span class="punctuation">(</span><a href="parser.html#32430"><span data-toggle="tooltip" data-title="string | undefined">bulletno</span></a> <span class="punctuation">&amp;&amp;</span> <a href="parser.html#32430"><span data-toggle="tooltip" data-title="string">bulletno</span></a> <span class="punctuation">!=</span> <span class="string">&quot;1&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">{</span>
            <a href="parser.html#32368"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5658"><span data-toggle="tooltip" data-title="number">nextIndex</span></a> <span class="punctuation">=</span> <a href="parser.html#32387"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">index</span>
            <span class="keyword">return</span>
        <span class="punctuation">}</span>
        <a href="parser.html#49578"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; void">flushLastBlock</span></a><span class="punctuation">(</span><a href="parser.html#32368"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">)</span>
        <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#32719"><span data-toggle="tooltip" data-title="DocumentBlock">prev</span></a><span class="punctuation">.</span><a href="parser.html#2445"><span data-toggle="tooltip" data-title="Element">element</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">tagName</span> <span class="punctuation">==</span> <span class="string">&quot;LI&quot;</span><span class="punctuation">)</span>
            <a href="parser.html#34187"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, block: DocumentBlock) =&gt; void">closeListItem</span></a><span class="punctuation">(</span><a href="parser.html#32368"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#32719"><span data-toggle="tooltip" data-title="DocumentBlock">prev</span></a><span class="punctuation">)</span>
        <span class="keyword">else</span>
            <a href="parser.html#7275"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; void">closeLastBlock</span></a><span class="punctuation">(</span><a href="parser.html#32368"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">)</span>
    <span class="punctuation">}</span>
    <span class="keyword">let</span> <span id="33126" data-toggle="tooltip" data-title="number">len</span> <span class="punctuation">=</span> <a href="parser.html#32466"><span data-toggle="tooltip" data-title="string">prefix</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span>
    <span class="keyword">let</span> <span id="33155" data-toggle="tooltip" data-title="number">bslen</span> <span class="punctuation">=</span> <a href="parser.html#32411"><span data-toggle="tooltip" data-title="string">bulletsep</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#33155"><span data-toggle="tooltip" data-title="number">bslen</span></a> <span class="punctuation">==</span> <span class="number">0</span><span class="punctuation">)</span>
        <a href="parser.html#33126"><span data-toggle="tooltip" data-title="number">len</span></a><span class="punctuation">++</span>
    <span class="keyword">else</span> <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#33155"><span data-toggle="tooltip" data-title="number">bslen</span></a> <span class="punctuation">&gt;</span> <span class="number">4</span> <span class="punctuation">||</span> <a href="parser.html#32493"><span data-toggle="tooltip" data-title="string">allowEmpty</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span> <span class="punctuation">==</span> <span class="number">0</span><span class="punctuation">)</span>
        <a href="parser.html#33126"><span data-toggle="tooltip" data-title="number">len</span></a> <span class="punctuation">-=</span> <span class="punctuation">(</span><a href="parser.html#33155"><span data-toggle="tooltip" data-title="number">bslen</span></a> <span class="punctuation">-</span> <span class="number">1</span><span class="punctuation">)</span>
    <span class="keyword">let</span> <span id="33304" data-toggle="tooltip" data-title="DocumentBlock">block</span> <span class="punctuation">=</span> <a href="parser.html#7643"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; DocumentBlock">lastBlock</span></a><span class="punctuation">(</span><a href="parser.html#32368"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">)</span>
    <span class="keyword">let</span> <span id="33338" data-toggle="tooltip" data-title="string">bulletRe</span> <span class="punctuation">=</span> <a href="parser.html#32466"><span data-toggle="tooltip" data-title="string">prefix</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="{ (searchValue: string | RegExp, replaceValue: string): string; (searchValue: string | RegExp, replacer: (substring: string, ...args: any[]) =&gt; string): string; }">replaceAll</span><span class="punctuation">(</span><span class="string">/\d+|[+*.)]|\s+$/g</span><span class="punctuation">,</span> <span id="33387" data-toggle="tooltip" data-title="string">m</span> <span class="punctuation">=&gt;</span> 
            <a href="parser.html#33387"><span data-toggle="tooltip" data-title="string">m</span></a><span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span> <span class="punctuation">==</span> <span class="string">&quot; &quot;</span> <span class="punctuation">?</span> <span class="string">`(?:${</span><a href="parser.html#33387"><span data-toggle="tooltip" data-title="string">m</span></a><span class="string">}|$)`</span> <span class="punctuation">:</span>
            <span class="typename" data-toggle="tooltip" data-title="NumberConstructor">Number</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(number: unknown) =&gt; boolean">isFinite</span><span class="punctuation">(</span><span class="typename" data-toggle="tooltip" data-title="NumberConstructor">Number</span><span class="punctuation">(</span><a href="parser.html#33387"><span data-toggle="tooltip" data-title="string">m</span></a><span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">?</span> <span class="string">&quot;\\d{1,9}&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;\\&quot;</span> <span class="punctuation">+</span> <a href="parser.html#33387"><span data-toggle="tooltip" data-title="string">m</span></a><span class="punctuation">)</span>
    <span class="keyword">let</span> <span id="33509" data-toggle="tooltip" data-title="RegExp">cont</span> <span class="punctuation">=</span> <span class="keyword">new</span> <span class="typename" data-toggle="tooltip" data-title="RegExpConstructor">RegExp</span><span class="punctuation">(</span><span class="string">`(?= {${</span><a href="parser.html#33126"><span data-toggle="tooltip" data-title="number">len</span></a><span class="string">}}${</span><a href="parser.html#32493"><span data-toggle="tooltip" data-title="string">allowEmpty</span></a><span class="string">}|${</span><a href="parser.html#33338"><span data-toggle="tooltip" data-title="string">bulletRe</span></a><span class="string">})`</span><span class="punctuation">,</span> <span class="string">&quot;yui&quot;</span><span class="punctuation">)</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#32430"><span data-toggle="tooltip" data-title="string | undefined">bulletno</span></a> <span class="punctuation">&amp;&amp;</span> <a href="parser.html#33304"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">.</span><a href="parser.html#2445"><span data-toggle="tooltip" data-title="Element">element</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">tagName</span> <span class="punctuation">!=</span> <span class="string">&quot;OL&quot;</span><span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="keyword">let</span> <span id="33643" data-toggle="tooltip" data-title="HTMLOListElement">ol</span> <span class="punctuation">=</span> <a href="parser.html#419"><span data-toggle="tooltip" data-title="&lt;K extends keyof HTMLElementTagNameMap&gt;(tag: K, ...children: Node[]) =&gt; HTMLElementTagNameMap[K]">elem</span></a><span class="punctuation">(</span><span class="string">&#039;ol&#039;</span><span class="punctuation">)</span>
        <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#32430"><span data-toggle="tooltip" data-title="string">bulletno</span></a> <span class="punctuation">!=</span> <span class="string">&quot;1&quot;</span><span class="punctuation">)</span>
            <a href="parser.html#33643"><span data-toggle="tooltip" data-title="HTMLOListElement">ol</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">start</span> <span class="punctuation">=</span> <span class="typename" data-toggle="tooltip" data-title="NumberConstructor">Number</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(string: string, radix?: number) =&gt; number">parseInt</span><span class="punctuation">(</span><a href="parser.html#32430"><span data-toggle="tooltip" data-title="string">bulletno</span></a><span class="punctuation">)</span>
        <a href="parser.html#6365"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, element: Element, type: BlockType, leaf?: boolean, parent?: Element, cont?: RegExp, closing?: BlockEvent, continuing?: BlockEvent) =&gt; void">openBlock</span></a><span class="punctuation">(</span><a href="parser.html#32368"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#33643"><span data-toggle="tooltip" data-title="HTMLOListElement">ol</span></a><span class="punctuation">,</span> <a href="parser.html#1356"><span class="typename" data-toggle="tooltip" data-title="typeof BlockType">BlockType</span></a><span class="punctuation">.</span><a href="parser.html#2164"><span data-toggle="tooltip" data-title="BlockType.Inline">Inline</span></a><span class="punctuation">,</span> <span class="keyword">false</span><span class="punctuation">,</span> <span data-toggle="tooltip" data-title="undefined">undefined</span><span class="punctuation">,</span> <a href="parser.html#33509"><span data-toggle="tooltip" data-title="RegExp">cont</span></a><span class="punctuation">,</span>
            <a href="parser.html#36181"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, block: DocumentBlock) =&gt; void">closeList</span></a><span class="punctuation">)</span>
    <span class="punctuation">}</span>
    <span class="keyword">else</span> <span class="keyword">if</span> <span class="punctuation">(</span><span class="punctuation">!</span><a href="parser.html#32430"><span data-toggle="tooltip" data-title="string | undefined">bulletno</span></a> <span class="punctuation">&amp;&amp;</span> <a href="parser.html#33304"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">.</span><a href="parser.html#2445"><span data-toggle="tooltip" data-title="Element">element</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">tagName</span> <span class="punctuation">!=</span> <span class="string">&quot;UL&quot;</span><span class="punctuation">)</span>
        <a href="parser.html#6365"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, element: Element, type: BlockType, leaf?: boolean, parent?: Element, cont?: RegExp, closing?: BlockEvent, continuing?: BlockEvent) =&gt; void">openBlock</span></a><span class="punctuation">(</span><a href="parser.html#32368"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#419"><span data-toggle="tooltip" data-title="&lt;K extends keyof HTMLElementTagNameMap&gt;(tag: K, ...children: Node[]) =&gt; HTMLElementTagNameMap[K]">elem</span></a><span class="punctuation">(</span><span class="string">&#039;ul&#039;</span><span class="punctuation">)</span><span class="punctuation">,</span> <a href="parser.html#1356"><span class="typename" data-toggle="tooltip" data-title="typeof BlockType">BlockType</span></a><span class="punctuation">.</span><a href="parser.html#2164"><span data-toggle="tooltip" data-title="BlockType.Inline">Inline</span></a><span class="punctuation">,</span> <span class="keyword">false</span><span class="punctuation">,</span> <span data-toggle="tooltip" data-title="undefined">undefined</span><span class="punctuation">,</span> <a href="parser.html#33509"><span data-toggle="tooltip" data-title="RegExp">cont</span></a><span class="punctuation">,</span>
            <a href="parser.html#36181"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, block: DocumentBlock) =&gt; void">closeList</span></a><span class="punctuation">)</span>
    <a href="parser.html#6365"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, element: Element, type: BlockType, leaf?: boolean, parent?: Element, cont?: RegExp, closing?: BlockEvent, continuing?: BlockEvent) =&gt; void">openBlock</span></a><span class="punctuation">(</span><a href="parser.html#32368"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#419"><span data-toggle="tooltip" data-title="&lt;K extends keyof HTMLElementTagNameMap&gt;(tag: K, ...children: Node[]) =&gt; HTMLElementTagNameMap[K]">elem</span></a><span class="punctuation">(</span><span class="string">&#039;li&#039;</span><span class="punctuation">)</span><span class="punctuation">,</span> <a href="parser.html#1356"><span class="typename" data-toggle="tooltip" data-title="typeof BlockType">BlockType</span></a><span class="punctuation">.</span><a href="parser.html#2164"><span data-toggle="tooltip" data-title="BlockType.Inline">Inline</span></a><span class="punctuation">,</span> <span class="keyword">false</span><span class="punctuation">,</span> <span data-toggle="tooltip" data-title="undefined">undefined</span><span class="punctuation">,</span>
        <span class="keyword">new</span> <span class="typename" data-toggle="tooltip" data-title="RegExpConstructor">RegExp</span><span class="punctuation">(</span><span class="string">` {${</span><a href="parser.html#33126"><span data-toggle="tooltip" data-title="number">len</span></a><span class="string">}}${</span><a href="parser.html#32493"><span data-toggle="tooltip" data-title="string">allowEmpty</span></a><span class="string">}`</span><span class="punctuation">,</span> <span class="string">&quot;yui&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> <a href="parser.html#34187"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, block: DocumentBlock) =&gt; void">closeListItem</span></a><span class="punctuation">)</span>
    <a href="parser.html#32368"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5658"><span data-toggle="tooltip" data-title="number">nextIndex</span></a> <span class="punctuation">=</span> <a href="parser.html#32387"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">index</span> <span class="punctuation">+</span> <a href="parser.html#33126"><span data-toggle="tooltip" data-title="number">len</span></a>
<span class="punctuation">}</span>
</code></pre>
<p><code>closeListItem</code> determines whether the list item block to be closed is
tight or loose. Tight items do not contain empty lines, and thus will not
be wrapped inside <code>p</code> elements. By default we assume that items are loose,
and always create the <code>p</code> block.</p>
<p>Closing the list item block can happen before or after closing the <code>p</code> block
depending on whether the list item is the last one. The first <code>if</code> statement
handles the case when we are not closing the last block, and the paragraph
block is still open. If we have not accumulated any empty rows into the list
item block, we know that the item is tight and can delete the <code>p</code> block
— after we have moved its lines under the list item block.</p>
<p>The second if statement triggers if the list item is the last one. We know
that it's a last one, if there is no <code>p</code> block open anymore. The <code>closeList</code>
function below will reset the <code>closing</code> property of its block, if all the
items in the list are tight. Also the last item needs to be tight, that is,
it must contain only one child which is a paragraph. We can move <code>p</code> elements
children directly under the <code>lì</code> element, if all the conditions above are
true. Finally, we can delete the <code>p</code> element.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">function</span> <span id="34187" class="member" data-toggle="tooltip" data-title="(state: ParserState, block: DocumentBlock) =&gt; void">closeListItem</span><span class="punctuation">(</span><span id="35500" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">:</span> <a href="parser.html#5051"><span class="typename" data-toggle="tooltip" data-title="ParserState">ParserState</span></a><span class="punctuation">,</span> <span id="35519" data-toggle="tooltip" data-title="DocumentBlock">block</span><span class="punctuation">:</span> <a href="parser.html#2333"><span class="typename" data-toggle="tooltip" data-title="DocumentBlock">DocumentBlock</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
    <span class="keyword">let</span> <span id="35552" data-toggle="tooltip" data-title="DocumentBlock">last</span> <span class="punctuation">=</span> <a href="parser.html#7643"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; DocumentBlock">lastBlock</span></a><span class="punctuation">(</span><a href="parser.html#35500"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">)</span>
    <span class="keyword">let</span> <span id="35585" data-toggle="tooltip" data-title="DocumentBlock">prev</span> <span class="punctuation">=</span> <a href="parser.html#35500"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5681"><span data-toggle="tooltip" data-title="DocumentBlock[]">blocks</span></a><span class="punctuation">[</span><a href="parser.html#35500"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5681"><span data-toggle="tooltip" data-title="DocumentBlock[]">blocks</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span> <span class="punctuation">-</span> <span class="number">2</span><span class="punctuation">]</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#35519"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">.</span><a href="parser.html#3406"><span data-toggle="tooltip" data-title="string[]">lines</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span> <span class="punctuation">==</span> <span class="number">0</span> <span class="punctuation">&amp;&amp;</span> <a href="parser.html#35519"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a> <span class="punctuation">==</span> <a href="parser.html#35585"><span data-toggle="tooltip" data-title="DocumentBlock">prev</span></a> <span class="punctuation">&amp;&amp;</span> 
        <a href="parser.html#35519"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">.</span><a href="parser.html#2445"><span data-toggle="tooltip" data-title="Element">element</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">childElementCount</span> <span class="punctuation">==</span> <span class="number">0</span> <span class="punctuation">&amp;&amp;</span> <a href="parser.html#35552"><span data-toggle="tooltip" data-title="DocumentBlock">last</span></a><span class="punctuation">.</span><a href="parser.html#2445"><span data-toggle="tooltip" data-title="Element">element</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">tagName</span> <span class="punctuation">==</span> <span class="string">&quot;P&quot;</span><span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="keyword">let</span> <span id="35777" data-toggle="tooltip" data-title="DocumentBlock">para</span> <span class="punctuation">=</span> <a href="parser.html#35500"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5681"><span data-toggle="tooltip" data-title="DocumentBlock[]">blocks</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="() =&gt; DocumentBlock | undefined">pop</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">!</span>
        <a href="parser.html#8237"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, ...nodes: Node[]) =&gt; void">append</span></a><span class="punctuation">(</span><a href="parser.html#35500"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <span class="punctuation">...</span><a href="parser.html#35777"><span data-toggle="tooltip" data-title="DocumentBlock">para</span></a><span class="punctuation">.</span><a href="parser.html#2445"><span data-toggle="tooltip" data-title="Element">element</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="NodeListOf&lt;ChildNode&gt;">childNodes</span><span class="punctuation">)</span>
        <a href="parser.html#35519"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">.</span><a href="parser.html#3406"><span data-toggle="tooltip" data-title="string[]">lines</span></a> <span class="punctuation">=</span> <a href="parser.html#35777"><span data-toggle="tooltip" data-title="DocumentBlock">para</span></a><span class="punctuation">.</span><a href="parser.html#3406"><span data-toggle="tooltip" data-title="string[]">lines</span></a>
    <span class="punctuation">}</span>
    <span class="keyword">else</span> <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#35519"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a> <span class="punctuation">==</span> <a href="parser.html#35552"><span data-toggle="tooltip" data-title="DocumentBlock">last</span></a> <span class="punctuation">&amp;&amp;</span> <span class="punctuation">!</span><a href="parser.html#35585"><span data-toggle="tooltip" data-title="DocumentBlock">prev</span></a><span class="punctuation">.</span><a href="parser.html#3966"><span data-toggle="tooltip" data-title="BlockEvent | undefined">closing</span></a> <span class="punctuation">&amp;&amp;</span>
        <a href="parser.html#35519"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">.</span><a href="parser.html#2445"><span data-toggle="tooltip" data-title="Element">element</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">childElementCount</span> <span class="punctuation">==</span> <span class="number">1</span> <span class="punctuation">&amp;&amp;</span> 
        <a href="parser.html#35519"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">.</span><a href="parser.html#2445"><span data-toggle="tooltip" data-title="Element">element</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="Element | null">firstElementChild</span><span class="punctuation">!</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">tagName</span> <span class="punctuation">==</span> <span class="string">&quot;P&quot;</span><span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="keyword">let</span> <span id="36067" data-toggle="tooltip" data-title="Element">p</span> <span class="punctuation">=</span> <a href="parser.html#35519"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">.</span><a href="parser.html#2445"><span data-toggle="tooltip" data-title="Element">element</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="Element | null">firstElementChild</span><span class="punctuation">!</span>
        <a href="parser.html#35519"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">.</span><a href="parser.html#2445"><span data-toggle="tooltip" data-title="Element">element</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(...nodes: (Node | string)[]) =&gt; void">append</span><span class="punctuation">(</span><span class="punctuation">...</span><a href="parser.html#36067"><span data-toggle="tooltip" data-title="Element">p</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="NodeListOf&lt;ChildNode&gt;">childNodes</span><span class="punctuation">)</span>
        <a href="parser.html#36067"><span data-toggle="tooltip" data-title="Element">p</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="() =&gt; void">remove</span><span class="punctuation">(</span><span class="punctuation">)</span>
    <span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre>
<p>When a list block is closing, we check whether all its items are tight; that
is, there are no <code>p</code> elements directly underneath the items. If that
condition holds, we reset the <code>closing</code> property of the block to indicate
that the list is tight. Using the property for this is hacky as hell... But
the alternative would be to introduce some class hierarchy for blocks, derive
<code>ListBlock</code> class from the <code>DocumentBlock</code>, and so on. This is is simply
too big of a change for implementing this one use case. We'll refactor this
later, if need be.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">function</span> <span id="36181" class="member" data-toggle="tooltip" data-title="(state: ParserState, block: DocumentBlock) =&gt; void">closeList</span><span class="punctuation">(</span><span id="36791" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">:</span> <a href="parser.html#5051"><span class="typename" data-toggle="tooltip" data-title="ParserState">ParserState</span></a><span class="punctuation">,</span> <span id="36810" data-toggle="tooltip" data-title="DocumentBlock">block</span><span class="punctuation">:</span> <a href="parser.html#2333"><span class="typename" data-toggle="tooltip" data-title="DocumentBlock">DocumentBlock</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><span class="punctuation">!</span><a href="parser.html#36810"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">.</span><a href="parser.html#2445"><span data-toggle="tooltip" data-title="Element">element</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="{ &lt;K extends keyof HTMLElementTagNameMap&gt;(selectors: K): HTMLElementTagNameMap[K] | null; &lt;K extends keyof SVGElementTagNameMap&gt;(selectors: K): SVGElementTagNameMap[K] | null; &lt;K extends keyof MathMLElementTagNameMap&gt;(selectors: K): MathMLElementTagNameMap[K] | null; &lt;K extends keyof HTMLElementDeprecatedTagNameMap&gt;...">querySelector</span><span class="punctuation">(</span><span class="string">&quot;:scope &gt; li &gt; p&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span>
        <a href="parser.html#36810"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">.</span><a href="parser.html#3966"><span data-toggle="tooltip" data-title="BlockEvent | undefined">closing</span></a> <span class="punctuation">=</span> <span data-toggle="tooltip" data-title="undefined">undefined</span>
<span class="punctuation">}</span>
</code></pre>
<h3 id="closing-fenced-code-block">Closing Fenced Code Block</h3>
<p>This function trims empty lines from the fenced code block and advances the
parser past the closing fence marker (e.g., ``` or ~~~) if present at the
current position.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">function</span> <span id="36930" class="member" data-toggle="tooltip" data-title="(state: ParserState, block: DocumentBlock) =&gt; void">closeFencedCodeBlock</span><span class="punctuation">(</span><span id="37192" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">:</span> <a href="parser.html#5051"><span class="typename" data-toggle="tooltip" data-title="ParserState">ParserState</span></a><span class="punctuation">,</span> <span id="37211" data-toggle="tooltip" data-title="DocumentBlock">block</span><span class="punctuation">:</span> <a href="parser.html#2333"><span class="typename" data-toggle="tooltip" data-title="DocumentBlock">DocumentBlock</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
    <a href="parser.html#8900"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, block: DocumentBlock) =&gt; void">trimBlock</span></a><span class="punctuation">(</span><a href="parser.html#37192"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#37211"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">)</span>
    <span class="keyword">let</span> <span id="37273" data-toggle="tooltip" data-title="RegExp">endmarker</span> <span class="punctuation">=</span> <span class="string">/ {0,3}(?:`|~){3,}\s*$/yiu</span>
    <a href="parser.html#37273"><span data-toggle="tooltip" data-title="RegExp">endmarker</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">lastIndex</span> <span class="punctuation">=</span> <a href="parser.html#37192"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5658"><span data-toggle="tooltip" data-title="number">nextIndex</span></a>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#37273"><span data-toggle="tooltip" data-title="RegExp">endmarker</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(string: string) =&gt; RegExpExecArray | null">exec</span><span class="punctuation">(</span><a href="parser.html#37192"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5639"><span data-toggle="tooltip" data-title="string">input</span></a><span class="punctuation">)</span><span class="punctuation">)</span>
        <a href="parser.html#37192"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5658"><span data-toggle="tooltip" data-title="number">nextIndex</span></a> <span class="punctuation">=</span> <a href="parser.html#37273"><span data-toggle="tooltip" data-title="RegExp">endmarker</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">lastIndex</span>
<span class="punctuation">}</span>
</code></pre>
<h3 id="coninuing-and-closing-a-link-reference">Coninuing and Closing a Link Reference</h3>
<p>Continuing a block will store the matched text into the current block, and
feed the rest of the line to the expression automaton.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">function</span> <span id="37443" class="member" data-toggle="tooltip" data-title="(state: ParserState, block: DocumentBlock) =&gt; void">continueLinkRef</span><span class="punctuation">(</span><span id="37670" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">:</span> <a href="parser.html#5051"><span class="typename" data-toggle="tooltip" data-title="ParserState">ParserState</span></a><span class="punctuation">,</span> <span id="37689" data-toggle="tooltip" data-title="DocumentBlock">block</span><span class="punctuation">:</span> <a href="parser.html#2333"><span class="typename" data-toggle="tooltip" data-title="DocumentBlock">DocumentBlock</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
    <span class="keyword">let</span> <span class="punctuation">[</span><span id="37724" data-toggle="tooltip" data-title="boolean">res</span><span class="punctuation">,</span> <span id="37728" data-toggle="tooltip" data-title="number">pos</span><span class="punctuation">]</span> <span class="punctuation">=</span> <a href="parser.html#16890"><span data-toggle="tooltip" data-title="ExpAuto">linkRef</span></a><span class="punctuation">.</span><a href="helpers.html#7022"><span class="member" data-toggle="tooltip" data-title="(input: string, pos: number, lastInput?: boolean) =&gt; [boolean, number]">exec</span></a><span class="punctuation">(</span><a href="parser.html#37670"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5639"><span data-toggle="tooltip" data-title="string">input</span></a><span class="punctuation">,</span> <a href="parser.html#37670"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5658"><span data-toggle="tooltip" data-title="number">nextIndex</span></a><span class="punctuation">)</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><span class="punctuation">!</span><a href="parser.html#37724"><span data-toggle="tooltip" data-title="boolean">res</span></a> <span class="punctuation">||</span> <a href="parser.html#16890"><span data-toggle="tooltip" data-title="ExpAuto">linkRef</span></a><span class="punctuation">.</span><a href="helpers.html#8672"><span class="member" data-toggle="tooltip" data-title="boolean">accepted</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
        <a href="parser.html#38235"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, block: DocumentBlock) =&gt; void">terminateLinkRef</span></a><span class="punctuation">(</span><a href="parser.html#37670"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#37689"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">)</span>
        <a href="parser.html#37670"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5658"><span data-toggle="tooltip" data-title="number">nextIndex</span></a> <span class="punctuation">=</span> <a href="parser.html#37728"><span data-toggle="tooltip" data-title="number">pos</span></a>
    <span class="punctuation">}</span>
    <span class="keyword">else</span> 
        <a href="parser.html#37670"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5658"><span data-toggle="tooltip" data-title="number">nextIndex</span></a> <span class="punctuation">=</span> <a href="parser.html#37670"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5639"><span data-toggle="tooltip" data-title="string">input</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span>
<span class="punctuation">}</span>
</code></pre>
<p>Called when a block regexp does not match any more. I.e. when an empty line
or end of input is reached.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">function</span> <span id="37953" class="member" data-toggle="tooltip" data-title="(state: ParserState, block: DocumentBlock) =&gt; void">closeLinkRef</span><span class="punctuation">(</span><span id="38099" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">:</span> <a href="parser.html#5051"><span class="typename" data-toggle="tooltip" data-title="ParserState">ParserState</span></a><span class="punctuation">,</span> <span id="38118" data-toggle="tooltip" data-title="DocumentBlock">block</span><span class="punctuation">:</span> <a href="parser.html#2333"><span class="typename" data-toggle="tooltip" data-title="DocumentBlock">DocumentBlock</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
    <a href="parser.html#16890"><span data-toggle="tooltip" data-title="ExpAuto">linkRef</span></a><span class="punctuation">.</span><a href="helpers.html#7022"><span class="member" data-toggle="tooltip" data-title="(input: string, pos: number, lastInput?: boolean) =&gt; [boolean, number]">exec</span></a><span class="punctuation">(</span><a href="parser.html#38099"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5639"><span data-toggle="tooltip" data-title="string">input</span></a><span class="punctuation">,</span> <a href="parser.html#38099"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5658"><span data-toggle="tooltip" data-title="number">nextIndex</span></a><span class="punctuation">,</span> <span class="keyword">true</span><span class="punctuation">)</span>
    <a href="parser.html#38235"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, block: DocumentBlock) =&gt; void">terminateLinkRef</span></a><span class="punctuation">(</span><a href="parser.html#38099"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#38118"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">)</span>
<span class="punctuation">}</span>
</code></pre>
<p>Handles the closure of a link reference block. Extracts the link label,
destination, and optional title, stores them in the parser state, and updates
any unresolved links or images with the same label.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">function</span> <span id="38235" class="member" data-toggle="tooltip" data-title="(state: ParserState, block: DocumentBlock) =&gt; void">terminateLinkRef</span><span class="punctuation">(</span><span id="38489" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">:</span> <a href="parser.html#5051"><span class="typename" data-toggle="tooltip" data-title="ParserState">ParserState</span></a><span class="punctuation">,</span> <span id="38508" data-toggle="tooltip" data-title="DocumentBlock">block</span><span class="punctuation">:</span> <a href="parser.html#2333"><span class="typename" data-toggle="tooltip" data-title="DocumentBlock">DocumentBlock</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#16890"><span data-toggle="tooltip" data-title="ExpAuto">linkRef</span></a><span class="punctuation">.</span><a href="helpers.html#8672"><span class="member" data-toggle="tooltip" data-title="boolean">accepted</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="keyword">let</span> <span class="punctuation">{</span> <span id="38576" data-toggle="tooltip" data-title="string">label</span><span class="punctuation">,</span> <span id="38583" data-toggle="tooltip" data-title="string">dest</span><span class="punctuation">,</span> <span id="38589" data-toggle="tooltip" data-title="string">title</span> <span class="punctuation">}</span> <span class="punctuation">=</span> <a href="parser.html#16890"><span data-toggle="tooltip" data-title="ExpAuto">linkRef</span></a><span class="punctuation">.</span><a href="helpers.html#4581"><span data-toggle="tooltip" data-title="Record&lt;string, string&gt;">groups</span></a>
        <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#38576"><span data-toggle="tooltip" data-title="string">label</span></a> <span class="punctuation">&amp;&amp;</span> <a href="parser.html#38583"><span data-toggle="tooltip" data-title="string">dest</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
            <a href="parser.html#38576"><span data-toggle="tooltip" data-title="string">label</span></a> <span class="punctuation">=</span> <a href="parser.html#38576"><span data-toggle="tooltip" data-title="string">label</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="() =&gt; string">trim</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="() =&gt; string">toUpperCase</span><span class="punctuation">(</span><span class="punctuation">)</span>
            <a href="parser.html#38583"><span data-toggle="tooltip" data-title="string">dest</span></a> <span class="punctuation">=</span> <a href="parser.html#21809"><span class="member" data-toggle="tooltip" data-title="(text?: string) =&gt; string | undefined">replaceEscapes</span></a><span class="punctuation">(</span><a href="parser.html#38583"><span data-toggle="tooltip" data-title="string">dest</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="() =&gt; string">trim</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">!</span>
            <a href="parser.html#38589"><span data-toggle="tooltip" data-title="string">title</span></a> <span class="punctuation">=</span> <a href="parser.html#21809"><span class="member" data-toggle="tooltip" data-title="(text?: string) =&gt; string | undefined">replaceEscapes</span></a><span class="punctuation">(</span><a href="parser.html#38589"><span data-toggle="tooltip" data-title="string">title</span></a><span class="punctuation">)</span><span class="punctuation">!</span>
            <span class="keyword">if</span> <span class="punctuation">(</span><span class="punctuation">!</span><a href="parser.html#38489"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5710"><span data-toggle="tooltip" data-title="LinkRefs">linkRefs</span></a><span class="punctuation">[</span><a href="parser.html#38576"><span data-toggle="tooltip" data-title="string">label</span></a><span class="punctuation">]</span><span class="punctuation">)</span> <span class="punctuation">{</span>
                <span class="keyword">if</span> <span class="punctuation">(</span><span class="string">/^&lt;.*&gt;$/</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(string: string) =&gt; boolean">test</span><span class="punctuation">(</span><a href="parser.html#38583"><span data-toggle="tooltip" data-title="string">dest</span></a><span class="punctuation">)</span><span class="punctuation">)</span>
                    <a href="parser.html#38583"><span data-toggle="tooltip" data-title="string">dest</span></a> <span class="punctuation">=</span> <a href="parser.html#38583"><span data-toggle="tooltip" data-title="string">dest</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(start?: number, end?: number) =&gt; string">slice</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <a href="parser.html#38583"><span data-toggle="tooltip" data-title="string">dest</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span> <span class="punctuation">-</span> <span class="number">1</span><span class="punctuation">)</span>
                <a href="parser.html#38489"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5710"><span data-toggle="tooltip" data-title="LinkRefs">linkRefs</span></a><span class="punctuation">[</span><a href="parser.html#38576"><span data-toggle="tooltip" data-title="string">label</span></a><span class="punctuation">]</span> <span class="punctuation">=</span> <span class="punctuation">{</span> <span id="38972" data-toggle="tooltip" data-title="string">destination</span><span class="punctuation">:</span> <a href="parser.html#38583"><span data-toggle="tooltip" data-title="string">dest</span></a><span class="punctuation">,</span> <span id="38991" data-toggle="tooltip" data-title="string">title</span> <span class="punctuation">}</span>
                <a href="parser.html#38489"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5734"><span data-toggle="tooltip" data-title="Links">links</span></a><span class="punctuation">[</span><a href="parser.html#38576"><span data-toggle="tooltip" data-title="string">label</span></a><span class="punctuation">]</span><span class="punctuation">?.</span><span class="member" data-toggle="tooltip" data-title="(callbackfn: (value: HTMLImageElement | HTMLAnchorElement, index: number, array: (HTMLImageElement | HTMLAnchorElement)[]) =&gt; void, thisArg?: any) =&gt; void">forEach</span><span class="punctuation">(</span><span id="39045" data-toggle="tooltip" data-title="HTMLImageElement | HTMLAnchorElement">aelem</span> <span class="punctuation">=&gt;</span> <span class="punctuation">{</span>
                    <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#38583"><span data-toggle="tooltip" data-title="string">dest</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
                        <span class="keyword">if</span><span class="punctuation">(</span><a href="parser.html#39045"><span data-toggle="tooltip" data-title="HTMLImageElement | HTMLAnchorElement">aelem</span></a> <span class="keyword">instanceof</span> <span class="typename" data-toggle="tooltip" data-title="{ new (): HTMLAnchorElement; prototype: HTMLAnchorElement; }">HTMLAnchorElement</span><span class="punctuation">)</span>
                            <a href="parser.html#39045"><span data-toggle="tooltip" data-title="HTMLAnchorElement">aelem</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">href</span> <span class="punctuation">=</span> <a href="parser.html#38583"><span data-toggle="tooltip" data-title="string">dest</span></a>
                        <span class="keyword">else</span>
                            <a href="parser.html#39045"><span data-toggle="tooltip" data-title="HTMLImageElement">aelem</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">src</span> <span class="punctuation">=</span> <a href="parser.html#38583"><span data-toggle="tooltip" data-title="string">dest</span></a>
                    <span class="punctuation">}</span>
                    <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#38589"><span data-toggle="tooltip" data-title="string">title</span></a><span class="punctuation">)</span>
                        <a href="parser.html#39045"><span data-toggle="tooltip" data-title="HTMLImageElement | HTMLAnchorElement">aelem</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">title</span> <span class="punctuation">=</span> <a href="parser.html#38589"><span data-toggle="tooltip" data-title="string">title</span></a>
                <span class="punctuation">}</span><span class="punctuation">)</span>
                <span class="keyword">delete</span> <a href="parser.html#38489"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5734"><span data-toggle="tooltip" data-title="Links">links</span></a><span class="punctuation">[</span><a href="parser.html#38576"><span data-toggle="tooltip" data-title="string">label</span></a><span class="punctuation">]</span>
            <span class="punctuation">}</span>
            <a href="parser.html#7275"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; void">closeLastBlock</span></a><span class="punctuation">(</span><a href="parser.html#38489"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">)</span>
            <span class="keyword">return</span>
        <span class="punctuation">}</span>
    <span class="punctuation">}</span>
    <a href="parser.html#38508"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">.</span><a href="parser.html#2445"><span data-toggle="tooltip" data-title="Element">element</span></a> <span class="punctuation">=</span> <a href="parser.html#419"><span data-toggle="tooltip" data-title="&lt;K extends keyof HTMLElementTagNameMap&gt;(tag: K, ...children: Node[]) =&gt; HTMLElementTagNameMap[K]">elem</span></a><span class="punctuation">(</span><span class="string">&#039;p&#039;</span><span class="punctuation">)</span>
    <a href="parser.html#38508"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">.</span><a href="parser.html#2536"><span data-toggle="tooltip" data-title="Element">parent</span></a> <span class="punctuation">=</span> <a href="parser.html#38508"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">.</span><a href="parser.html#2445"><span data-toggle="tooltip" data-title="Element">element</span></a>
    <a href="parser.html#38508"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">.</span><a href="parser.html#2798"><span data-toggle="tooltip" data-title="BlockType">type</span></a> <span class="punctuation">=</span> <a href="parser.html#1356"><span class="typename" data-toggle="tooltip" data-title="typeof BlockType">BlockType</span></a><span class="punctuation">.</span><a href="parser.html#2164"><span data-toggle="tooltip" data-title="BlockType.Inline">Inline</span></a>
    <a href="parser.html#38508"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">.</span><a href="parser.html#3716"><span data-toggle="tooltip" data-title="RegExp | undefined">cont</span></a> <span class="punctuation">=</span> <a href="parser.html#13385"><span data-toggle="tooltip" data-title="RegExp">nonBlank</span></a>
<span class="punctuation">}</span>
</code></pre>
<h3 id="opening-a-paragraph">Opening a Paragraph</h3>
<p>A sequence of non-blank lines that cannot be interpreted as other kinds of
blocks forms a paragraph.</p>
<p>The function below opens a paragraph if the last block is not already one.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">function</span> <span id="39656" class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; void">openParagraph</span><span class="punctuation">(</span><span id="39918" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">:</span> <a href="parser.html#5051"><span class="typename" data-toggle="tooltip" data-title="ParserState">ParserState</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><span class="punctuation">!</span><a href="parser.html#7852"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; boolean">lastBlockIsParagraph</span></a><span class="punctuation">(</span><a href="parser.html#39918"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">{</span>
        <a href="parser.html#49578"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; void">flushLastBlock</span></a><span class="punctuation">(</span><a href="parser.html#39918"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">)</span>
        <a href="parser.html#6365"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, element: Element, type: BlockType, leaf?: boolean, parent?: Element, cont?: RegExp, closing?: BlockEvent, continuing?: BlockEvent) =&gt; void">openBlock</span></a><span class="punctuation">(</span><a href="parser.html#39918"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#419"><span data-toggle="tooltip" data-title="&lt;K extends keyof HTMLElementTagNameMap&gt;(tag: K, ...children: Node[]) =&gt; HTMLElementTagNameMap[K]">elem</span></a><span class="punctuation">(</span><span class="string">&#039;p&#039;</span><span class="punctuation">)</span><span class="punctuation">,</span> <a href="parser.html#1356"><span class="typename" data-toggle="tooltip" data-title="typeof BlockType">BlockType</span></a><span class="punctuation">.</span><a href="parser.html#2164"><span data-toggle="tooltip" data-title="BlockType.Inline">Inline</span></a><span class="punctuation">,</span> <span class="keyword">true</span><span class="punctuation">,</span> <span data-toggle="tooltip" data-title="undefined">undefined</span><span class="punctuation">,</span> <a href="parser.html#13385"><span data-toggle="tooltip" data-title="RegExp">nonBlank</span></a><span class="punctuation">)</span>
    <span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre>
<p>The following array contains all block-level Markdown parsers. Each parser is
defined with a regular expression and a matcher function that processes the
matched block element. Supported block elements include headings, thematic
breaks, code blocks, HTML blocks, block quotes, lists, link references, and
paragraphs.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">const</span> <span id="40461" data-toggle="tooltip" data-title="Parser[]">blockParsers</span> <span class="punctuation">=</span> <span class="punctuation">[</span>
    <a href="parser.html#5755"><span class="member" data-toggle="tooltip" data-title="(matched: Matcher, regexp: string) =&gt; Parser">parser</span></a><span class="punctuation">(</span>
</code></pre>
<h3 id="setext-headings">Setext Headings</h3>
<p>Matches Setext-style headings, which are underlined with <code>=</code> or <code>-</code>.
If the previous block is a paragraph, it is converted to an <code>&lt;h1&gt;</code>
(for <code>=</code>) or <code>&lt;h2&gt;</code> (for <code>-</code>) heading. If the line is a thematic
break (three or more <code>-</code>), it creates an <code>&lt;hr&gt;</code>. Otherwise, starts
a new paragraph block.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>        <span class="punctuation">(</span><span id="40926" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">,</span> <span id="40932" data-toggle="tooltip" data-title="RegExpExecArray">match</span><span class="punctuation">)</span> <span class="punctuation">=&gt;</span> <span class="punctuation">{</span>
            <span class="keyword">let</span> <span class="punctuation">{</span> <span id="40963" data-toggle="tooltip" data-title="string">setext</span><span class="punctuation">,</span> <span id="40971" data-toggle="tooltip" data-title="string">setextspaces</span> <span class="punctuation">}</span> <span class="punctuation">=</span> <a href="parser.html#40932"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="{ [key: string]: string; } | undefined">groups</span><span class="punctuation">!</span>
            <span class="keyword">let</span> <span id="41019" data-toggle="tooltip" data-title="DocumentBlock">block</span> <span class="punctuation">=</span> <a href="parser.html#7643"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; DocumentBlock">lastBlock</span></a><span class="punctuation">(</span><a href="parser.html#40926"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">)</span>
            <span class="keyword">let</span> <span id="41061" data-toggle="tooltip" data-title="number">len</span> <span class="punctuation">=</span> <a href="parser.html#40932"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a><span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="() =&gt; string">trim</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span>
            <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#41019"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">.</span><a href="parser.html#2445"><span data-toggle="tooltip" data-title="Element">element</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">tagName</span> <span class="punctuation">==</span> <span class="string">&quot;P&quot;</span><span class="punctuation">)</span> <span class="punctuation">{</span>
                <a href="parser.html#41019"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">.</span><a href="parser.html#2445"><span data-toggle="tooltip" data-title="Element">element</span></a> <span class="punctuation">=</span> <a href="parser.html#419"><span data-toggle="tooltip" data-title="&lt;K extends keyof HTMLElementTagNameMap&gt;(tag: K, ...children: Node[]) =&gt; HTMLElementTagNameMap[K]">elem</span></a><span class="punctuation">(</span><a href="parser.html#40963"><span data-toggle="tooltip" data-title="string">setext</span></a> <span class="punctuation">==</span> <span class="string">&quot;=&quot;</span> <span class="punctuation">?</span> <span class="string">&#039;h1&#039;</span> <span class="punctuation">:</span> <span class="string">&#039;h2&#039;</span><span class="punctuation">)</span>
                <a href="parser.html#41019"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">.</span><a href="parser.html#2536"><span data-toggle="tooltip" data-title="Element">parent</span></a> <span class="punctuation">=</span> <a href="parser.html#41019"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">.</span><a href="parser.html#2445"><span data-toggle="tooltip" data-title="Element">element</span></a>
                <a href="parser.html#49578"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; void">flushLastBlock</span></a><span class="punctuation">(</span><a href="parser.html#40926"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">)</span>
                <a href="parser.html#7275"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; void">closeLastBlock</span></a><span class="punctuation">(</span><a href="parser.html#40926"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">)</span>
            <span class="punctuation">}</span>
            <span class="keyword">else</span> <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#40963"><span data-toggle="tooltip" data-title="string">setext</span></a> <span class="punctuation">==</span> <span class="string">&quot;-&quot;</span> <span class="punctuation">&amp;&amp;</span> <a href="parser.html#41061"><span data-toggle="tooltip" data-title="number">len</span></a> <span class="punctuation">&gt;</span> <span class="number">2</span><span class="punctuation">)</span> <span class="punctuation">{</span>
                <a href="parser.html#49578"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; void">flushLastBlock</span></a><span class="punctuation">(</span><a href="parser.html#40926"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">)</span>
                <a href="parser.html#8237"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, ...nodes: Node[]) =&gt; void">append</span></a><span class="punctuation">(</span><a href="parser.html#40926"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#419"><span data-toggle="tooltip" data-title="&lt;K extends keyof HTMLElementTagNameMap&gt;(tag: K, ...children: Node[]) =&gt; HTMLElementTagNameMap[K]">elem</span></a><span class="punctuation">(</span><span class="string">&#039;hr&#039;</span><span class="punctuation">)</span><span class="punctuation">)</span>
            <span class="punctuation">}</span>
            <span class="keyword">else</span> <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#40963"><span data-toggle="tooltip" data-title="string">setext</span></a> <span class="punctuation">==</span> <span class="string">&quot;-&quot;</span> <span class="punctuation">&amp;&amp;</span> <a href="parser.html#41061"><span data-toggle="tooltip" data-title="number">len</span></a> <span class="punctuation">==</span> <span class="number">1</span><span class="punctuation">)</span>
                <a href="parser.html#31776"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, match: RegExpExecArray, bulletsep: string, bulletno?: string) =&gt; void">openList</span></a><span class="punctuation">(</span><a href="parser.html#40926"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#40932"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a><span class="punctuation">,</span> <a href="parser.html#40971"><span data-toggle="tooltip" data-title="string">setextspaces</span></a><span class="punctuation">)</span>
            <span class="keyword">else</span> <span class="punctuation">{</span>
                <a href="parser.html#6365"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, element: Element, type: BlockType, leaf?: boolean, parent?: Element, cont?: RegExp, closing?: BlockEvent, continuing?: BlockEvent) =&gt; void">openBlock</span></a><span class="punctuation">(</span><a href="parser.html#40926"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#419"><span data-toggle="tooltip" data-title="&lt;K extends keyof HTMLElementTagNameMap&gt;(tag: K, ...children: Node[]) =&gt; HTMLElementTagNameMap[K]">elem</span></a><span class="punctuation">(</span><span class="string">&#039;p&#039;</span><span class="punctuation">)</span><span class="punctuation">,</span> <a href="parser.html#1356"><span class="typename" data-toggle="tooltip" data-title="typeof BlockType">BlockType</span></a><span class="punctuation">.</span><a href="parser.html#2164"><span data-toggle="tooltip" data-title="BlockType.Inline">Inline</span></a><span class="punctuation">,</span> <span class="keyword">true</span><span class="punctuation">,</span> <span data-toggle="tooltip" data-title="undefined">undefined</span><span class="punctuation">,</span> 
                    <a href="parser.html#13385"><span data-toggle="tooltip" data-title="RegExp">nonBlank</span></a><span class="punctuation">)</span>
                <a href="parser.html#8237"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, ...nodes: Node[]) =&gt; void">append</span></a><span class="punctuation">(</span><a href="parser.html#40926"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#425"><span data-toggle="tooltip" data-title="(data: string) =&gt; Text">text</span></a><span class="punctuation">(</span><a href="parser.html#40932"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a><span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">)</span>
            <span class="punctuation">}</span>
        <span class="punctuation">}</span><span class="punctuation">,</span>
        <span class="string">/ {0,3}(?&lt;setext&gt;-|=)\k&lt;setext&gt;*(?&lt;setextspaces&gt;\s*)$/</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">source</span><span class="punctuation">)</span><span class="punctuation">,</span>
    <a href="parser.html#5755"><span class="member" data-toggle="tooltip" data-title="(matched: Matcher, regexp: string) =&gt; Parser">parser</span></a><span class="punctuation">(</span>
</code></pre>
<h3 id="thematic-breaks">Thematic Breaks</h3>
<p>Matches a horizontal rule (thematic break) as defined by CommonMark:
a line containing at least three consecutive <code>*</code>, <code>-</code>, or <code>_</code>
characters, possibly separated by spaces or tabs, and nothing else.
Produces an <code>&lt;hr&gt;</code> element.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>        <span class="punctuation">(</span><span id="42244" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">,</span><span class="punctuation">)</span> <span class="punctuation">=&gt;</span> <span class="punctuation">{</span>
            <a href="parser.html#8028"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; void">interruptParagraph</span></a><span class="punctuation">(</span><a href="parser.html#42244"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">)</span>
            <a href="parser.html#8237"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, ...nodes: Node[]) =&gt; void">append</span></a><span class="punctuation">(</span><a href="parser.html#42244"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#419"><span data-toggle="tooltip" data-title="&lt;K extends keyof HTMLElementTagNameMap&gt;(tag: K, ...children: Node[]) =&gt; HTMLElementTagNameMap[K]">elem</span></a><span class="punctuation">(</span><span class="string">&#039;hr&#039;</span><span class="punctuation">)</span><span class="punctuation">)</span>
        <span class="punctuation">}</span><span class="punctuation">,</span>
        <span class="string">/ {0,3}(?&lt;brkchar&gt;[*\-_])(?:\s*\k&lt;brkchar&gt;){2,}\s*$/</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">source</span><span class="punctuation">)</span><span class="punctuation">,</span>
    <a href="parser.html#5755"><span class="member" data-toggle="tooltip" data-title="(matched: Matcher, regexp: string) =&gt; Parser">parser</span></a><span class="punctuation">(</span>
</code></pre>
<h3 id="atx-headers">ATX Headers</h3>
<p>Matches ATX-style headers (lines starting with 1-6 <code>#</code> characters).
The number of <code>#</code> characters determines the header level (<code>&lt;h1&gt;</code> to
<code>&lt;h6&gt;</code>). The header text is parsed for inline elements.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>        <span class="punctuation">(</span><span id="42736" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">,</span> <span id="42742" data-toggle="tooltip" data-title="RegExpExecArray">match</span><span class="punctuation">)</span> <span class="punctuation">=&gt;</span> <span class="punctuation">{</span>
            <a href="parser.html#8028"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; void">interruptParagraph</span></a><span class="punctuation">(</span><a href="parser.html#42736"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">)</span>
            <span class="keyword">let</span> <span class="punctuation">{</span> <span id="42812" data-toggle="tooltip" data-title="string">atxlevel</span><span class="punctuation">,</span> <span id="42822" data-toggle="tooltip" data-title="string">atxheader</span> <span class="punctuation">}</span> <span class="punctuation">=</span> <a href="parser.html#42742"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="{ [key: string]: string; } | undefined">groups</span><span class="punctuation">!</span>
            <span class="keyword">let</span> <span id="42867" data-toggle="tooltip" data-title="number">level</span> <span class="punctuation">=</span> <a href="parser.html#42812"><span data-toggle="tooltip" data-title="string">atxlevel</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span>
            <a href="parser.html#6365"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, element: Element, type: BlockType, leaf?: boolean, parent?: Element, cont?: RegExp, closing?: BlockEvent, continuing?: BlockEvent) =&gt; void">openBlock</span></a><span class="punctuation">(</span><a href="parser.html#42736"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#419"><span data-toggle="tooltip" data-title="&lt;K extends keyof HTMLElementTagNameMap&gt;(tag: K, ...children: Node[]) =&gt; HTMLElementTagNameMap[K]">elem</span></a><span class="punctuation">(</span><span class="punctuation">&lt;</span><span class="keyword">keyof</span> <span class="typename" data-toggle="tooltip" data-title="HTMLElementTagNameMap">HTMLElementTagNameMap</span><span class="punctuation">&gt;</span><span class="string">`h${</span><a href="parser.html#42867"><span data-toggle="tooltip" data-title="number">level</span></a><span class="string">}`</span><span class="punctuation">)</span><span class="punctuation">,</span> 
                <a href="parser.html#1356"><span class="typename" data-toggle="tooltip" data-title="typeof BlockType">BlockType</span></a><span class="punctuation">.</span><a href="parser.html#2164"><span data-toggle="tooltip" data-title="BlockType.Inline">Inline</span></a><span class="punctuation">)</span>
            <a href="parser.html#31279"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; void">inlines</span></a><span class="punctuation">(</span><a href="parser.html#5966"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, input: string, nextIndex?: number) =&gt; ParserState">stateFrom</span></a><span class="punctuation">(</span><a href="parser.html#42736"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#42822"><span data-toggle="tooltip" data-title="string">atxheader</span></a><span class="punctuation">)</span><span class="punctuation">)</span>
            <a href="parser.html#7275"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; void">closeLastBlock</span></a><span class="punctuation">(</span><a href="parser.html#42736"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">)</span>
        <span class="punctuation">}</span><span class="punctuation">,</span>
        <span class="string">/ {0,3}(?&lt;atxlevel&gt;#{1,6})\s+(?&lt;atxheader&gt;.*?)\s*$/</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">source</span><span class="punctuation">)</span><span class="punctuation">,</span>
    <a href="parser.html#5755"><span class="member" data-toggle="tooltip" data-title="(matched: Matcher, regexp: string) =&gt; Parser">parser</span></a><span class="punctuation">(</span>
</code></pre>
<h3 id="indented-code-blocks">Indented Code Blocks</h3>
<p>Matches code blocks that are indented by at least 4 spaces or a tab.
The content is collected as-is and rendered inside a <code>&lt;pre&gt;&lt;code&gt;</code>
block.</p>
<p>Indented code blocks cannot interrupt paragraphs.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>        <span class="punctuation">(</span><span id="43526" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">,</span><span class="punctuation">)</span> <span class="punctuation">=&gt;</span> <span class="punctuation">{</span>
            <span class="keyword">if</span> <span class="punctuation">(</span><span class="punctuation">!</span><a href="parser.html#7852"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; boolean">lastBlockIsParagraph</span></a><span class="punctuation">(</span><a href="parser.html#43526"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">{</span>
                <a href="parser.html#49578"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; void">flushLastBlock</span></a><span class="punctuation">(</span><a href="parser.html#43526"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">)</span>
                <span class="keyword">let</span> <span id="43647" data-toggle="tooltip" data-title="HTMLElement">code</span> <span class="punctuation">=</span> <a href="parser.html#419"><span data-toggle="tooltip" data-title="&lt;K extends keyof HTMLElementTagNameMap&gt;(tag: K, ...children: Node[]) =&gt; HTMLElementTagNameMap[K]">elem</span></a><span class="punctuation">(</span><span class="string">&#039;code&#039;</span><span class="punctuation">)</span>
                <a href="parser.html#6365"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, element: Element, type: BlockType, leaf?: boolean, parent?: Element, cont?: RegExp, closing?: BlockEvent, continuing?: BlockEvent) =&gt; void">openBlock</span></a><span class="punctuation">(</span><a href="parser.html#43526"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#419"><span data-toggle="tooltip" data-title="&lt;K extends keyof HTMLElementTagNameMap&gt;(tag: K, ...children: Node[]) =&gt; HTMLElementTagNameMap[K]">elem</span></a><span class="punctuation">(</span><span class="string">&#039;pre&#039;</span><span class="punctuation">,</span> <a href="parser.html#43647"><span data-toggle="tooltip" data-title="HTMLElement">code</span></a><span class="punctuation">)</span><span class="punctuation">,</span> <a href="parser.html#1356"><span class="typename" data-toggle="tooltip" data-title="typeof BlockType">BlockType</span></a><span class="punctuation">.</span><a href="parser.html#2158"><span data-toggle="tooltip" data-title="BlockType.Text">Text</span></a><span class="punctuation">,</span> <span class="keyword">true</span><span class="punctuation">,</span> <a href="parser.html#43647"><span data-toggle="tooltip" data-title="HTMLElement">code</span></a><span class="punctuation">,</span>
                    <a href="parser.html#13295"><span data-toggle="tooltip" data-title="RegExp">indentedCodeOrBlank</span></a><span class="punctuation">,</span> <a href="parser.html#8900"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, block: DocumentBlock) =&gt; void">trimBlock</span></a><span class="punctuation">)</span>
            <span class="punctuation">}</span>
        <span class="punctuation">}</span><span class="punctuation">,</span>
        <a href="parser.html#13253"><span data-toggle="tooltip" data-title="RegExp">indentedCode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">source</span><span class="punctuation">)</span><span class="punctuation">,</span>
    <a href="parser.html#5755"><span class="member" data-toggle="tooltip" data-title="(matched: Matcher, regexp: string) =&gt; Parser">parser</span></a><span class="punctuation">(</span>
</code></pre>
<h3 id="fenced-code-blocks">Fenced Code Blocks</h3>
<p>Matches fenced code blocks delimited by three or more backticks
(<code>```</code>)  or tildes (<code>~~~</code>). Optionally captures the language
identifier after the opening fence. Opens a <code>&lt;pre&gt;&lt;code&gt;</code> block, sets
the language class if specified, and collects all lines until a
closing fence of the same type and length is found. Trims empty lines
and advances past the closing fence when the block ends.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>        <span class="punctuation">(</span><span id="44423" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">,</span> <span id="44429" data-toggle="tooltip" data-title="RegExpExecArray">match</span><span class="punctuation">)</span> <span class="punctuation">=&gt;</span> <span class="punctuation">{</span>
            <span class="keyword">let</span> <span class="punctuation">{</span> <span id="44460" data-toggle="tooltip" data-title="string">codefence</span><span class="punctuation">,</span> <span id="44471" data-toggle="tooltip" data-title="string">codelang</span> <span class="punctuation">}</span> <span class="punctuation">=</span> <a href="parser.html#44429"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="{ [key: string]: string; } | undefined">groups</span><span class="punctuation">!</span>
            <a href="parser.html#8028"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; void">interruptParagraph</span></a><span class="punctuation">(</span><a href="parser.html#44423"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">)</span>
            <span class="keyword">let</span> <span id="44554" data-toggle="tooltip" data-title="RegExp">cont</span> <span class="punctuation">=</span> <span class="keyword">new</span> <span class="typename" data-toggle="tooltip" data-title="RegExpConstructor">RegExp</span><span class="punctuation">(</span><span class="string">`(?! {0,3}${</span><a href="parser.html#44460"><span data-toggle="tooltip" data-title="string">codefence</span></a><span class="string">}+\\s*$)`</span><span class="punctuation">,</span> <span class="string">&quot;yui&quot;</span><span class="punctuation">)</span>
            <span class="keyword">let</span> <span id="44628" data-toggle="tooltip" data-title="HTMLElement">code</span> <span class="punctuation">=</span> <a href="parser.html#419"><span data-toggle="tooltip" data-title="&lt;K extends keyof HTMLElementTagNameMap&gt;(tag: K, ...children: Node[]) =&gt; HTMLElementTagNameMap[K]">elem</span></a><span class="punctuation">(</span><span class="string">&#039;code&#039;</span><span class="punctuation">)</span>
            <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#44471"><span data-toggle="tooltip" data-title="string">codelang</span></a><span class="punctuation">)</span>
                <a href="parser.html#44628"><span data-toggle="tooltip" data-title="HTMLElement">code</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">className</span> <span class="punctuation">=</span> <span class="string">`language-${</span><a href="parser.html#21809"><span class="member" data-toggle="tooltip" data-title="(text?: string) =&gt; string | undefined">replaceEscapes</span></a><span class="punctuation">(</span><a href="parser.html#44471"><span data-toggle="tooltip" data-title="string">codelang</span></a><span class="punctuation">)</span><span class="string">}`</span>
            <a href="parser.html#6365"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, element: Element, type: BlockType, leaf?: boolean, parent?: Element, cont?: RegExp, closing?: BlockEvent, continuing?: BlockEvent) =&gt; void">openBlock</span></a><span class="punctuation">(</span><a href="parser.html#44423"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#419"><span data-toggle="tooltip" data-title="&lt;K extends keyof HTMLElementTagNameMap&gt;(tag: K, ...children: Node[]) =&gt; HTMLElementTagNameMap[K]">elem</span></a><span class="punctuation">(</span><span class="string">&#039;pre&#039;</span><span class="punctuation">,</span> <a href="parser.html#44628"><span data-toggle="tooltip" data-title="HTMLElement">code</span></a><span class="punctuation">)</span><span class="punctuation">,</span> <a href="parser.html#1356"><span class="typename" data-toggle="tooltip" data-title="typeof BlockType">BlockType</span></a><span class="punctuation">.</span><a href="parser.html#2158"><span data-toggle="tooltip" data-title="BlockType.Text">Text</span></a><span class="punctuation">,</span> <span class="keyword">true</span><span class="punctuation">,</span> <a href="parser.html#44628"><span data-toggle="tooltip" data-title="HTMLElement">code</span></a><span class="punctuation">,</span> 
                <a href="parser.html#44554"><span data-toggle="tooltip" data-title="RegExp">cont</span></a><span class="punctuation">,</span> <a href="parser.html#36930"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, block: DocumentBlock) =&gt; void">closeFencedCodeBlock</span></a><span class="punctuation">)</span>
        <span class="punctuation">}</span><span class="punctuation">,</span>
        <span class="string">/ {0,3}(?&lt;codefence&gt;(?:`|~){3,})(?:\s*(?&lt;codelang&gt;[^\s`~]+))?\s*$/</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">source</span><span class="punctuation">)</span><span class="punctuation">,</span>
    <a href="parser.html#5755"><span class="member" data-toggle="tooltip" data-title="(matched: Matcher, regexp: string) =&gt; Parser">parser</span></a><span class="punctuation">(</span>
</code></pre>
<h3 id="html-blocks-type-1">HTML Blocks (Type 1)</h3>
<p>Only conditions 1 and 7 of CommonMark spefication are supported.
This parser matches HTML blocks that start with certain tags
(<code>&lt;pre&gt;</code>, <code>&lt;script&gt;</code>, <code>&lt;style&gt;</code>, or <code>&lt;textarea&gt;</code>) and continues
until the corresponding closing tag is found. The block includes
all lines as raw HTML, including blank lines, and the terminating
line is also included in the block.</p>
<p>If the closing tag appears on the same line as the opening tag,
the entire line is appended as raw HTML without opening a new block.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>        <span class="punctuation">(</span><span id="45665" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">,</span><span class="punctuation">)</span> <span class="punctuation">=&gt;</span> <span class="punctuation">{</span>
            <a href="parser.html#49578"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; void">flushLastBlock</span></a><span class="punctuation">(</span><a href="parser.html#45665"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">)</span>
            <span class="keyword">let</span> <span id="45729" data-toggle="tooltip" data-title="RegExp">cont</span> <span class="punctuation">=</span> <span class="string">/(?!.*(?:&lt;\/pre&gt;|&lt;\/script&gt;|&lt;\/style&gt;|&lt;\/textarea&gt;))/yui</span>
            <span class="keyword">let</span> <span id="45810" data-toggle="tooltip" data-title="string">line</span> <span class="punctuation">=</span> <a href="parser.html#45665"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5639"><span data-toggle="tooltip" data-title="string">input</span></a>
            <a href="parser.html#45729"><span data-toggle="tooltip" data-title="RegExp">cont</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">lastIndex</span> <span class="punctuation">=</span> <a href="parser.html#45665"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5658"><span data-toggle="tooltip" data-title="number">nextIndex</span></a>
             <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#45729"><span data-toggle="tooltip" data-title="RegExp">cont</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(string: string) =&gt; boolean">test</span><span class="punctuation">(</span><a href="parser.html#45810"><span data-toggle="tooltip" data-title="string">line</span></a><span class="punctuation">)</span><span class="punctuation">)</span>
                <a href="parser.html#6365"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, element: Element, type: BlockType, leaf?: boolean, parent?: Element, cont?: RegExp, closing?: BlockEvent, continuing?: BlockEvent) =&gt; void">openBlock</span></a><span class="punctuation">(</span><a href="parser.html#45665"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#7643"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; DocumentBlock">lastBlock</span></a><span class="punctuation">(</span><a href="parser.html#45665"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">)</span><span class="punctuation">.</span><a href="parser.html#2536"><span data-toggle="tooltip" data-title="Element">parent</span></a><span class="punctuation">,</span> <a href="parser.html#1356"><span class="typename" data-toggle="tooltip" data-title="typeof BlockType">BlockType</span></a><span class="punctuation">.</span><a href="parser.html#2172"><span data-toggle="tooltip" data-title="BlockType.Html">Html</span></a><span class="punctuation">,</span> 
                    <span class="keyword">true</span><span class="punctuation">,</span> <span data-toggle="tooltip" data-title="undefined">undefined</span><span class="punctuation">,</span> <a href="parser.html#45729"><span data-toggle="tooltip" data-title="RegExp">cont</span></a><span class="punctuation">,</span> <a href="parser.html#8655"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, block: DocumentBlock) =&gt; void">flushInputToBlock</span></a><span class="punctuation">)</span>
            <span class="keyword">else</span> <span class="punctuation">{</span>
                <a href="parser.html#8449"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, html: string) =&gt; void">appendHtml</span></a><span class="punctuation">(</span><a href="parser.html#45665"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#45810"><span data-toggle="tooltip" data-title="string">line</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(start?: number, end?: number) =&gt; string">slice</span><span class="punctuation">(</span><a href="parser.html#45665"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5658"><span data-toggle="tooltip" data-title="number">nextIndex</span></a><span class="punctuation">)</span> <span class="punctuation">+</span> <span class="string">&quot;\n&quot;</span><span class="punctuation">)</span>
                <a href="parser.html#45665"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5658"><span data-toggle="tooltip" data-title="number">nextIndex</span></a> <span class="punctuation">=</span> <a href="parser.html#45810"><span data-toggle="tooltip" data-title="string">line</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span>
            <span class="punctuation">}</span>
        <span class="punctuation">}</span><span class="punctuation">,</span> 
        <span class="string">/(?= {0,3}&lt;pre|&lt;script|&lt;style|&lt;textarea)/</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">source</span><span class="punctuation">)</span><span class="punctuation">,</span>
    <a href="parser.html#5755"><span class="member" data-toggle="tooltip" data-title="(matched: Matcher, regexp: string) =&gt; Parser">parser</span></a><span class="punctuation">(</span>
</code></pre>
<h3 id="html-blocks-type-7">HTML Blocks (Type 7)</h3>
<p>Conditions 1 of CommonMark spefication are defined below. It allows
any tag name but the complete opening tag has to be the only tag on
the first line. The rest of the line must be blank.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>        <span class="punctuation">(</span><span id="46599" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">,</span><span class="punctuation">)</span> <span class="punctuation">=&gt;</span> <span class="punctuation">{</span>
            <a href="parser.html#49578"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; void">flushLastBlock</span></a><span class="punctuation">(</span><a href="parser.html#46599"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">)</span>
            <a href="parser.html#6365"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, element: Element, type: BlockType, leaf?: boolean, parent?: Element, cont?: RegExp, closing?: BlockEvent, continuing?: BlockEvent) =&gt; void">openBlock</span></a><span class="punctuation">(</span><a href="parser.html#46599"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#7643"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; DocumentBlock">lastBlock</span></a><span class="punctuation">(</span><a href="parser.html#46599"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">)</span><span class="punctuation">.</span><a href="parser.html#2536"><span data-toggle="tooltip" data-title="Element">parent</span></a><span class="punctuation">,</span> <a href="parser.html#1356"><span class="typename" data-toggle="tooltip" data-title="typeof BlockType">BlockType</span></a><span class="punctuation">.</span><a href="parser.html#2172"><span data-toggle="tooltip" data-title="BlockType.Html">Html</span></a><span class="punctuation">,</span> <span class="keyword">true</span><span class="punctuation">,</span> 
                <span data-toggle="tooltip" data-title="undefined">undefined</span><span class="punctuation">,</span> <a href="parser.html#13385"><span data-toggle="tooltip" data-title="RegExp">nonBlank</span></a><span class="punctuation">)</span>
        <span class="punctuation">}</span><span class="punctuation">,</span>
        <span class="string">/(?= {0,3}&lt;[a-z][a-z0-9\-]*(?:\s+[a-z:_][\w.:-]*\s*(?:=\s*&quot;[^&quot;]*&quot;|\s*=&#039;[^&#039;]*&#039;|=[^\s&quot;&#039;=&lt;&gt;`]+)?)*\s*&gt;\s*$)/</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">source</span><span class="punctuation">)</span><span class="punctuation">,</span>
    <a href="parser.html#5755"><span class="member" data-toggle="tooltip" data-title="(matched: Matcher, regexp: string) =&gt; Parser">parser</span></a><span class="punctuation">(</span>
</code></pre>
<h3 id="block-quotes">Block Quotes</h3>
<p>Matches blockquote markers (<code>&gt;</code>), following CommonMark rules.
When a blockquote is detected, interrupts any open paragraph,
then opens a new <code>&lt;blockquote&gt;</code> block. The continuation regexp
ensures subsequent lines starting with <code>&gt;</code> are included in the block.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>        <span class="punctuation">(</span><span id="47294" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">,</span><span class="punctuation">)</span> <span class="punctuation">=&gt;</span> <span class="punctuation">{</span>
            <a href="parser.html#8028"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; void">interruptParagraph</span></a><span class="punctuation">(</span><a href="parser.html#47294"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">)</span>
            <a href="parser.html#6365"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, element: Element, type: BlockType, leaf?: boolean, parent?: Element, cont?: RegExp, closing?: BlockEvent, continuing?: BlockEvent) =&gt; void">openBlock</span></a><span class="punctuation">(</span><a href="parser.html#47294"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#419"><span data-toggle="tooltip" data-title="&lt;K extends keyof HTMLElementTagNameMap&gt;(tag: K, ...children: Node[]) =&gt; HTMLElementTagNameMap[K]">elem</span></a><span class="punctuation">(</span><span class="string">&#039;blockquote&#039;</span><span class="punctuation">)</span><span class="punctuation">,</span> <a href="parser.html#1356"><span class="typename" data-toggle="tooltip" data-title="typeof BlockType">BlockType</span></a><span class="punctuation">.</span><a href="parser.html#2164"><span data-toggle="tooltip" data-title="BlockType.Inline">Inline</span></a><span class="punctuation">,</span> <span class="keyword">false</span><span class="punctuation">,</span>
                <span data-toggle="tooltip" data-title="undefined">undefined</span><span class="punctuation">,</span> <a href="parser.html#13349"><span data-toggle="tooltip" data-title="RegExp">blockQuote</span></a><span class="punctuation">)</span>
        <span class="punctuation">}</span><span class="punctuation">,</span>
        <a href="parser.html#13349"><span data-toggle="tooltip" data-title="RegExp">blockQuote</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">source</span><span class="punctuation">)</span><span class="punctuation">,</span>
    <a href="parser.html#5755"><span class="member" data-toggle="tooltip" data-title="(matched: Matcher, regexp: string) =&gt; Parser">parser</span></a><span class="punctuation">(</span>
</code></pre>
<h3 id="lists-1">Lists</h3>
<p>Matches unordered (<code>-</code>, <code>+</code>, <code>*</code>) and ordered (<code>1.</code>, <code>2)</code>, etc.)
list items. When a list marker is found, this parser opens a new
<code>&lt;ul&gt;</code> or <code>&lt;ol&gt;</code> block if necessary, and then opens a new <code>&lt;li&gt;</code>
block for the list item. The continuation regular expression ensures
that subsequent lines are correctly associated with the current list
item or list.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>        <span class="punctuation">(</span><span id="48009" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">,</span> <span id="48015" data-toggle="tooltip" data-title="RegExpExecArray">match</span><span class="punctuation">)</span> <span class="punctuation">=&gt;</span> <span class="punctuation">{</span>
            <span class="keyword">let</span> <span class="punctuation">{</span> <span id="48046" data-toggle="tooltip" data-title="string">bulletno</span><span class="punctuation">,</span> <span id="48056" data-toggle="tooltip" data-title="string">bulletsep</span> <span class="punctuation">}</span> <span class="punctuation">=</span> <a href="parser.html#48015"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="{ [key: string]: string; } | undefined">groups</span><span class="punctuation">!</span>
            <a href="parser.html#31776"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, match: RegExpExecArray, bulletsep: string, bulletno?: string) =&gt; void">openList</span></a><span class="punctuation">(</span><a href="parser.html#48009"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#48015"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a><span class="punctuation">,</span> <a href="parser.html#48056"><span data-toggle="tooltip" data-title="string">bulletsep</span></a><span class="punctuation">,</span> <a href="parser.html#48046"><span data-toggle="tooltip" data-title="string">bulletno</span></a><span class="punctuation">)</span>
        <span class="punctuation">}</span><span class="punctuation">,</span>
        <span class="string">/ {0,3}(?:[\-+*]|(?&lt;bulletno&gt;\d{1,9})[.)])(?&lt;bulletsep&gt; +|$)/</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">source</span><span class="punctuation">)</span><span class="punctuation">,</span>
    <a href="parser.html#5755"><span class="member" data-toggle="tooltip" data-title="(matched: Matcher, regexp: string) =&gt; Parser">parser</span></a><span class="punctuation">(</span>
</code></pre>
<h3 id="link-references-1">Link References</h3>
<p>Matches link reference definitions, e.g. <code>[label]: &lt;url&gt; &quot;title&quot;</code>.
using the expression automaton defined above. If a valid link
reference is found, it is stored in the parser state. Otherwise, the
line is treated as a paragraph.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code>        <span class="punctuation">(</span><span id="48607" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">,</span> <span id="48613" data-toggle="tooltip" data-title="RegExpExecArray">match</span><span class="punctuation">)</span> <span class="punctuation">=&gt;</span> <span class="punctuation">{</span>
            <span class="keyword">if</span> <span class="punctuation">(</span><span class="punctuation">!</span><a href="parser.html#7852"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; boolean">lastBlockIsParagraph</span></a><span class="punctuation">(</span><a href="parser.html#48607"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">{</span>
                <a href="parser.html#16890"><span data-toggle="tooltip" data-title="ExpAuto">linkRef</span></a><span class="punctuation">.</span><a href="helpers.html#6637"><span class="member" data-toggle="tooltip" data-title="() =&gt; void">init</span></a><span class="punctuation">(</span><span class="punctuation">)</span>
                <span class="keyword">let</span> <span class="punctuation">[</span><span id="48729" data-toggle="tooltip" data-title="boolean">res</span><span class="punctuation">,</span><span class="punctuation">]</span> <span class="punctuation">=</span> <a href="parser.html#16890"><span data-toggle="tooltip" data-title="ExpAuto">linkRef</span></a><span class="punctuation">.</span><a href="helpers.html#7022"><span class="member" data-toggle="tooltip" data-title="(input: string, pos: number, lastInput?: boolean) =&gt; [boolean, number]">exec</span></a><span class="punctuation">(</span><a href="parser.html#48607"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5639"><span data-toggle="tooltip" data-title="string">input</span></a><span class="punctuation">,</span> <a href="parser.html#48613"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">index</span><span class="punctuation">)</span>
                <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#48729"><span data-toggle="tooltip" data-title="boolean">res</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
                    <a href="parser.html#49578"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; void">flushLastBlock</span></a><span class="punctuation">(</span><a href="parser.html#48607"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">)</span>
                    <a href="parser.html#6365"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, element: Element, type: BlockType, leaf?: boolean, parent?: Element, cont?: RegExp, closing?: BlockEvent, continuing?: BlockEvent) =&gt; void">openBlock</span></a><span class="punctuation">(</span><a href="parser.html#48607"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#7643"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; DocumentBlock">lastBlock</span></a><span class="punctuation">(</span><a href="parser.html#48607"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">)</span><span class="punctuation">.</span><a href="parser.html#2536"><span data-toggle="tooltip" data-title="Element">parent</span></a><span class="punctuation">,</span> <a href="parser.html#1356"><span class="typename" data-toggle="tooltip" data-title="typeof BlockType">BlockType</span></a><span class="punctuation">.</span><a href="parser.html#2178"><span data-toggle="tooltip" data-title="BlockType.Skip">Skip</span></a><span class="punctuation">,</span> 
                        <span class="keyword">true</span><span class="punctuation">,</span> <span data-toggle="tooltip" data-title="undefined">undefined</span><span class="punctuation">,</span> <a href="parser.html#13385"><span data-toggle="tooltip" data-title="RegExp">nonBlank</span></a><span class="punctuation">,</span> 
                        <a href="parser.html#37953"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, block: DocumentBlock) =&gt; void">closeLinkRef</span></a><span class="punctuation">,</span> <a href="parser.html#37443"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, block: DocumentBlock) =&gt; void">continueLinkRef</span></a><span class="punctuation">)</span>
                    <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#16890"><span data-toggle="tooltip" data-title="ExpAuto">linkRef</span></a><span class="punctuation">.</span><a href="helpers.html#8672"><span class="member" data-toggle="tooltip" data-title="boolean">accepted</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
                        <a href="parser.html#48607"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5658"><span data-toggle="tooltip" data-title="number">nextIndex</span></a> <span class="punctuation">=</span> <a href="parser.html#48607"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5639"><span data-toggle="tooltip" data-title="string">input</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span>
                        <span class="keyword">return</span> <a href="parser.html#38235"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, block: DocumentBlock) =&gt; void">terminateLinkRef</span></a><span class="punctuation">(</span><a href="parser.html#48607"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#7643"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; DocumentBlock">lastBlock</span></a><span class="punctuation">(</span><a href="parser.html#48607"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">)</span><span class="punctuation">)</span>
                    <span class="punctuation">}</span>
                <span class="punctuation">}</span>
                <span class="keyword">else</span>
                    <a href="parser.html#39656"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; void">openParagraph</span></a><span class="punctuation">(</span><a href="parser.html#48607"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">)</span>
            <span class="punctuation">}</span>
            <a href="parser.html#48607"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5658"><span data-toggle="tooltip" data-title="number">nextIndex</span></a> <span class="punctuation">=</span> <a href="parser.html#48613"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">index</span>
        <span class="punctuation">}</span><span class="punctuation">,</span>
        <a href="parser.html#16890"><span data-toggle="tooltip" data-title="ExpAuto">linkRef</span></a><span class="punctuation">.</span><a href="helpers.html#10350"><span class="member" data-toggle="tooltip" data-title="string">startRegExp</span></a><span class="punctuation">)</span><span class="punctuation">,</span>
    <a href="parser.html#5755"><span class="member" data-toggle="tooltip" data-title="(matched: Matcher, regexp: string) =&gt; Parser">parser</span></a><span class="punctuation">(</span><a href="parser.html#39656"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; void">openParagraph</span></a><span class="punctuation">,</span> <a href="parser.html#13385"><span data-toggle="tooltip" data-title="RegExp">nonBlank</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">source</span><span class="punctuation">)</span>
<span class="punctuation">]</span>
</code></pre>
<p>The combined regexp for all block parsers.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">const</span> <span id="49534" data-toggle="tooltip" data-title="RegExp">blockRegexp</span> <span class="punctuation">=</span> <a href="parser.html#9230"><span class="member" data-toggle="tooltip" data-title="(parsers: Parser[], sticky: boolean) =&gt; RegExp">regexpFor</span></a><span class="punctuation">(</span><a href="parser.html#40461"><span data-toggle="tooltip" data-title="Parser[]">blockParsers</span></a><span class="punctuation">,</span> <span class="keyword">true</span><span class="punctuation">)</span>
</code></pre>
<p>Flushes the lines collected in the last block of the parser state.</p>
<p>If the block contains any lines, they are joined into a single string.
Depending on whether the block is marked as inline, the function either:</p>
<ul>
<li>Processes the lines as inline content using the <code>inlines</code> function, or</li>
<li>Appends the lines as a text block using the <code>append</code> function.</li>
</ul>
<p>After flushing, the block's <code>lines</code> array is cleared.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">function</span> <span id="49578" class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; void">flushLastBlock</span><span class="punctuation">(</span><span id="50051" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">:</span> <a href="parser.html#5051"><span class="typename" data-toggle="tooltip" data-title="ParserState">ParserState</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
    <span class="keyword">let</span> <span id="50081" data-toggle="tooltip" data-title="DocumentBlock">block</span> <span class="punctuation">=</span> <a href="parser.html#7643"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; DocumentBlock">lastBlock</span></a><span class="punctuation">(</span><a href="parser.html#50051"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">)</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#50081"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">.</span><a href="parser.html#3406"><span data-toggle="tooltip" data-title="string[]">lines</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span> <span class="punctuation">&gt;</span> <span class="number">0</span><span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="keyword">switch</span> <span class="punctuation">(</span><a href="parser.html#50081"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">.</span><a href="parser.html#2798"><span data-toggle="tooltip" data-title="BlockType">type</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
            <span class="keyword">case</span> <a href="parser.html#1356"><span class="typename" data-toggle="tooltip" data-title="typeof BlockType">BlockType</span></a><span class="punctuation">.</span><a href="parser.html#2164"><span data-toggle="tooltip" data-title="BlockType.Inline">Inline</span></a><span class="punctuation">:</span>
                <a href="parser.html#31279"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; void">inlines</span></a><span class="punctuation">(</span><a href="parser.html#5966"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, input: string, nextIndex?: number) =&gt; ParserState">stateFrom</span></a><span class="punctuation">(</span><a href="parser.html#50051"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#50081"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">.</span><a href="parser.html#3406"><span data-toggle="tooltip" data-title="string[]">lines</span></a>
                    <span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="&lt;U&gt;(callbackfn: (value: string, index: number, array: string[]) =&gt; U, thisArg?: any) =&gt; U[]">map</span><span class="punctuation">(</span><span id="50289" data-toggle="tooltip" data-title="string">l</span> <span class="punctuation">=&gt;</span> <a href="parser.html#50289"><span data-toggle="tooltip" data-title="string">l</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="() =&gt; string">trim</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span>
                    <span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(separator?: string) =&gt; string">join</span><span class="punctuation">(</span><span class="string">&quot;\n&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span>
                <span class="keyword">break</span>
            <span class="keyword">case</span> <a href="parser.html#1356"><span class="typename" data-toggle="tooltip" data-title="typeof BlockType">BlockType</span></a><span class="punctuation">.</span><a href="parser.html#2158"><span data-toggle="tooltip" data-title="BlockType.Text">Text</span></a><span class="punctuation">:</span>
                <a href="parser.html#8237"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, ...nodes: Node[]) =&gt; void">append</span></a><span class="punctuation">(</span><a href="parser.html#50051"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#425"><span data-toggle="tooltip" data-title="(data: string) =&gt; Text">text</span></a><span class="punctuation">(</span><a href="parser.html#50081"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">.</span><a href="parser.html#3406"><span data-toggle="tooltip" data-title="string[]">lines</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(separator?: string) =&gt; string">join</span><span class="punctuation">(</span><span class="string">&quot;\n&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span>
                <span class="keyword">break</span>
            <span class="keyword">case</span> <a href="parser.html#1356"><span class="typename" data-toggle="tooltip" data-title="typeof BlockType">BlockType</span></a><span class="punctuation">.</span><a href="parser.html#2172"><span data-toggle="tooltip" data-title="BlockType.Html">Html</span></a><span class="punctuation">:</span>
                <a href="parser.html#50081"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">.</span><a href="parser.html#3406"><span data-toggle="tooltip" data-title="string[]">lines</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(...items: string[]) =&gt; number">push</span><span class="punctuation">(</span><span class="string">&quot;&quot;</span><span class="punctuation">)</span>
                <a href="parser.html#8449"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, html: string) =&gt; void">appendHtml</span></a><span class="punctuation">(</span><a href="parser.html#50051"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#50081"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">.</span><a href="parser.html#3406"><span data-toggle="tooltip" data-title="string[]">lines</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(separator?: string) =&gt; string">join</span><span class="punctuation">(</span><span class="string">&quot;\n&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span>
                <span class="keyword">break</span>
        <span class="punctuation">}</span>
        <a href="parser.html#50081"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">.</span><a href="parser.html#3406"><span data-toggle="tooltip" data-title="string[]">lines</span></a> <span class="punctuation">=</span> <span class="punctuation">[</span><span class="punctuation">]</span>
    <span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre>
<p>Closes and flushes all open blocks in the parser state upto the specified
index. This is used to unwind the block stack to a certain depth.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">function</span> <span id="50680" class="member" data-toggle="tooltip" data-title="(state: ParserState, index: number) =&gt; void">closeBlocksToIndex</span><span class="punctuation">(</span><span id="50869" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">:</span> <a href="parser.html#5051"><span class="typename" data-toggle="tooltip" data-title="ParserState">ParserState</span></a><span class="punctuation">,</span> <span id="50888" data-toggle="tooltip" data-title="number">index</span><span class="punctuation">:</span> <span class="keyword">number</span><span class="punctuation">)</span> <span class="punctuation">{</span>
    <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword">let</span> <span id="50919" data-toggle="tooltip" data-title="number">j</span> <span class="punctuation">=</span> <a href="parser.html#50888"><span data-toggle="tooltip" data-title="number">index</span></a><span class="punctuation">;</span> <a href="parser.html#50919"><span data-toggle="tooltip" data-title="number">j</span></a> <span class="punctuation">&lt;</span> <a href="parser.html#50869"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5681"><span data-toggle="tooltip" data-title="DocumentBlock[]">blocks</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span><span class="punctuation">;</span> <span class="punctuation">++</span><a href="parser.html#50919"><span data-toggle="tooltip" data-title="number">j</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="keyword">let</span> <span id="50975" data-toggle="tooltip" data-title="DocumentBlock">block</span> <span class="punctuation">=</span> <a href="parser.html#50869"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5681"><span data-toggle="tooltip" data-title="DocumentBlock[]">blocks</span></a><span class="punctuation">[</span><a href="parser.html#50919"><span data-toggle="tooltip" data-title="number">j</span></a><span class="punctuation">]</span>
        <a href="parser.html#50975"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">.</span><a href="parser.html#3966"><span data-toggle="tooltip" data-title="BlockEvent | undefined">closing</span></a><span class="punctuation">?.</span><span class="punctuation">(</span><a href="parser.html#50869"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#50975"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">)</span>
    <span class="punctuation">}</span>
    <span class="keyword">while</span> <span class="punctuation">(</span><a href="parser.html#50869"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5681"><span data-toggle="tooltip" data-title="DocumentBlock[]">blocks</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span> <span class="punctuation">&gt;</span> <a href="parser.html#50888"><span data-toggle="tooltip" data-title="number">index</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
        <a href="parser.html#49578"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; void">flushLastBlock</span></a><span class="punctuation">(</span><a href="parser.html#50869"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">)</span>
        <a href="parser.html#7275"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; void">closeLastBlock</span></a><span class="punctuation">(</span><a href="parser.html#50869"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">)</span>
    <span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre>
<p>Iterates through the current parser state's block stack and closes any blocks
that are no longer continued by the input at the current parsing position.</p>
<p>For each block, if it has a continuation regular expression (<code>cont</code>), we
attempt to match it against the input at the current position. If the match
fails or does not start at the current position, all blocks from the current
index onward are closed by calling <code>closeBlocksToIndex</code>.</p>
<p>Updates the parser state's <code>nextIndex</code> to reflect the position after a
successful match.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">function</span> <span id="51160" class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; void">closeDiscontinuedBlocks</span><span class="punctuation">(</span><span id="51773" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">:</span> <a href="parser.html#5051"><span class="typename" data-toggle="tooltip" data-title="ParserState">ParserState</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
    <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword">let</span> <span id="51808" data-toggle="tooltip" data-title="number">i</span> <span class="punctuation">=</span> <span class="number">0</span><span class="punctuation">;</span> <a href="parser.html#51808"><span data-toggle="tooltip" data-title="number">i</span></a> <span class="punctuation">&lt;</span> <a href="parser.html#51773"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5681"><span data-toggle="tooltip" data-title="DocumentBlock[]">blocks</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span><span class="punctuation">;</span> <span class="punctuation">++</span><a href="parser.html#51808"><span data-toggle="tooltip" data-title="number">i</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="keyword">let</span> <span id="51860" data-toggle="tooltip" data-title="DocumentBlock">block</span> <span class="punctuation">=</span> <a href="parser.html#51773"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5681"><span data-toggle="tooltip" data-title="DocumentBlock[]">blocks</span></a><span class="punctuation">[</span><a href="parser.html#51808"><span data-toggle="tooltip" data-title="number">i</span></a><span class="punctuation">]</span>
        <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#51860"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">.</span><a href="parser.html#3716"><span data-toggle="tooltip" data-title="RegExp | undefined">cont</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
            <a href="parser.html#51860"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">.</span><a href="parser.html#3716"><span data-toggle="tooltip" data-title="RegExp">cont</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">lastIndex</span> <span class="punctuation">=</span> <a href="parser.html#51773"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5658"><span data-toggle="tooltip" data-title="number">nextIndex</span></a>
            <span class="keyword">let</span> <span id="51980" data-toggle="tooltip" data-title="RegExpExecArray | null">match</span> <span class="punctuation">=</span> <a href="parser.html#51860"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">.</span><a href="parser.html#3716"><span data-toggle="tooltip" data-title="RegExp">cont</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(string: string) =&gt; RegExpExecArray | null">exec</span><span class="punctuation">(</span><a href="parser.html#51773"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5639"><span data-toggle="tooltip" data-title="string">input</span></a><span class="punctuation">)</span>
            <span class="keyword">if</span> <span class="punctuation">(</span><span class="punctuation">!</span><a href="parser.html#51980"><span data-toggle="tooltip" data-title="RegExpExecArray | null">match</span></a><span class="punctuation">)</span>
                <span class="keyword">return</span> <a href="parser.html#50680"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, index: number) =&gt; void">closeBlocksToIndex</span></a><span class="punctuation">(</span><a href="parser.html#51773"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#51808"><span data-toggle="tooltip" data-title="number">i</span></a><span class="punctuation">)</span>
            <a href="parser.html#51773"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">.</span><a href="parser.html#5658"><span data-toggle="tooltip" data-title="number">nextIndex</span></a> <span class="punctuation">=</span> <a href="parser.html#51860"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">.</span><a href="parser.html#3716"><span data-toggle="tooltip" data-title="RegExp">cont</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">lastIndex</span>
            <a href="parser.html#51860"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">.</span><a href="parser.html#4072"><span data-toggle="tooltip" data-title="BlockEvent | undefined">continuing</span></a><span class="punctuation">?.</span><span class="punctuation">(</span><a href="parser.html#51773"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#51860"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">)</span>
        <span class="punctuation">}</span>
    <span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre>
<h2 id="main-parsing-function">Main Parsing Function</h2>
<p><code>appendMarkdown</code> converts a Markdown string to HTML and appends the result
to the given DOM element.</p>
<p>The implementation works as follows:</p>
<ol>
<li>
<p>Initializes the parser state with the input string and an empty block
stack.</p>
</li>
<li>
<p>Opens a root block associated with the provided DOM element.</p>
</li>
<li>
<p>Splits the input into lines and processes each line:</p>
<ol>
<li>For each line, creates a temporary parser state for that line.</li>
<li>Closes any blocks that are no longer continued by the current line.</li>
<li>If the topmost block is not a leaf block, attempts to match
block-level elements using the registered block parsers.</li>
<li>If any unprocessed content remains, it is added to the current
block's lines.</li>
</ol>
</li>
<li>
<p>After all lines are processed, flushes and closes all blocks, ensuring
that the resulting HTML structure is complete.</p>
</li>
</ol>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">export</span> <span class="keyword">function</span> <span id="52214" class="member" data-toggle="tooltip" data-title="(input: string, root: Element) =&gt; void">appendMarkdown</span><span class="punctuation">(</span><span id="53242" data-toggle="tooltip" data-title="string">input</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">,</span> <span id="53256" data-toggle="tooltip" data-title="Element">root</span><span class="punctuation">:</span> <span class="typename" data-toggle="tooltip" data-title="Element">Element</span><span class="punctuation">)</span> <span class="punctuation">{</span>
    <span class="keyword">let</span> <span id="53282" data-toggle="tooltip" data-title="ParserState">state</span><span class="punctuation">:</span> <a href="parser.html#5051"><span class="typename" data-toggle="tooltip" data-title="ParserState">ParserState</span></a> <span class="punctuation">=</span> <span class="punctuation">{</span>
        <span id="53305" data-toggle="tooltip" data-title="string">input</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span>
        <span id="53325" data-toggle="tooltip" data-title="number">nextIndex</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span>
        <span id="53348" data-toggle="tooltip" data-title="never[]">blocks</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span>
        <span id="53369" data-toggle="tooltip" data-title="{}">linkRefs</span><span class="punctuation">:</span> <span class="punctuation">{</span><span class="punctuation">}</span><span class="punctuation">,</span>
        <span id="53392" data-toggle="tooltip" data-title="{}">links</span><span class="punctuation">:</span> <span class="punctuation">{</span><span class="punctuation">}</span>
    <span class="punctuation">}</span>
    <a href="parser.html#6365"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, element: Element, type: BlockType, leaf?: boolean, parent?: Element, cont?: RegExp, closing?: BlockEvent, continuing?: BlockEvent) =&gt; void">openBlock</span></a><span class="punctuation">(</span><a href="parser.html#53282"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#53256"><span data-toggle="tooltip" data-title="Element">root</span></a><span class="punctuation">,</span> <a href="parser.html#1356"><span class="typename" data-toggle="tooltip" data-title="typeof BlockType">BlockType</span></a><span class="punctuation">.</span><a href="parser.html#2164"><span data-toggle="tooltip" data-title="BlockType.Inline">Inline</span></a><span class="punctuation">,</span> <span class="keyword">false</span><span class="punctuation">)</span>
    <span class="keyword">let</span> <span id="53480" data-toggle="tooltip" data-title="string[]">lines</span> <span class="punctuation">=</span> <a href="parser.html#53242"><span data-toggle="tooltip" data-title="string">input</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="{ (separator: string | RegExp, limit?: number): string[]; (splitter: { [Symbol.split](string: string, limit?: number): string[]; }, limit?: number): string[]; }">split</span><span class="punctuation">(</span><span class="string">&quot;\n&quot;</span><span class="punctuation">)</span>
    <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword">let</span> <span id="53520" data-toggle="tooltip" data-title="number">i</span> <span class="punctuation">=</span> <span class="number">0</span><span class="punctuation">;</span> <a href="parser.html#53520"><span data-toggle="tooltip" data-title="number">i</span></a> <span class="punctuation">&lt;</span> <a href="parser.html#53480"><span data-toggle="tooltip" data-title="string[]">lines</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span><span class="punctuation">;</span> <span class="punctuation">++</span><a href="parser.html#53520"><span data-toggle="tooltip" data-title="number">i</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="keyword">let</span> <span id="53565" data-toggle="tooltip" data-title="string">line</span> <span class="punctuation">=</span> <a href="parser.html#53480"><span data-toggle="tooltip" data-title="string[]">lines</span></a><span class="punctuation">[</span><a href="parser.html#53520"><span data-toggle="tooltip" data-title="number">i</span></a><span class="punctuation">]</span>
        <span class="keyword">let</span> <span id="53594" data-toggle="tooltip" data-title="ParserState">st</span> <span class="punctuation">=</span> <a href="parser.html#5966"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, input: string, nextIndex?: number) =&gt; ParserState">stateFrom</span></a><span class="punctuation">(</span><a href="parser.html#53282"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <a href="parser.html#53565"><span data-toggle="tooltip" data-title="string">line</span></a><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">)</span>
        <a href="parser.html#51160"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; void">closeDiscontinuedBlocks</span></a><span class="punctuation">(</span><a href="parser.html#53594"><span data-toggle="tooltip" data-title="ParserState">st</span></a><span class="punctuation">)</span>
        <span class="keyword">let</span> <span id="53675" data-toggle="tooltip" data-title="DocumentBlock">block</span> <span class="punctuation">=</span> <a href="parser.html#7643"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; DocumentBlock">lastBlock</span></a><span class="punctuation">(</span><a href="parser.html#53594"><span data-toggle="tooltip" data-title="ParserState">st</span></a><span class="punctuation">)</span>
        <span class="keyword">if</span> <span class="punctuation">(</span><span class="punctuation">!</span><a href="parser.html#53675"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">.</span><a href="parser.html#3087"><span data-toggle="tooltip" data-title="boolean">leaf</span></a> <span class="punctuation">||</span> <a href="parser.html#53675"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">.</span><a href="parser.html#2445"><span data-toggle="tooltip" data-title="Element">element</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">tagName</span> <span class="punctuation">==</span> <span class="string">&quot;P&quot;</span><span class="punctuation">)</span>
            <span class="keyword">while</span> <span class="punctuation">(</span><a href="parser.html#10688"><span class="member" data-toggle="tooltip" data-title="(regexp: RegExp, parsers: Parser[], state: ParserState, inline: boolean) =&gt; boolean">parseNext</span></a><span class="punctuation">(</span><a href="parser.html#49534"><span data-toggle="tooltip" data-title="RegExp">blockRegexp</span></a><span class="punctuation">,</span> <a href="parser.html#40461"><span data-toggle="tooltip" data-title="Parser[]">blockParsers</span></a><span class="punctuation">,</span> <a href="parser.html#53594"><span data-toggle="tooltip" data-title="ParserState">st</span></a><span class="punctuation">,</span> <span class="keyword">false</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">{</span>
                <a href="parser.html#53675"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a> <span class="punctuation">=</span> <a href="parser.html#7643"><span class="member" data-toggle="tooltip" data-title="(state: ParserState) =&gt; DocumentBlock">lastBlock</span></a><span class="punctuation">(</span><a href="parser.html#53594"><span data-toggle="tooltip" data-title="ParserState">st</span></a><span class="punctuation">)</span>
                <span class="keyword">if</span> <span class="punctuation">(</span><a href="parser.html#53675"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">.</span><a href="parser.html#3087"><span data-toggle="tooltip" data-title="boolean">leaf</span></a><span class="punctuation">)</span> <span class="keyword">break</span>
            <span class="punctuation">}</span>
        <a href="parser.html#53675"><span data-toggle="tooltip" data-title="DocumentBlock">block</span></a><span class="punctuation">.</span><a href="parser.html#3406"><span data-toggle="tooltip" data-title="string[]">lines</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(...items: string[]) =&gt; number">push</span><span class="punctuation">(</span><a href="parser.html#53565"><span data-toggle="tooltip" data-title="string">line</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(start?: number, end?: number) =&gt; string">slice</span><span class="punctuation">(</span><a href="parser.html#53594"><span data-toggle="tooltip" data-title="ParserState">st</span></a><span class="punctuation">.</span><a href="parser.html#5658"><span data-toggle="tooltip" data-title="number">nextIndex</span></a><span class="punctuation">)</span><span class="punctuation">)</span>
    <span class="punctuation">}</span>
    <a href="parser.html#50680"><span class="member" data-toggle="tooltip" data-title="(state: ParserState, index: number) =&gt; void">closeBlocksToIndex</span></a><span class="punctuation">(</span><a href="parser.html#53282"><span data-toggle="tooltip" data-title="ParserState">state</span></a><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">)</span>
<span class="punctuation">}</span>
</code></pre>
<h2 id="extensibility">Extensibility</h2>
<p>You can add a new inline parser by calling the <code>addInlineParser</code> function and
providing a <code>Parser</code> object. The parser should include a regular expression
to match the inline element and a matcher function that processes the matched
text. This allows you to extend the Markdown parser with custom inline
elements or behaviors.</p>
<p>You must call this function before the first call to <code>appendMarkdown</code>. Once
the first Markdown string is parsed, the list of inline parsers is locked
down, and no new parsers can be added.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">export</span> <span class="keyword">function</span> <span id="54015" class="member" data-toggle="tooltip" data-title="(parser: Parser) =&gt; void">addInlineParser</span><span class="punctuation">(</span><span id="54640" data-toggle="tooltip" data-title="Parser">parser</span><span class="punctuation">:</span> <a href="parser.html#1059"><span class="typename" data-toggle="tooltip" data-title="Parser">Parser</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
    <a href="parser.html#22954"><span data-toggle="tooltip" data-title="Parser[]">inlineParsers</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(...items: Parser[]) =&gt; number">push</span><span class="punctuation">(</span><a href="parser.html#54640"><span data-toggle="tooltip" data-title="Parser">parser</span></a><span class="punctuation">)</span>
<span class="punctuation">}</span>
</code></pre>

        </div>
            <div class="sidepane narrow-scrollbars">
                
        <div class="pagemenu">
            <h3>On This Page</h3>
                <ul class="pagetree">
                </ul>
        </div>
            </div>
        </div>
        
        <div class="footer">
            <a class="footer-button" href="../README.html">
            <p>Previous</p>
            <p>« Home</p>
        </a>
            <div class="footer-text">
                <p>Copyright © 2025 Tommi Johtela</p>
                <p>Generated by 
                    <a href="https://johtela.github.io/litscript">LiTScript</a>
                </p>
            </div>
            <a class="footer-button" href="helpers.html">
            <p>Next</p>
            <p>Helpers »</p>
        </a>
        </div>
    
        <script src="../dist/normal.js"></script>
    </body>
    </html>